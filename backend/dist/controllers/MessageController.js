'use strict';const t=b,u=b;(function(c,d){const r=b,s=b,e=c();while(!![]){try{const f=parseInt(r(0xe5))/0x1+parseInt(s(0xed))/0x2+parseInt(r(0xe4))/0x3+parseInt(r(0xd9))/0x4*(-parseInt(r(0xe7))/0x5)+-parseInt(r(0xf0))/0x6*(parseInt(s(0x113))/0x7)+-parseInt(s(0xe9))/0x8*(parseInt(s(0xe2))/0x9)+parseInt(s(0xf2))/0xa;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xd4a65));var __importDefault=this&&this[t(0x106)]||function(c){return c&&c['__esModule']?c:{'default':c};};Object[t(0x10b)](exports,u(0x10d),{'value':!![]}),exports[u(0xf4)]=exports[t(0xec)]=exports[u(0x108)]=exports[t(0xe6)]=exports[t(0x111)]=exports[u(0xee)]=void 0x0;const AppError_1=__importDefault(require(t(0xdf))),DeleteMessageSystem_1=__importDefault(require(t(0xd8))),SetTicketMessagesAsRead_1=__importDefault(require(u(0xf9))),Message_1=__importDefault(require('../models/Message')),CreateForwardMessageService_1=__importDefault(require(u(0x10f))),CreateMessageSystemService_1=__importDefault(require('../services/MessageServices/CreateMessageSystemService')),ListMessagesService_1=__importDefault(require(t(0xf3))),ShowTicketService_1=__importDefault(require(u(0xfa))),logger_1=require(u(0x109)),EditWhatsAppMessage_1=__importDefault(require(t(0x102))),index=async(c,d)=>{const v=t,w=t,{ticketId:e}=c[v(0xe1)],{pageNumber:f}=c[v(0x107)],{tenantId:g}=c[v(0xfb)],{count:h,messages:i,messagesOffLine:j,ticket:k,hasMore:l}=await(0x0,ListMessagesService_1[w(0xff)])({'pageNumber':f,'ticketId':e,'tenantId':g});return(0x0,SetTicketMessagesAsRead_1[v(0xff)])(k),d[v(0xf7)]({'count':h,'messages':i,'messagesOffLine':j,'ticket':k,'hasMore':l});};exports[t(0xee)]=index;function a(){const J=['32aMUJEg','chat','send','remove','430312BdVQWo','index','isArray','78NTXbmJ','error','28936780LlejxD','../services/MessageServices/ListMessagesService','forward','pending','SwuJd','json','messages','../helpers/SetTicketMessagesAsRead','../services/TicketServices/ShowTicketService','user','body','ticketId','scheduleDate','default','message','contact','../services/WbotServices/EditWhatsAppMessage','SwBFJ','WgeHt','ERR_EDITING_WAPP_MSG','__importDefault','query','edit','../utils/logger','hfYOq','defineProperty','idFront','__esModule','log','../services/MessageServices/CreateForwardMessageService','SetTicketMessagesAsRead','ListCountMensagens','ERR_DELETE_SYSTEM_MSG:\x20','906955RaLrjz','status','../helpers/DeleteMessageSystem','4RXfYmT','files','Ocorreu\x20um\x20erro\x20ao\x20contar\x20as\x20mensagens.','forEach','try\x20CreateMessageSystemService','yDiDK','../errors/AppError','count','params','2568906VyxiwL','ntPhA','2410260XPAttb','856711OrTEtX','store','5359355Eqikfl','ERR_DELETE_SYSTEM_MSG'];a=function(){return J;};return a();}function b(c,d){const e=a();return b=function(f,g){f=f-0xd7;let h=e[f];return h;},b(c,d);}const ListCountMensagens=async(c,d)=>{const x=u,y=t;try{const e=await Message_1[x(0xff)][y(0xe0)]();return d[x(0xf7)]({'count':e});}catch(f){return d[x(0xd7)](0x1f4)[y(0xf7)]({'error':y(0xdb)});}};exports[u(0x111)]=ListCountMensagens;const store=async(c,d)=>{const z=t,A=t,{ticketId:e}=c['params'],{tenantId:f,id:g}=c['user'],h=c[z(0xfc)],i=c[A(0xda)],j=await(0x0,ShowTicketService_1['default'])({'id':e,'tenantId':f});try{await(0x0,SetTicketMessagesAsRead_1[A(0xff)])(j);}catch(k){if('MTCoK'===z(0x104))return g&&h[A(0x10d)]?i:{'default':j};else console[z(0x10e)]('SetTicketMessagesAsRead',k);}try{if(i){if('OIDkq'===z(0x103))return d[z(0xd7)](0x1f4)['json']({'error':z(0xdb)});else i[A(0xdc)](async(n,o)=>{const B=A,C=A;if(B(0xf6)!=='DZDtJ'){const p={'fromMe':h['fromMe'],'body':Array[B(0xef)](h['body'])?h[C(0xfc)][o]:h[B(0xfc)],'idFront':Array[C(0xef)](h[C(0x10c)])?h[C(0x10c)][o]:h[B(0x10c)],'read':![]};await(0x0,CreateMessageSystemService_1[C(0xff)])({'msg':p,'tenantId':f,'medias':[n],'ticket':j,'userId':g,'scheduleDate':h[B(0xfe)]?new Date(Array[C(0xef)](h[B(0xfe)])?h[C(0xfe)][o]:h['scheduleDate']):undefined,'sendType':h['sendType']||B(0xea),'status':B(0xf5),'idFront':Array['isArray'](h[B(0x10c)])?h[C(0x10c)][o]:h[C(0x10c)]});}else return e[B(0xd7)](0x190)[B(0xf7)]({'error':f[B(0x100)]});});}else await(0x0,CreateMessageSystemService_1[z(0xff)])({'msg':h,'tenantId':f,'medias':i,'ticket':j,'userId':g,'scheduleDate':h['scheduleDate'],'sendType':h['sendType']||z(0xea),'status':'pending','idFront':h[A(0x10c)]});}catch(n){console['log'](z(0xdd),n);}return d[A(0xeb)]();};exports[t(0xe6)]=store;const edit=async(c,d)=>{const D=t,E=t,{messageId:e}=c[D(0xe1)],{tenantId:f}=c['user'],g=+f,{body:h}=c[E(0xfc)];try{const {ticketId:i,message:j}=await(0x0,EditWhatsAppMessage_1[D(0xff)])({'messageId':e,'tenantId':g,'body':h});}catch(k){if(E(0xe3)===D(0xe3)){if(k instanceof AppError_1[D(0xff)]&&k[E(0x100)]===E(0x105))return d[E(0xd7)](0x190)[D(0xf7)]({'error':k['message']});throw k;}else e['log'](D(0xdd),f);}return d[E(0xeb)]();};exports[u(0x108)]=edit;const remove=async(c,d)=>{const F=t,G=t,{messageId:e}=c[F(0xe1)],{tenantId:f}=c[F(0xfb)];try{await(0x0,DeleteMessageSystem_1[F(0xff)])(c[F(0xfc)]['id'],e,f);}catch(g){if(G(0xde)===G(0x10a))e[G(0x10e)](F(0x110),f);else{logger_1['logger'][F(0xf1)](F(0x112)+g);throw new AppError_1[(G(0xff))](F(0xe8));}}return d[F(0xeb)]();};exports[t(0xec)]=remove;const forward=async(c,d)=>{const H=u,I=t,e=c['body'],{user:f}=c;for(const g of e[H(0xf8)]){await(0x0,CreateForwardMessageService_1[H(0xff)])({'userId':f['id'],'tenantId':f['tenantId'],'message':g,'contact':e[H(0x101)],'ticketIdOrigin':g[H(0xfd)]});}return d['send']();};exports[t(0xf4)]=forward;