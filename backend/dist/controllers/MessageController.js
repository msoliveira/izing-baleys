'use strict';const s=b,u=b;(function(c,d){const q=b,r=b,e=c();while(!![]){try{const f=parseInt(q(0x186))/0x1+parseInt(q(0x158))/0x2+parseInt(r(0x16f))/0x3*(-parseInt(r(0x180))/0x4)+-parseInt(r(0x17d))/0x5+-parseInt(r(0x18d))/0x6*(-parseInt(q(0x178))/0x7)+parseInt(q(0x17b))/0x8+-parseInt(q(0x156))/0x9;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xbfb16));var __importDefault=this&&this[s(0x172)]||function(c){const t=s;return c&&c[t(0x185)]?c:{'default':c};};Object[s(0x181)](exports,s(0x185),{'value':!![]}),exports[u(0x16a)]=exports[s(0x157)]=exports[s(0x171)]=exports[u(0x18e)]=exports[u(0x167)]=exports[s(0x189)]=void 0x0;const AppError_1=__importDefault(require(u(0x176))),DeleteMessageSystem_1=__importDefault(require(s(0x184))),SetTicketMessagesAsRead_1=__importDefault(require(u(0x17e))),Message_1=__importDefault(require('../models/Message')),CreateForwardMessageService_1=__importDefault(require('../services/MessageServices/CreateForwardMessageService')),CreateMessageSystemService_1=__importDefault(require(u(0x166))),ListMessagesService_1=__importDefault(require(s(0x164))),ShowTicketService_1=__importDefault(require(u(0x16c))),logger_1=require(u(0x15c)),EditWhatsAppMessage_1=__importDefault(require(s(0x18a))),index=async(c,d)=>{const v=u,w=u,{ticketId:e}=c['params'],{pageNumber:f}=c['query'],{tenantId:g}=c[v(0x174)],{count:h,messages:i,messagesOffLine:j,ticket:k,hasMore:l}=await(0x0,ListMessagesService_1[v(0x17c)])({'pageNumber':f,'ticketId':e,'tenantId':g});return(0x0,SetTicketMessagesAsRead_1[v(0x17c)])(k),d['json']({'count':h,'messages':i,'messagesOffLine':j,'ticket':k,'hasMore':l});};exports[u(0x189)]=index;const ListCountMensagens=async(c,d)=>{const x=s,y=u;try{const e=await Message_1['default'][x(0x173)]();return d[x(0x161)]({'count':e});}catch(f){if(y(0x17a)===x(0x17a))return d['status'](0x1f4)[x(0x161)]({'error':y(0x16b)});else{f[y(0x160)][y(0x182)](x(0x175)+g);throw new h[(x(0x17c))](y(0x170));}}};exports[s(0x167)]=ListCountMensagens;function a(){const J=['Ocorreu\x20um\x20erro\x20ao\x20contar\x20as\x20mensagens.','../services/TicketServices/ShowTicketService','scheduleDate','pending','948DjawkM','ERR_DELETE_SYSTEM_MSG','edit','__importDefault','count','user','ERR_DELETE_SYSTEM_MSG:\x20','../errors/AppError','ERR_EDITING_WAPP_MSG','1384537LutoAD','isArray','KSzFx','10048792YjBKpY','default','913225HlZkXC','../helpers/SetTicketMessagesAsRead','forEach','19460nLdvwP','defineProperty','error','chat','../helpers/DeleteMessageSystem','__esModule','616794CJUnky','sendType','log','index','../services/WbotServices/EditWhatsAppMessage','status','send','12BmoHuy','store','tenantId','7076475QdHsto','remove','2045918qqaanW','SetTicketMessagesAsRead','contact','ticketId','../utils/logger','ynxXL','message','fromMe','logger','json','files','body','../services/MessageServices/ListMessagesService','idFront','../services/MessageServices/CreateMessageSystemService','ListCountMensagens','rLxJs','params','forward'];a=function(){return J;};return a();}const store=async(c,d)=>{const z=u,A=u,{ticketId:e}=c[z(0x169)],{tenantId:f,id:g}=c[A(0x174)],h=c[A(0x163)],i=c[z(0x162)],j=await(0x0,ShowTicketService_1[z(0x17c)])({'id':e,'tenantId':f});try{await(0x0,SetTicketMessagesAsRead_1['default'])(j);}catch(k){console[A(0x188)]('SetTicketMessagesAsRead',k);}try{i?i[z(0x17f)](async(l,m)=>{const B=A,C=z,n={'fromMe':h[B(0x15f)],'body':Array[B(0x179)](h['body'])?h['body'][m]:h[C(0x163)],'idFront':Array[B(0x179)](h[B(0x165)])?h['idFront'][m]:h[B(0x165)],'read':![]};await(0x0,CreateMessageSystemService_1['default'])({'msg':n,'tenantId':f,'medias':[l],'ticket':j,'userId':g,'scheduleDate':h[B(0x16d)]?new Date(Array[C(0x179)](h[B(0x16d)])?h[C(0x16d)][m]:h[C(0x16d)]):undefined,'sendType':h[B(0x187)]||B(0x183),'status':B(0x16e),'idFront':Array['isArray'](h[B(0x165)])?h[C(0x165)][m]:h['idFront']});}):await(0x0,CreateMessageSystemService_1[z(0x17c)])({'msg':h,'tenantId':f,'medias':i,'ticket':j,'userId':g,'scheduleDate':h[z(0x16d)],'sendType':h[A(0x187)]||'chat','status':'pending','idFront':h['idFront']});}catch(l){console[z(0x188)]('try\x20CreateMessageSystemService',l);}return d[z(0x18c)]();};exports[u(0x18e)]=store;const edit=async(c,d)=>{const D=s,E=u,{messageId:e}=c['params'],{tenantId:f}=c[D(0x174)],g=+f,{body:h}=c[E(0x163)];try{if(D(0x15d)===D(0x15d)){const {ticketId:i,message:j}=await(0x0,EditWhatsAppMessage_1[D(0x17c)])({'messageId':e,'tenantId':g,'body':h});}else{if(i instanceof j[D(0x17c)]&&k[E(0x15e)]===D(0x177))return o[D(0x18b)](0x190)[D(0x161)]({'error':p['message']});throw n;}}catch(l){if(l instanceof AppError_1['default']&&l[E(0x15e)]===D(0x177))return d['status'](0x190)[E(0x161)]({'error':l[D(0x15e)]});throw l;}return d[E(0x18c)]();};exports[u(0x171)]=edit;const remove=async(c,d)=>{const F=u,G=s,{messageId:e}=c[F(0x169)],{tenantId:f}=c[F(0x174)];try{await(0x0,DeleteMessageSystem_1[F(0x17c)])(c[F(0x163)]['id'],e,f);}catch(g){if(F(0x168)!==G(0x168))e[G(0x188)](G(0x159),f);else{logger_1[F(0x160)][G(0x182)]('ERR_DELETE_SYSTEM_MSG:\x20'+g);throw new AppError_1[(G(0x17c))](G(0x170));}}return d[G(0x18c)]();};function b(c,d){const e=a();return b=function(f,g){f=f-0x156;let h=e[f];return h;},b(c,d);}exports[u(0x157)]=remove;const forward=async(c,d)=>{const H=u,I=u,e=c[H(0x163)],{user:f}=c;for(const g of e['messages']){await(0x0,CreateForwardMessageService_1['default'])({'userId':f['id'],'tenantId':f[I(0x18f)],'message':g,'contact':e[I(0x15a)],'ticketIdOrigin':g[H(0x15b)]});}return d[I(0x18c)]();};exports[s(0x16a)]=forward;