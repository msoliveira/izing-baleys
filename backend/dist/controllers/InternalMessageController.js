'use strict';const z=b,B=b;(function(c,d){const x=b,y=b,e=c();while(!![]){try{const f=parseInt(x(0x154))/0x1*(parseInt(y(0x180))/0x2)+parseInt(x(0x15e))/0x3*(parseInt(y(0x182))/0x4)+parseInt(y(0x159))/0x5*(parseInt(y(0x14d))/0x6)+parseInt(x(0x185))/0x7*(-parseInt(x(0x150))/0x8)+parseInt(y(0x184))/0x9+-parseInt(y(0x170))/0xa+parseInt(y(0x162))/0xb*(-parseInt(y(0x187))/0xc);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xebc6a));var __importDefault=this&&this[z(0x178)]||function(c){const A=z;return c&&c[A(0x15d)]?c:{'default':c};};Object[B(0x17d)](exports,B(0x15d),{'value':!![]}),exports[z(0x156)]=exports['marcarMensagemNaoLida']=exports[z(0x16d)]=exports[B(0x167)]=void 0x0;const socket_1=require('../libs/socket'),InternalMessage_1=__importDefault(require(z(0x17e))),User_1=__importDefault(require(B(0x14e))),ListCountUnreadMessage_1=__importDefault(require(z(0x179))),MessageService_1=__importDefault(require(B(0x155))),ReadMessageService_1=__importDefault(require(z(0x151))),logger_1=require(B(0x160)),listarMensagens=async(c,d)=>{const C=z,D=B;try{if(C(0x17f)===D(0x17f)){const {id:e}=c[C(0x16e)],{userId:f}=c[C(0x16c)],{isGroup:g}=c['query'],h=await MessageService_1[C(0x18c)][C(0x167)](e,f,g);return d['status'](0xc8)[C(0x174)]({'mensagens':h});}else return f['error'](g),h[C(0x181)](0x1f4)['json']({'error':'Ocorreu\x20um\x20erro\x20ao\x20listar\x20as\x20mensagens.'});}catch(j){return console['error'](j),d['status'](0x1f4)['json']({'error':'Ocorreu\x20um\x20erro\x20ao\x20listar\x20as\x20mensagens.'});}};function a(){const M=['IpMYJ','Ocorreu\x20um\x20erro\x20ao\x20contar\x20as\x20mensagens\x20nÃ£o\x20lidas.','getIO','json','Levjz','yFAEP','error','__importDefault','../services/InternalMessage/ListCountUnreadMessage','name','update','sender','defineProperty','../models/InternalMessage','BvKbd','2BkRRZQ','status','117048FCdszr','receiverId','1735569zHanGN','7165837brCBst','htZRi','1851768JntNdg','split',':mensagem-chat-interno','length','mBJnb','default','true',':mensagem-chat-interno-notificacao','emit','findOne','mediaName','Mensagems\x20marcadas\x20como\x20lida.','chat','all','body','Ocorreu\x20um\x20erro\x20ao\x20marcar\x20a\x20mensagens\x20como\x20lida.','2769420lFXhZO','../models/User','substr','8SrItmx','../services/InternalMessage/ReadMessageService','originalname','filename','328623FGSVRS','../services/InternalMessage/MessageService','listCountUnreadMessage','PwGIJ','mimetype','5zSVUkk','mediaType','groupId',':unread-mensagem-chat-interno','__esModule','183nTTRKd','Aoovp','../utils/logger','ERR_CREATING_MESSAGE_SYSTEM','11cwOezk','timestamp','marcarMensagemNaoLida','logger','JgviV','listarMensagens','getTime','receiver','map','files','params','criarMensagem','user','Ocorreu\x20um\x20erro\x20ao\x20criar\x20a\x20mensagem.','6242730GtcCJQ'];a=function(){return M;};return a();}exports['listarMensagens']=listarMensagens;const criarMensagem=async(c,d)=>{const E=z,F=B;try{const {text:e,timestamp:f,receiverId:g,isGroup:h}=c[E(0x14b)],{id:i,tenantId:j}=c[E(0x16e)],k=c[F(0x16b)],l=(0x0,socket_1[F(0x173)])(),m={'text':e,'timestamp':f,'receiverId':g,'senderId':i,'tenantId':j,'groupId':null,'mediaType':E(0x149),'mediaUrl':undefined,'createdAt':new Date(),'updatedAt':new Date()};(h===!![]||h===F(0x18d))&&(m['receiverId']=undefined,m[F(0x15b)]=g);let n={};if(k&&k[E(0x18a)]>0x0){if('NxgTy'==='wRPoT')return g&&h[F(0x15d)]?i:{'default':j};else await Promise[E(0x14a)](k[F(0x16a)](async q=>{const G=E,H=F;try{if(!q['filename']){if('FkCjh'===G(0x157))e[G(0x165)]['error'](f);else{const u=q[G(0x158)][H(0x188)]('/')[0x1][H(0x188)](';')[0x0];q[G(0x153)]=new Date()[H(0x168)]()+'.'+u;}}}catch(v){if(H(0x166)!==G(0x171))logger_1[H(0x165)]['error'](v);else return f[H(0x177)](g),h[G(0x181)](0x1f4)[G(0x174)]({'error':H(0x16f)});}const r={...m,'text':q[G(0x152)],'mediaUrl':q[G(0x153)],'mediaType':q[H(0x15a)]||q[H(0x158)][G(0x14f)](0x0,q[H(0x158)]['indexOf']('/'))},s=await MessageService_1[H(0x18c)]['criarMensagem'](r);n=await InternalMessage_1[G(0x18c)]['findByPk'](s['id']);if(!n)throw new Error(H(0x161));}));}else{if(E(0x176)===E(0x176))n=await MessageService_1[E(0x18c)]['criarMensagem'](m);else return f['error'](g),h['status'](0x1f4)[F(0x174)]({'error':F(0x14c)});}const o=await InternalMessage_1[E(0x18c)][F(0x190)]({'where':{'id':n['id']},'include':[{'model':User_1[F(0x18c)],'as':E(0x17c),'attributes':['id',E(0x17a)]},{'model':User_1['default'],'as':'receiver','attributes':['id',E(0x17a)]}]});return l[F(0x18f)](j+F(0x189),{'action':F(0x17b),'data':{'id':o['id'],'receiverId':o[F(0x183)],'mediaType':o[F(0x15a)],'mediaName':o[E(0x191)],'mediaUrl':o['mediaUrl'],'senderId':i,'timestamp':o[F(0x163)],'sender':o[E(0x17c)],'groupId':o[E(0x15b)],'receiver':o[F(0x169)],'text':e}}),l[F(0x18f)](j+E(0x18e),{'action':F(0x17b),'data':{'id':o['id'],'receiverId':g,'senderId':i,'mediaType':o[F(0x15a)],'timestamp':o[F(0x163)],'sender':o[F(0x17c)],'groupId':o[E(0x15b)],'receiver':o[F(0x169)],'text':e}}),d[E(0x181)](0xc9)['json']({'mensagem':o});}catch(r){return console[E(0x177)](r),d['status'](0x1f4)[E(0x174)]({'error':F(0x16f)});}};exports[z(0x16d)]=criarMensagem;function b(c,d){const e=a();return b=function(f,g){f=f-0x149;let h=e[f];return h;},b(c,d);}const marcarMensagemNaoLida=async(c,d)=>{const I=B,J=B;try{if(I(0x15f)!==J(0x175)){const {contactId:e}=c['params'],{id:f,tenantId:g}=c[J(0x16e)],{isGroup:h}=c[J(0x14b)],i=(0x0,socket_1[J(0x173)])();return await(0x0,ReadMessageService_1[J(0x18c)])({'userId':f,'senderId':e,'isGroup':h}),i[J(0x18f)](g+I(0x15c),{'action':J(0x17b),'data':{'receiverId':f,'isGroup':h,'senderId':Number(e)}}),d['status'](0xc8)[J(0x174)]({'message':I(0x192)});}else g['receiverId']=h,i[I(0x15b)]=j;}catch(k){return console[I(0x177)](k),d['status'](0x1f4)[I(0x174)]({'error':I(0x14c)});}};exports[z(0x164)]=marcarMensagemNaoLida;const listCountUnreadMessage=async(c,d)=>{const K=z,L=B;try{const {id:e}=c['user'],f=await(0x0,ListCountUnreadMessage_1[K(0x18c)])(e);return d['status'](0xc8)[K(0x174)]({'count':f});}catch(g){if(K(0x186)!==L(0x18b))return console[L(0x177)](g),d[L(0x181)](0x1f4)[L(0x174)]({'error':K(0x172)});else{if(!g['filename']){const i=k[K(0x158)]['split']('/')[0x1][L(0x188)](';')[0x0];l['filename']=new m()['getTime']()+'.'+i;}}}};exports[z(0x156)]=listCountUnreadMessage;