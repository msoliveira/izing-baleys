'use strict';const y=b,z=b;(function(c,d){const w=b,x=b,e=c();while(!![]){try{const f=-parseInt(w(0x14b))/0x1+-parseInt(x(0x16f))/0x2*(-parseInt(w(0x170))/0x3)+parseInt(w(0x140))/0x4+parseInt(w(0x174))/0x5+parseInt(x(0x165))/0x6+-parseInt(w(0x148))/0x7*(parseInt(w(0x16c))/0x8)+-parseInt(x(0x15d))/0x9;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xaee2b));function b(c,d){const e=a();return b=function(f,g){f=f-0x140;let h=e[f];return h;},b(c,d);}var __importDefault=this&&this[y(0x17c)]||function(c){return c&&c['__esModule']?c:{'default':c};};Object[z(0x153)](exports,'__esModule',{'value':!![]}),exports[y(0x164)]=exports[z(0x172)]=exports[z(0x15b)]=exports['listarMensagens']=void 0x0;const socket_1=require('../libs/socket'),InternalMessage_1=__importDefault(require('../models/InternalMessage')),User_1=__importDefault(require(y(0x17b))),ListCountUnreadMessage_1=__importDefault(require('../services/InternalMessage/ListCountUnreadMessage')),MessageService_1=__importDefault(require(z(0x16d))),ReadMessageService_1=__importDefault(require(y(0x141))),logger_1=require(z(0x173)),listarMensagens=async(c,d)=>{const A=z,B=z;try{const {id:e}=c[A(0x169)],{userId:f}=c[A(0x14a)],{isGroup:g}=c['query'],h=await MessageService_1[B(0x14e)][A(0x14d)](e,f,g);return d[A(0x147)](0xc8)[B(0x151)]({'mensagens':h});}catch(i){return console[A(0x149)](i),d[B(0x147)](0x1f4)[B(0x151)]({'error':A(0x157)});}};exports[z(0x14d)]=listarMensagens;const criarMensagem=async(c,d)=>{const C=y,D=y;try{const {text:e,timestamp:f,receiverId:g,isGroup:h}=c['body'],{id:i,tenantId:j}=c[C(0x169)],k=c[C(0x160)],l=(0x0,socket_1['getIO'])(),m={'text':e,'timestamp':f,'receiverId':g,'senderId':i,'tenantId':j,'groupId':null,'mediaType':C(0x154),'mediaUrl':undefined,'createdAt':new Date(),'updatedAt':new Date()};(h===!![]||h===C(0x159))&&(m[C(0x175)]=undefined,m[D(0x15c)]=g);let n={};if(k&&k[D(0x17a)]>0x0)await Promise[C(0x168)](k['map'](async p=>{const E=D,F=D;if('BhpeZ'!==E(0x142)){try{if(!p[E(0x171)]){if(E(0x143)==='AOwfB'){const t=f[F(0x177)][F(0x158)]('/')[0x1]['split'](';')[0x0];g[F(0x171)]=new h()[F(0x163)]()+'.'+t;}else{const t=p[E(0x177)][F(0x158)]('/')[0x1]['split'](';')[0x0];p[F(0x171)]=new Date()[E(0x163)]()+'.'+t;}}}catch(u){logger_1[F(0x155)]['error'](u);}const q={...m,'text':p[E(0x144)],'mediaUrl':p[E(0x171)],'mediaType':p[F(0x15a)]||p[F(0x177)][F(0x145)](0x0,p['mimetype']['indexOf']('/'))},r=await MessageService_1[F(0x14e)][F(0x15b)](q);n=await InternalMessage_1[F(0x14e)][F(0x14c)](r['id']);if(!n)throw new Error(E(0x176));}else return f['error'](g),h['status'](0x1f4)[E(0x151)]({'error':F(0x150)});}));else{if(C(0x152)!==D(0x178))n=await MessageService_1[D(0x14e)]['criarMensagem'](m);else throw new d(D(0x176));}const o=await InternalMessage_1[C(0x14e)]['findOne']({'where':{'id':n['id']},'include':[{'model':User_1[D(0x14e)],'as':D(0x15f),'attributes':['id',C(0x16e)]},{'model':User_1['default'],'as':C(0x179),'attributes':['id',D(0x16e)]}]});return l['emit'](j+C(0x15e),{'action':'update','data':{'id':o['id'],'receiverId':o[C(0x175)],'mediaType':o[C(0x15a)],'mediaName':o['mediaName'],'mediaUrl':o['mediaUrl'],'senderId':i,'timestamp':o[D(0x162)],'sender':o[C(0x15f)],'groupId':o['groupId'],'receiver':o[D(0x179)],'text':e}}),l[C(0x14f)](j+C(0x156),{'action':D(0x161),'data':{'id':o['id'],'receiverId':g,'senderId':i,'mediaType':o[D(0x15a)],'timestamp':o[D(0x162)],'sender':o['sender'],'groupId':o[C(0x15c)],'receiver':o[D(0x179)],'text':e}}),d['status'](0xc9)[D(0x151)]({'mensagem':o});}catch(q){if('JVssN'!==D(0x16b))return console[C(0x149)](q),d[C(0x147)](0x1f4)[C(0x151)]({'error':D(0x150)});else{if(!g[C(0x171)]){const s=k['mimetype'][C(0x158)]('/')[0x1][D(0x158)](';')[0x0];l[D(0x171)]=new m()['getTime']()+'.'+s;}}}};exports[z(0x15b)]=criarMensagem;const marcarMensagemNaoLida=async(c,d)=>{const G=z,H=y;try{const {contactId:e}=c['params'],{id:f,tenantId:g}=c[G(0x169)],{isGroup:h}=c[H(0x17d)],i=(0x0,socket_1['getIO'])();return await(0x0,ReadMessageService_1[G(0x14e)])({'userId':f,'senderId':e,'isGroup':h}),i[H(0x14f)](g+G(0x166),{'action':H(0x161),'data':{'receiverId':f,'isGroup':h,'senderId':Number(e)}}),d[H(0x147)](0xc8)[H(0x151)]({'message':G(0x16a)});}catch(j){return console[H(0x149)](j),d['status'](0x1f4)[G(0x151)]({'error':H(0x146)});}};exports['marcarMensagemNaoLida']=marcarMensagemNaoLida;const listCountUnreadMessage=async(c,d)=>{const I=y,J=z;try{if(I(0x167)!=='FjFuM')e['logger'][I(0x149)](f);else{const {id:f}=c[J(0x169)],g=await(0x0,ListCountUnreadMessage_1['default'])(f);return d[I(0x147)](0xc8)[I(0x151)]({'count':g});}}catch(h){return console[I(0x149)](h),d[I(0x147)](0x1f4)[J(0x151)]({'error':'Ocorreu\x20um\x20erro\x20ao\x20contar\x20as\x20mensagens\x20n√£o\x20lidas.'});}};exports[z(0x164)]=listCountUnreadMessage;function a(){const K=[':mensagem-chat-interno','sender','files','update','timestamp','getTime','listCountUnreadMessage','6875610UmJYvR',':unread-mensagem-chat-interno','FjFuM','all','user','Mensagems\x20marcadas\x20como\x20lida.','ALzus','12704yYBonT','../services/InternalMessage/MessageService','name','111082grABbJ','57vFQJuR','filename','marcarMensagemNaoLida','../utils/logger','2799860iFnKcH','receiverId','ERR_CREATING_MESSAGE_SYSTEM','mimetype','lSXHv','receiver','length','../models/User','__importDefault','body','1603684HKwsfz','../services/InternalMessage/ReadMessageService','wgxzk','aDRZD','originalname','substr','Ocorreu\x20um\x20erro\x20ao\x20marcar\x20a\x20mensagens\x20como\x20lida.','status','3983LScGFV','error','params','742922fzqYwd','findByPk','listarMensagens','default','emit','Ocorreu\x20um\x20erro\x20ao\x20criar\x20a\x20mensagem.','json','DKvHh','defineProperty','chat','logger',':mensagem-chat-interno-notificacao','Ocorreu\x20um\x20erro\x20ao\x20listar\x20as\x20mensagens.','split','true','mediaType','criarMensagem','groupId','7193538zJClOy'];a=function(){return K;};return a();}