'use strict';const I=b,N=b;(function(c,d){const G=b,H=b,e=c();while(!![]){try{const f=parseInt(G(0x1f2))/0x1*(-parseInt(G(0x199))/0x2)+-parseInt(G(0x1be))/0x3+-parseInt(G(0x1a8))/0x4*(parseInt(H(0x1e4))/0x5)+-parseInt(H(0x1a1))/0x6+parseInt(H(0x1c6))/0x7+-parseInt(H(0x1ec))/0x8+parseInt(G(0x1a6))/0x9*(parseInt(H(0x1b9))/0xa);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xb948e));function b(c,d){const e=a();return b=function(f,g){f=f-0x199;let h=e[f];return h;},b(c,d);}var __createBinding=this&&this[I(0x1b4)]||(Object['create']?function(c,d,e,f){const J=I,K=I;if(f===undefined)f=e;var g=Object[J(0x1c3)](d,e);if(!g||(K(0x1e1)in g?!d['__esModule']:g['writable']||g[J(0x202)])){if(K(0x1b8)===J(0x1b8))g={'enumerable':!![],'get':function(){return d[e];}};else{if(e)return s[K(0x1e0)](J(0x1e8),t),u[J(0x1c2)](0x1f4)[J(0x1ad)]('Erro\x20ao\x20exportar\x20contatos');const {BACKEND_URL:i}=c[K(0x1d8)],j=i+':'+p[J(0x1d8)][K(0x1da)]+K(0x1f4)+q;r['send']({'downloadLink':j});}}Object[J(0x1b5)](c,f,g);}:function(c,d,e,f){if(f===undefined)f=e;c[f]=d[e];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(c,d){const L=I,M=I;Object[L(0x1b5)](c,M(0x1f5),{'enumerable':!![],'value':d});}:function(c,d){c['default']=d;}),__importStar=this&&this[I(0x1ca)]||function(c){const O=I;if(c&&c['__esModule'])return c;var d={};if(c!=null){for(var e in c)if(e!=='default'&&Object[O(0x1bd)]['hasOwnProperty']['call'](c,e))__createBinding(d,c,e);}return __setModuleDefault(d,c),d;},__importDefault=this&&this[I(0x1bc)]||function(c){const P=N;return c&&c[P(0x1f7)]?c:{'default':c};};Object[N(0x1b5)](exports,I(0x1f7),{'value':!![]}),exports[N(0x1e2)]=exports['upload']=exports['updateContactWallet']=exports[I(0x1f1)]=exports[I(0x1df)]=exports[N(0x1a9)]=exports[N(0x1f8)]=exports[I(0x200)]=exports[N(0x1c5)]=exports[I(0x1b6)]=void 0x0;const Yup=__importStar(require(N(0x1f3))),lodash_1=require(N(0x1c4)),xlsx_1=__importDefault(require(I(0x1a5))),path_1=__importDefault(require('path')),uuid_1=require(N(0x1ea)),fs_1=__importDefault(require('fs')),ListContactsService_1=__importDefault(require('../services/ContactServices/ListContactsService')),CreateContactService_1=__importDefault(require(N(0x19f))),ShowContactService_1=__importDefault(require(I(0x1b2))),UpdateContactService_1=__importDefault(require(N(0x1ce))),DeleteContactService_1=__importDefault(require(I(0x1b7))),UpdateContactTagsService_1=__importDefault(require('../services/ContactServices/UpdateContactTagsService')),GetProfilePicUrl_1=__importDefault(require(I(0x1c8))),AppError_1=__importDefault(require(N(0x1d4))),UpdateContactWalletsService_1=__importDefault(require(I(0x19e))),Whatsapp_1=__importDefault(require(N(0x1ff))),ImportFileContactsService_1=require('../services/WbotServices/ImportFileContactsService'),Contact_1=__importDefault(require('../models/Contact')),wbot_baileys_1=require(I(0x1c1)),CheckSettings_1=__importDefault(require('../helpers/CheckSettings')),ImportContactsService_1=__importDefault(require('../services/WbotServices/ImportContactsService')),index=async(c,d)=>{const Q=N,R=I,{tenantId:e,id:f,profile:g}=c[Q(0x201)],{searchParam:h,pageNumber:i}=c[Q(0x1d3)],j=await(0x0,CheckSettings_1['default'])(Q(0x1e6));if(g===Q(0x19d)||j===R(0x1fc)){if(Q(0x1fd)===Q(0x1bf))e=f[R(0x1a7)](',');else{const {contacts:l,count:m,hasMore:n}=await(0x0,ListContactsService_1[R(0x1f5)])({'searchParam':h,'pageNumber':i,'tenantId':e,'profile':g,'userId':f});return d[R(0x1b0)]({'contacts':l,'count':m,'hasMore':n});}}else{if(R(0x1fb)!==Q(0x1fb))return g&&h[Q(0x1f7)]?i:{'default':j};else{const {contacts:p,count:q,hasMore:r}=await(0x0,ListContactsService_1[Q(0x1f5)])({'searchParam':h,'pageNumber':i,'tenantId':e,'profile':g,'userId':f});return d[Q(0x1b0)]({'contacts':p,'count':q,'hasMore':r});}}};exports['index']=index;const sync=async(c,d)=>{const S=N,T=I;let {tenantId:e}=c[S(0x201)];const {whatsappId:f}=c['body'];return await(0x0,ImportContactsService_1[S(0x1f5)])(Number(e),f),d[T(0x1c2)](0xc8)['json']({'message':S(0x1ae)});};exports['sync']=sync;const store=async(c,d)=>{const U=N,V=I,{tenantId:e}=c[U(0x201)],f=c[V(0x1ef)];f[V(0x1af)]=f[V(0x1af)][U(0x19b)]('-','')[U(0x19b)]('\x20','')[V(0x19b)]('+',''),console['log']('contact\x20number',f);const g=Yup[U(0x1d9)]()[U(0x1a4)]({'name':Yup[V(0x1e5)]()['required'](),'number':Yup[U(0x1e5)]()[V(0x1cb)]()[U(0x1dd)](/^\d+$/,V(0x204))});try{U(0x1cc)!==U(0x1cc)?e=f[U(0x1a7)]():await g[U(0x1e3)](f);}catch(p){if(U(0x1e7)===V(0x1d1))f={'enumerable':!![],'get':function(){return i[j];}};else throw new AppError_1[(V(0x1f5))](p[V(0x1d0)]);}const h=await Whatsapp_1[U(0x1f5)][U(0x1c0)]({'where':{'status':V(0x1aa),'tenantId':e,'type':'whatsapp'}});if(!h)throw new AppError_1[(U(0x1f5))](V(0x1dc),0x194);const i=(0x0,wbot_baileys_1[U(0x19a)])(h['id']),j=f[U(0x1af)]+U(0x1ba),k=await i['onWhatsApp'](j);if(k[0x0]['exists']==![]){if('tqRDM'===V(0x1c7)){if(n&&o['__esModule'])return p;var s={};if(q!=null){for(var t in r)if(t!==V(0x1f5)&&s[U(0x1bd)]['hasOwnProperty'][V(0x1d5)](t,t))u(s,v,t);}return w(s,x),s;}else throw new AppError_1['default'](U(0x1ee),0x194);}f[U(0x1af)]=k[0x0]['jid'][U(0x1a7)]('@')[0x0];const l=await Contact_1[V(0x1f5)][V(0x1c0)]({'where':{'number':f[U(0x1af)]}});if(l){if(U(0x1a0)==='hzTne')e['default']=f;else return d[V(0x1c2)](0xc8)[V(0x1b0)](l);}const m=await(0x0,GetProfilePicUrl_1[V(0x1f5)])(f[V(0x1af)],e),n=await(0x0,CreateContactService_1['default'])({...f,'number':f[V(0x1af)],'profilePicUrl':m,'tenantId':e});return d[U(0x1c2)](0xc8)[V(0x1b0)](n);};exports['store']=store;const show=async(c,d)=>{const W=I,X=I,{contactId:e}=c[W(0x1ac)],{tenantId:f}=c[X(0x201)],g=await(0x0,ShowContactService_1[W(0x1f5)])({'id':e,'tenantId':f});return d[X(0x1c2)](0xc8)[W(0x1b0)](g);};exports[I(0x1f8)]=show;function a(){const ac=['bOtME','29640TSpPaF','@$s.whatsapp.net','book_append_sheet','__importDefault','prototype','3762432jjFMlz','UhgkG','findOne','../libs/wbot-baileys','status','getOwnPropertyDescriptor','lodash','sync','4025518kUrDcy','XXDCe','../services/WbotServices/GetProfilePicUrl','cLqSU','__importStar','required','rutFT','ZTtAS','../services/ContactServices/UpdateContactService','json_to_sheet','message','foGRQ','EaYEL','query','../errors/AppError','call','utils','writeFile','env','object','PROXY_PORT','buffer','NOT_FOUND_WHATSAPP_CONNECTED','matches','filter','remove','error','get','exportContacts','validate','3292930wkjETu','string','userContactWallet','dDbgn','Erro\x20ao\x20salvar\x20arquivo:','value','uuid','extraInfo','2172952aHyTQR','files','CONTACT_NOT_FOUND','body','mkdirSync','updateContactTags','85645XQiXxe','yup','/public/downloads/','default','name','__esModule','show','yOPqY','Contatos','eCykm','disabled','dfWJu','upload','../models/Whatsapp','store','user','configurable','public','Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.','findAll','10uUKzpG','getWbot','replace','join','admin','../services/ContactServices/UpdateContactWalletsService','../services/ContactServices/CreateContactService','wbYFa','2623788GYspeH','ASC','book_new','shape','xlsx','9819ghFBDM','split','4YrEPrE','update','CONNECTED','Contact\x20deleted','params','send','contacts\x20imported','number','json','updateContactWallet','../services/ContactServices/ShowContactService','JTTcE','__createBinding','defineProperty','index','../services/ContactServices/DeleteContactService'];a=function(){return ac;};return a();}const update=async(c,d)=>{const Y=N,Z=N;let e=c[Y(0x1ef)];const {tenantId:f}=c[Z(0x201)],g=Yup['object']()[Z(0x1a4)]({'name':Yup['string'](),'number':Yup[Y(0x1e5)]()['matches'](/^\d+$/,'Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.')});try{await g[Y(0x1e3)](e);}catch(j){if(Y(0x1cd)!=='OLxES')throw new AppError_1['default'](j[Z(0x1d0)]);else throw new d['default'](Y(0x1ee),0x194);}const {contactId:h}=c['params'];e[Z(0x1eb)]=e[Z(0x1eb)][Y(0x1de)](l=>l[Z(0x1f6)]&&l[Z(0x1e9)]);const i=await(0x0,UpdateContactService_1[Y(0x1f5)])({'contactData':e,'contactId':h,'tenantId':f});return d['status'](0xc8)[Y(0x1b0)](i);};exports[I(0x1a9)]=update;const remove=async(c,d)=>{const a0=I,a1=I,{contactId:e}=c[a0(0x1ac)],{tenantId:f}=c['user'];return await(0x0,DeleteContactService_1['default'])({'id':e,'tenantId':f}),d[a0(0x1c2)](0xc8)[a0(0x1b0)]({'message':a1(0x1ab)});};exports[N(0x1df)]=remove;const updateContactTags=async(c,d)=>{const a2=N,a3=I,{tags:e}=c[a2(0x1ef)],{contactId:f}=c['params'],{tenantId:g}=c[a3(0x201)],h=await(0x0,UpdateContactTagsService_1[a2(0x1f5)])({'tags':e,'contactId':f,'tenantId':g});return d[a3(0x1c2)](0xc8)[a3(0x1b0)](h);};exports['updateContactTags']=updateContactTags;const updateContactWallet=async(c,d)=>{const a4=I,a5=N,{wallets:e}=c['body'],{contactId:f}=c[a4(0x1ac)],{tenantId:g}=c[a4(0x201)],h=await(0x0,UpdateContactWalletsService_1[a5(0x1f5)])({'wallets':e,'contactId':f,'tenantId':g});return d[a5(0x1c2)](0xc8)[a5(0x1b0)](h);};exports[N(0x1b1)]=updateContactWallet;const upload=async(c,d)=>{const a6=N,a7=N,e=c[a6(0x1ed)],f=(0x0,lodash_1['head'])(e),{tenantId:g}=c[a6(0x201)];let {tags:h,wallets:i}=c[a7(0x1ef)];h&&(h=h['split'](','));i&&(a6(0x1f9)===a6(0x1f9)?i=i[a6(0x1a7)]():e['default']['mkdirSync'](f,{'recursive':!![]}));const j=await(0x0,ImportFileContactsService_1['ImportFileContactsService'])(+g,f,h,i);return d[a6(0x1c2)](0xc8)['json'](j);};exports[I(0x1fe)]=upload;const exportContacts=async(c,d)=>{const a8=N,a9=I,{tenantId:e}=c[a8(0x201)],f=await Contact_1['default'][a9(0x205)]({'where':{'tenantId':e},'attributes':['id',a9(0x1f6),'number','email'],'order':[[a9(0x1f6),a8(0x1a2)]],'raw':!![]}),g=xlsx_1[a9(0x1f5)][a8(0x1d6)][a8(0x1a3)](),h=xlsx_1[a9(0x1f5)][a9(0x1d6)][a8(0x1cf)](f);xlsx_1[a8(0x1f5)][a8(0x1d6)][a8(0x1bb)](g,h,a8(0x1fa));const i=xlsx_1[a9(0x1f5)]['write'](g,{'bookType':a8(0x1a5),'type':a9(0x1db)}),j=(0x0,uuid_1['v4'])()+'_contatos.xlsx',k=path_1[a9(0x1f5)][a8(0x19c)](__dirname,'..','..',a8(0x203),'downloads'),l=path_1[a8(0x1f5)][a8(0x19c)](k,j);if(!fs_1[a8(0x1f5)]['existsSync'](k)){if('nQmRB'===a9(0x1c9))return e[a8(0x1c2)](0xc8)[a8(0x1b0)](f);else fs_1['default'][a9(0x1f0)](k,{'recursive':!![]});}fs_1['default'][a9(0x1d7)](l,i,n=>{const aa=a8,ab=a9;if(n){if(aa(0x1b3)===ab(0x1d2))throw new d[(ab(0x1f5))]('NOT_FOUND_WHATSAPP_CONNECTED',0x194);else return console[aa(0x1e0)](aa(0x1e8),n),d[aa(0x1c2)](0x1f4)[aa(0x1ad)]('Erro\x20ao\x20exportar\x20contatos');}const {BACKEND_URL:o}=process[ab(0x1d8)],p=o+':'+process[aa(0x1d8)][ab(0x1da)]+'/public/downloads/'+j;d[aa(0x1ad)]({'downloadLink':p});});};exports['exportContacts']=exportContacts;