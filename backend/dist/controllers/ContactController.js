'use strict';const I=b,J=b;(function(c,d){const G=b,H=b,e=c();while(!![]){try{const f=parseInt(G(0x9b))/0x1*(parseInt(H(0x9a))/0x2)+parseInt(H(0xff))/0x3*(-parseInt(G(0xab))/0x4)+parseInt(G(0xb4))/0x5*(-parseInt(H(0xbd))/0x6)+parseInt(G(0xd3))/0x7*(-parseInt(G(0xde))/0x8)+parseInt(G(0xed))/0x9*(-parseInt(H(0xd7))/0xa)+-parseInt(H(0xd4))/0xb*(-parseInt(G(0x105))/0xc)+parseInt(G(0xf7))/0xd;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x90939));function b(c,d){const e=a();return b=function(f,g){f=f-0x91;let h=e[f];return h;},b(c,d);}var __createBinding=this&&this[I(0xd6)]||(Object[I(0xec)]?function(c,d,e,f){const K=I,L=I;if(f===undefined)f=e;var g=Object[K(0xe1)](d,e);if(!g||(K(0xe3)in g?!d[L(0xe2)]:g[K(0xf3)]||g['configurable'])){if(L(0x9c)!==L(0x102))g={'enumerable':!![],'get':function(){const M=L,N=L;if(M(0xaf)===M(0x94))f={'enumerable':!![],'get':function(){return i[j];}};else return d[e];}};else return f[L(0x99)](L(0xc9),g),h[K(0x91)](0x1f4)[L(0xc0)]('Erro\x20ao\x20exportar\x20contatos');}Object[K(0xe0)](c,f,g);}:function(c,d,e,f){if(f===undefined)f=e;c[f]=d[e];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[J(0xec)]?function(c,d){const O=J,P=J;Object[O(0xe0)](c,P(0xa9),{'enumerable':!![],'value':d});}:function(c,d){const Q=J;c[Q(0xa9)]=d;}),__importStar=this&&this[J(0x100)]||function(c){const R=I,S=J;if(c&&c[R(0xe2)])return c;var d={};if(c!=null){for(var e in c)if(e!=='default'&&Object['prototype'][S(0xc5)][R(0x97)](c,e))__createBinding(d,c,e);}return __setModuleDefault(d,c),d;},__importDefault=this&&this['__importDefault']||function(c){return c&&c['__esModule']?c:{'default':c};};Object[J(0xe0)](exports,J(0xe2),{'value':!![]}),exports[I(0xbc)]=exports['upload']=exports[J(0xd0)]=exports['updateContactTags']=exports[I(0xf4)]=exports[J(0x9e)]=exports[J(0xcd)]=exports[I(0x96)]=exports['sync']=exports[J(0xe7)]=void 0x0;const Yup=__importStar(require('yup')),lodash_1=require(J(0xdc)),xlsx_1=__importDefault(require(J(0xf5))),path_1=__importDefault(require(J(0x9d))),uuid_1=require(I(0x101)),fs_1=__importDefault(require('fs')),ListContactsService_1=__importDefault(require(J(0xee))),CreateContactService_1=__importDefault(require(J(0xb3))),ShowContactService_1=__importDefault(require(I(0xc7))),UpdateContactService_1=__importDefault(require(I(0x103))),DeleteContactService_1=__importDefault(require('../services/ContactServices/DeleteContactService')),UpdateContactTagsService_1=__importDefault(require('../services/ContactServices/UpdateContactTagsService')),GetProfilePicUrl_1=__importDefault(require(I(0xa5))),AppError_1=__importDefault(require('../errors/AppError')),UpdateContactWalletsService_1=__importDefault(require(I(0xaa))),Whatsapp_1=__importDefault(require(I(0xe9))),ImportFileContactsService_1=require(J(0xd5)),Contact_1=__importDefault(require(I(0xcc))),wbot_baileys_1=require(J(0xfd)),CheckSettings_1=__importDefault(require(J(0xb6))),ImportContactsService_1=__importDefault(require(I(0xb8))),index=async(c,d)=>{const T=J,U=I,{tenantId:e,id:f,profile:g}=c['user'],{searchParam:h,pageNumber:i}=c[T(0xa0)],j=await(0x0,CheckSettings_1['default'])(U(0xe8));if(g===U(0xa8)||j===T(0x107)){const {contacts:k,count:l,hasMore:m}=await(0x0,ListContactsService_1['default'])({'searchParam':h,'pageNumber':i,'tenantId':e,'profile':g,'userId':f});return d['json']({'contacts':k,'count':l,'hasMore':m});}else{const {contacts:n,count:o,hasMore:p}=await(0x0,ListContactsService_1[U(0xa9)])({'searchParam':h,'pageNumber':i,'tenantId':e,'profile':g,'userId':f});return d[T(0xe5)]({'contacts':n,'count':o,'hasMore':p});}};exports[J(0xe7)]=index;const sync=async(c,d)=>{const V=I,W=J;let {tenantId:e}=c[V(0xa7)];const {whatsappId:f}=c[W(0xda)];return await(0x0,ImportContactsService_1[V(0xa9)])(Number(e),f),d[W(0x91)](0xc8)[W(0xe5)]({'message':V(0xf8)});};exports['sync']=sync;const store=async(c,d)=>{const X=I,Y=I,{tenantId:e}=c['user'],f=c[X(0xda)];f[X(0xcf)]=f['number'][Y(0xd2)]('-','')['replace']('\x20','')[X(0xd2)]('+',''),console[X(0xc4)](Y(0xea),f);const g=Yup['object']()[X(0xe6)]({'name':Yup[Y(0xc1)]()[X(0xdb)](),'number':Yup['string']()['required']()[X(0xb2)](/^\d+$/,Y(0xdd))});try{await g[Y(0xbf)](f);}catch(o){if(X(0xac)===Y(0xba)){if(n&&o['__esModule'])return p;var q={};if(q!=null){for(var r in r)if(r!==Y(0xa9)&&s[Y(0xb1)][Y(0xc5)]['call'](t,r))u(q,v,r);}return w(q,x),q;}else throw new AppError_1[(Y(0xa9))](o['message']);}const h=await Whatsapp_1[X(0xa9)]['findOne']({'where':{'status':Y(0xf9),'tenantId':e,'type':Y(0xae)}});if(!h){if(X(0x104)===Y(0x104))throw new AppError_1[(Y(0xa9))](Y(0xcb),0x194);else{if(p===q)r=s;var r=t['getOwnPropertyDescriptor'](u,v);(!r||(Y(0xe3)in r?!w[X(0xe2)]:r[X(0xf3)]||r['configurable']))&&(r={'enumerable':!![],'get':function(){return r[F];}}),z[X(0xe0)](A,B,r);}}const i=(0x0,wbot_baileys_1[Y(0xfc)])(h['id']),j=f[Y(0xcf)]+'@$s.whatsapp.net',k=await i[X(0xfb)](j);if(k[0x0]['exists']==![])throw new AppError_1[(Y(0xa9))]('CONTACT_NOT_FOUND',0x194);f[Y(0xcf)]=k[0x0][X(0xa4)][X(0xb7)]('@')[0x0];const l=await Contact_1[Y(0xa9)]['findOne']({'where':{'number':f[X(0xcf)]}});if(l){if('gXuCe'!==Y(0x108))e=f['split']();else return d[X(0x91)](0xc8)['json'](l);}const m=await(0x0,GetProfilePicUrl_1[X(0xa9)])(f[X(0xcf)],e),n=await(0x0,CreateContactService_1[X(0xa9)])({...f,'number':f[Y(0xcf)],'profilePicUrl':m,'tenantId':e});return d[X(0x91)](0xc8)['json'](n);};exports[I(0x96)]=store;const show=async(c,d)=>{const Z=J,a0=J,{contactId:e}=c[Z(0xd9)],{tenantId:f}=c['user'],g=await(0x0,ShowContactService_1['default'])({'id':e,'tenantId':f});return d[a0(0x91)](0xc8)[a0(0xe5)](g);};function a(){const af=['ASC','179307XWkUoF','__importStar','uuid','ipzsD','../services/ContactServices/UpdateContactService','bDErz','4764972MUGQAj','json_to_sheet','disabled','gXuCe','_contatos.xlsx','status','TZIRK','buffer','fDcsN','PROXY_PORT','store','call','mkdirSync','error','1227754krDhtu','1iToadI','gmPEs','path','update','email','query','filter','updateContactTags','Erro\x20ao\x20exportar\x20contatos','jid','../services/WbotServices/GetProfilePicUrl','env','user','admin','default','../services/ContactServices/UpdateContactWalletsService','12YVSFDs','IrnpM','nBLjd','whatsapp','CMqyi','value','prototype','matches','../services/ContactServices/CreateContactService','4243485bSTOgd','book_new','../helpers/CheckSettings','split','../services/WbotServices/ImportContactsService','book_append_sheet','bIUSS','join','exportContacts','6HwCdnI','upload','validate','send','string','/public/downloads/','existsSync','log','hasOwnProperty','RTaLD','../services/ContactServices/ShowContactService','head','Erro\x20ao\x20salvar\x20arquivo:','extraInfo','NOT_FOUND_WHATSAPP_CONNECTED','../models/Contact','show','write','number','updateContactWallet','findAll','replace','4071431KqPzpM','11DTNluK','../services/WbotServices/ImportFileContactsService','__createBinding','20jhuFFK','public','params','body','required','lodash','Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.','16qvwjHv','urTsy','defineProperty','getOwnPropertyDescriptor','__esModule','get','XrbJn','json','shape','index','userContactWallet','../models/Whatsapp','contact\x20number','ImportFileContactsService','create','1028061frspcN','../services/ContactServices/ListContactsService','object','message','name','utils','writable','remove','xlsx','EAZBk','26012415hklvvS','contacts\x20imported','CONNECTED','Contatos','onWhatsApp','getWbot','../libs/wbot-baileys'];a=function(){return af;};return a();}exports[I(0xcd)]=show;const update=async(c,d)=>{const a1=I,a2=I;let e=c[a1(0xda)];const {tenantId:f}=c['user'],g=Yup[a1(0xef)]()['shape']({'name':Yup[a1(0xc1)](),'number':Yup['string']()[a2(0xb2)](/^\d+$/,a2(0xdd))});try{await g[a2(0xbf)](e);}catch(j){throw new AppError_1[(a2(0xa9))](j[a1(0xf0)]);}const {contactId:h}=c[a2(0xd9)];e['extraInfo']=e[a2(0xca)][a2(0xa1)](k=>k['name']&&k[a1(0xb0)]);const i=await(0x0,UpdateContactService_1[a1(0xa9)])({'contactData':e,'contactId':h,'tenantId':f});return d['status'](0xc8)[a2(0xe5)](i);};exports[J(0x9e)]=update;const remove=async(c,d)=>{const a3=I,a4=I,{contactId:e}=c[a3(0xd9)],{tenantId:f}=c[a3(0xa7)];return await(0x0,DeleteContactService_1['default'])({'id':e,'tenantId':f}),d[a4(0x91)](0xc8)[a3(0xe5)]({'message':'Contact\x20deleted'});};exports[I(0xf4)]=remove;const updateContactTags=async(c,d)=>{const a5=I,a6=I,{tags:e}=c[a5(0xda)],{contactId:f}=c[a5(0xd9)],{tenantId:g}=c['user'],h=await(0x0,UpdateContactTagsService_1[a5(0xa9)])({'tags':e,'contactId':f,'tenantId':g});return d[a5(0x91)](0xc8)[a5(0xe5)](h);};exports[J(0xa2)]=updateContactTags;const updateContactWallet=async(c,d)=>{const a7=J,a8=I,{wallets:e}=c[a7(0xda)],{contactId:f}=c['params'],{tenantId:g}=c[a7(0xa7)],h=await(0x0,UpdateContactWalletsService_1[a8(0xa9)])({'wallets':e,'contactId':f,'tenantId':g});return d[a8(0x91)](0xc8)['json'](h);};exports[I(0xd0)]=updateContactWallet;const upload=async(c,d)=>{const a9=J,aa=J,e=c['files'],f=(0x0,lodash_1[a9(0xc8)])(e),{tenantId:g}=c[aa(0xa7)];let {tags:h,wallets:i}=c['body'];h&&(h=h[aa(0xb7)](','));if(i){if(a9(0xad)!==aa(0xc6))i=i[a9(0xb7)]();else{if(k===l)m=n;o[p]=q[r];}}const j=await(0x0,ImportFileContactsService_1[a9(0xeb)])(+g,f,h,i);return d[a9(0x91)](0xc8)[a9(0xe5)](j);};exports[I(0xbe)]=upload;const exportContacts=async(c,d)=>{const ab=I,ac=I,{tenantId:e}=c[ab(0xa7)],f=await Contact_1['default'][ac(0xd1)]({'where':{'tenantId':e},'attributes':['id',ac(0xf1),'number',ac(0x9f)],'order':[[ac(0xf1),ac(0xfe)]],'raw':!![]}),g=xlsx_1[ab(0xa9)][ac(0xf2)][ac(0xb5)](),h=xlsx_1[ab(0xa9)]['utils'][ac(0x106)](f);xlsx_1['default'][ab(0xf2)][ac(0xb9)](g,h,ab(0xfa));const i=xlsx_1[ac(0xa9)][ac(0xce)](g,{'bookType':ab(0xf5),'type':ab(0x93)}),j=(0x0,uuid_1['v4'])()+ab(0x109),k=path_1[ac(0xa9)][ab(0xbb)](__dirname,'..','..',ac(0xd8),'downloads'),l=path_1[ab(0xa9)][ab(0xbb)](k,j);!fs_1['default'][ab(0xc3)](k)&&fs_1[ac(0xa9)][ac(0x98)](k,{'recursive':!![]}),fs_1[ac(0xa9)]['writeFile'](l,i,m=>{const ad=ac,ae=ac;if(ad(0xe4)!==ae(0xf6)){if(m){if(ae(0xdf)===ad(0x92))throw new e[(ae(0xa9))](f['message']);else return console[ad(0x99)](ad(0xc9),m),d[ae(0x91)](0x1f4)[ad(0xc0)](ae(0xa3));}const {BACKEND_URL:n}=process[ad(0xa6)],o=n+':'+process[ae(0xa6)][ad(0x95)]+ad(0xc2)+j;d['send']({'downloadLink':o});}else return g&&h[ad(0xe2)]?i:{'default':j};});};exports[I(0xbc)]=exportContacts;