'use strict';const v=b,x=b;(function(c,d){const t=b,u=b,e=c();while(!![]){try{const f=parseInt(t(0x12e))/0x1*(-parseInt(t(0x154))/0x2)+-parseInt(t(0x118))/0x3+parseInt(u(0x14d))/0x4*(parseInt(u(0x13a))/0x5)+-parseInt(u(0x156))/0x6+parseInt(u(0x136))/0x7+parseInt(u(0x14f))/0x8*(parseInt(t(0x13f))/0x9)+parseInt(u(0x153))/0xa*(parseInt(u(0x123))/0xb);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xd5146));function b(c,d){const e=a();return b=function(f,g){f=f-0x116;let h=e[f];return h;},b(c,d);}var __importDefault=this&&this[v(0x143)]||function(c){const w=v;return c&&c[w(0x12c)]?c:{'default':c};};Object[v(0x130)](exports,'__esModule',{'value':!![]}),exports[v(0x12f)]=exports[v(0x129)]=exports[x(0x14e)]=exports[x(0x146)]=exports[x(0x11b)]=exports[x(0x13c)]=void 0x0;const sequelize_1=require(v(0x150)),socket_1=require(x(0x135)),Message_1=__importDefault(require(x(0x148))),CreateLogTicketService_1=__importDefault(require(v(0x151))),CreateTicketService_1=__importDefault(require(x(0x124))),DeleteTicketService_1=__importDefault(require(x(0x141))),ListTicketsService_1=__importDefault(require('../services/TicketServices/ListTicketsService')),ShowLogTicketService_1=__importDefault(require('../services/TicketServices/ShowLogTicketService')),ShowTicketService_1=__importDefault(require(v(0x11a))),UpdateTicketService_1=__importDefault(require(v(0x14c))),Whatsapp_1=__importDefault(require('../models/Whatsapp')),AppError_1=__importDefault(require('../errors/AppError')),CreateMessageSystemService_1=__importDefault(require(v(0x134))),pupa_1=require(v(0x11e)),Ticket_1=__importDefault(require(x(0x13e))),ListSettingsService_1=__importDefault(require(v(0x119))),index=async(c,d)=>{const y=v,z=x,{tenantId:e,profile:f}=c['user'],{searchParam:g,pageNumber:h,status:i,date:j,showAll:k,withUnreadMessages:l,queuesIds:m,isNotAssignedUser:n,includeNotQueueDefined:o}=c[y(0x144)],p=c[z(0x155)]['id'],{tickets:q,count:r,hasMore:s}=await(0x0,ListTicketsService_1[y(0x131)])({'searchParam':g,'pageNumber':h,'status':i,'date':j,'showAll':k,'userId':p,'withUnreadMessages':l,'queuesIds':m,'isNotAssignedUser':n,'includeNotQueueDefined':o,'tenantId':e,'profile':f});return d[y(0x152)](0xc8)[y(0x117)]({'tickets':q,'count':r,'hasMore':s});};exports['index']=index;const store=async(c,d)=>{const A=x,B=x,{tenantId:e}=c[A(0x155)],{contactId:f,status:g,userId:h,channel:i,channelId:j}=c['body'],k=await Ticket_1[A(0x131)][A(0x126)]({'where':{'contactId':f,[sequelize_1['Op']['or']]:[{'status':A(0x14b)},{'status':A(0x11d)}],'tenantId':e,'channel':i}}),l=await(0x0,ListSettingsService_1[A(0x131)])(e),m=l?.[A(0x142)](o=>{const C=A;return o[C(0x128)]==='NotViewAssignedTickets';})?.[B(0x122)]==='enabled'?'S':'N';if(k&&!!k[B(0x116)]&&k[A(0x116)]!=h&&m=='S'){if(B(0x13d)!==B(0x139))throw new AppError_1[(A(0x131))](B(0x127));else{const p=(0x0,h[B(0x12d)])();p['to'](i+':'+j['status'])[B(0x11f)](k+B(0x147),{'action':'create','ticket':l});}}if(k)return d[A(0x152)](0xc8)[A(0x117)](k);const n=await(0x0,CreateTicketService_1['default'])({'contactId':f,'status':g,'userId':h,'tenantId':e,'channel':i,'channelId':j});if(!h){const p=(0x0,socket_1[B(0x12d)])();p['to'](e+':'+n[A(0x152)])['emit'](e+B(0x147),{'action':B(0x132),'ticket':n});}return d[A(0x152)](0xc8)[A(0x117)](n);};exports[v(0x11b)]=store;const show=async(c,d)=>{const D=v,E=v,{ticketId:e}=c[D(0x121)],{tenantId:f}=c['user'],g=c[D(0x155)]['id'],h=await(0x0,ShowTicketService_1[E(0x131)])({'id':e,'tenantId':f}),i={'contactId':h[E(0x12b)],'scheduleDate':{[sequelize_1['Op'][E(0x11c)]]:null},'status':E(0x11d)},j=await Message_1[D(0x131)]['findAll']({'where':i});return h[E(0x138)](D(0x13b),j),await(0x0,CreateLogTicketService_1[D(0x131)])({'userId':g,'ticketId':e,'type':E(0x140)}),d[D(0x152)](0xc8)[D(0x117)](h);};exports['show']=show;const update=async(c,d)=>{const F=x,G=x,{ticketId:e}=c[F(0x121)],{tenantId:f}=c[G(0x155)],g=c['user']['id'],{isTransference:h}=c[F(0x120)],i={...c[F(0x120)],'tenantId':f},{ticket:j}=await(0x0,UpdateTicketService_1[F(0x131)])({'ticketData':i,'ticketId':e,'isTransference':h,'userIdRequest':g});if(i[G(0x152)]===G(0x125)){const k=await Whatsapp_1[G(0x131)]['findOne']({'where':{'id':j[F(0x149)],'tenantId':f}});if(k?.[G(0x137)]){const l=(0x0,pupa_1['pupa'])(k[G(0x137)]||'',{'protocol':j['protocol'],'name':j['contact'][G(0x133)]}),m={'msg':{'body':l,'fromMe':!![],'read':!![]},'tenantId':f,'ticket':j,'userId':c[G(0x155)]['id'],'sendType':G(0x14a),'status':G(0x11d),'isTransfer':![],'note':![]};await(0x0,CreateMessageSystemService_1['default'])(m),await j[G(0x14e)]({'isFarewellMessage':!![]});}}return d[G(0x152)](0xc8)[G(0x117)](j);};exports[v(0x14e)]=update;const remove=async(c,d)=>{const H=v,I=v,{ticketId:e}=c[H(0x121)],{tenantId:f}=c[H(0x155)],g=c['user']['id'],h=await(0x0,DeleteTicketService_1[H(0x131)])({'id':e,'tenantId':f,'userId':g}),i=(0x0,socket_1[H(0x12d)])();return i['to'](f+':'+h[H(0x152)])['to'](f+':'+e)['to'](f+H(0x12a))[H(0x11f)](f+':ticket',{'action':'delete','ticketId':+e}),d[H(0x152)](0xc8)[H(0x117)]({'message':I(0x145)});};exports[x(0x129)]=remove;const showLogsTicket=async(c,d)=>{const J=x,K=x,{ticketId:e}=c[J(0x121)],f=await(0x0,ShowLogTicketService_1[K(0x131)])({'ticketId':e});return d['status'](0xc8)[J(0x117)](f);};function a(){const L=['hpWGn','../models/Ticket','45BOwBUx','access','../services/TicketServices/DeleteTicketService','find','__importDefault','query','ticket\x20deleted','show',':ticket','../models/Message','whatsappId','bot','open','../services/TicketServices/UpdateTicketService','4RYsizE','update','2477336TjbncJ','sequelize','../services/TicketServices/CreateLogTicketService','status','779630rdHjLE','364ZmJzSZ','user','1807236hAeuea','userId','json','4201623qAQnmu','../services/SettingServices/ListSettingsService','../services/TicketServices/ShowTicketService','store','not','pending','../utils/pupa','emit','body','params','value','55zCkEtA','../services/TicketServices/CreateTicketService','closed','findOne','Ticket\x20já\x20atribuido\x20para\x20outro\x20usuário','key','remove',':notification','contactId','__esModule','getIO','4834HZfZpw','showLogsTicket','defineProperty','default','create','name','../services/MessageServices/CreateMessageSystemService','../libs/socket','3636318MDvYHx','farewellMessage','setDataValue','cvHWE','4983425oOcRFg','scheduledMessages','index'];a=function(){return L;};return a();}exports[v(0x12f)]=showLogsTicket;