'use strict';const A=b,B=b;function a(){const E=['10kPqpHr','whatsapp','urlMessageStatus','body','type','tenantId','../errors/AppError','../libs/wbot-baileys','./../services/ContactServices/CreateContactService','SendMessageAPI','sessionId','add','WebHooksAPI','58535EabbXH','__esModule','pending','../models/Contact','../services/TicketServices/FindOrCreateTicketService','../libs/Queue','516673jwZXNa','getWbot','number','default','518oXXkrq','823971DtTKCn','findOne','apiConfig','972554tCHeru','defineProperty','13816RnqYcs','exists','1823792oQHCgy','update','3980007zQrFdy','198PwmmIr','externalKey'];a=function(){return E;};return a();}function b(c,d){const e=a();return b=function(f,g){f=f-0x10c;let h=e[f];return h;},b(c,d);}(function(c,d){const x=b,y=b,e=c();while(!![]){try{const f=parseInt(x(0x123))/0x1+-parseInt(y(0x12b))/0x2+-parseInt(x(0x128))/0x3+parseInt(x(0x12f))/0x4+-parseInt(y(0x11d))/0x5*(-parseInt(y(0x10e))/0x6)+parseInt(x(0x127))/0x7*(parseInt(y(0x12d))/0x8)+parseInt(x(0x10d))/0x9*(-parseInt(x(0x110))/0xa);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x453c9));var __importDefault=this&&this['__importDefault']||function(c){const z=b;return c&&c[z(0x11e)]?c:{'default':c};};Object[A(0x12c)](exports,B(0x11e),{'value':!![]});const Queue_1=__importDefault(require(B(0x122))),FindOrCreateTicketService_1=__importDefault(require(B(0x121))),CreateMessageSystemService_1=__importDefault(require('../services/MessageServices/CreateMessageSystemService')),wbot_baileys_1=require(B(0x117)),Contact_1=__importDefault(require(A(0x120))),CreateContactService_1=__importDefault(require(A(0x118))),AppError_1=__importDefault(require(B(0x116)));exports[A(0x126)]={'key':A(0x119),'options':{'delay':0x1f4,'attempts':0x1,'removeOnComplete':!![],'removeOnFail':![]},async 'handle'({data:c}){const C=A,D=A,d=(0x0,wbot_baileys_1[C(0x124)])(c[C(0x11a)]);try{const e=c[D(0x125)]+'@$s.whatsapp.net',f=await d['onWhatsApp'](e);if(f[0x0][D(0x12e)]==![])throw new AppError_1['default']('NUMBER_NOT_FOUND',0x194);c[D(0x125)]=f[0x0]['jid']['split']('@')[0x0];let g=await Contact_1[D(0x126)][C(0x129)]({'where':{'number':c[C(0x125)],'tenantId':c['tenantId']}});!g&&(g=await(0x0,CreateContactService_1['default'])({'name':c[C(0x125)],'number':c['number'],'tenantId':c[C(0x115)]}));const h=await(0x0,FindOrCreateTicketService_1['default'])({'contact':g,'whatsappId':d['id'],'unreadMessages':0x0,'tenantId':c['tenantId'],'groupContact':undefined,'channel':C(0x111)});await(0x0,CreateMessageSystemService_1[D(0x126)])({'msg':c,'tenantId':c[C(0x115)],'ticket':h,'sendType':'API','status':C(0x11f)}),await h[C(0x10c)]({'apiConfig':{...c[D(0x12a)],'externalKey':c[C(0x10f)]}});}catch(i){const j={'ack':-0x2,'body':c[D(0x113)],'messageId':'','number':c['number'],'externalKey':c[C(0x10f)],'error':'error\x20session','type':'hookMessageStatus','authToken':c['authToken']};c?.[D(0x12a)]?.['urlMessageStatus']&&Queue_1[D(0x126)][D(0x11b)](C(0x11c),{'url':c[D(0x12a)][C(0x112)],'type':j[D(0x114)],'payload':j});throw new Error(i);}}};