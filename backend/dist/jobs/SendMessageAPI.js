'use strict';const A=b,B=b;(function(c,d){const x=b,y=b,e=c();while(!![]){try{const f=-parseInt(x(0x1f1))/0x1+-parseInt(x(0x1f0))/0x2*(parseInt(x(0x1ee))/0x3)+parseInt(y(0x1d9))/0x4*(parseInt(y(0x1e1))/0x5)+-parseInt(y(0x1fa))/0x6+-parseInt(y(0x1f6))/0x7*(parseInt(y(0x1e7))/0x8)+parseInt(y(0x1dc))/0x9+parseInt(x(0x1ec))/0xa;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xa4d28));var __importDefault=this&&this['__importDefault']||function(c){const z=b;return c&&c[z(0x1db)]?c:{'default':c};};Object[A(0x1f8)](exports,A(0x1db),{'value':!![]});function b(c,d){const e=a();return b=function(f,g){f=f-0x1d7;let h=e[f];return h;},b(c,d);}function a(){const E=['NUMBER_NOT_FOUND','242636DnrdmA','sessionId','__esModule','2409507qjsWdX','../errors/AppError','../models/Contact','default','SendMessageAPI','10HGYtnc','urlMessageStatus','apiConfig','../libs/Queue','externalKey','authToken','8hjpAOW','../services/MessageServices/CreateMessageSystemService','add','./../services/ContactServices/CreateContactService','jid','24217230oYNZsk','WebHooksAPI','1833ETLZVA','body','1130UuhHVG','969923nVCtqf','error\x20session','tenantId','number','@$s.whatsapp.net','2404598onEdoP','getWbot','defineProperty','pending','2862000pYVnlb','../libs/wbot-baileys','type','exists'];a=function(){return E;};return a();}const Queue_1=__importDefault(require(B(0x1e4))),FindOrCreateTicketService_1=__importDefault(require('../services/TicketServices/FindOrCreateTicketService')),CreateMessageSystemService_1=__importDefault(require(B(0x1e8))),wbot_baileys_1=require(A(0x1fb)),Contact_1=__importDefault(require(B(0x1de))),CreateContactService_1=__importDefault(require(B(0x1ea))),AppError_1=__importDefault(require(B(0x1dd)));exports[A(0x1df)]={'key':A(0x1e0),'options':{'delay':0x1f4,'attempts':0x1,'removeOnComplete':!![],'removeOnFail':![]},async 'handle'({data:c}){const C=B,D=A,d=(0x0,wbot_baileys_1[C(0x1f7)])(c[D(0x1da)]);try{const e=c[C(0x1f4)]+D(0x1f5),f=await d['onWhatsApp'](e);if(f[0x0][C(0x1d7)]==![])throw new AppError_1[(D(0x1df))](D(0x1d8),0x194);c[D(0x1f4)]=f[0x0][D(0x1eb)]['split']('@')[0x0];let g=await Contact_1[C(0x1df)]['findOne']({'where':{'number':c[C(0x1f4)],'tenantId':c['tenantId']}});!g&&(g=await(0x0,CreateContactService_1[C(0x1df)])({'name':c[C(0x1f4)],'number':c[C(0x1f4)],'tenantId':c[D(0x1f3)]}));const h=await(0x0,FindOrCreateTicketService_1[D(0x1df)])({'contact':g,'whatsappId':d['id'],'unreadMessages':0x0,'tenantId':c[D(0x1f3)],'groupContact':undefined,'channel':'whatsapp'});await(0x0,CreateMessageSystemService_1[C(0x1df)])({'msg':c,'tenantId':c[D(0x1f3)],'ticket':h,'sendType':'API','status':C(0x1f9)}),await h['update']({'apiConfig':{...c[C(0x1e3)],'externalKey':c[C(0x1e5)]}});}catch(i){const j={'ack':-0x2,'body':c[C(0x1ef)],'messageId':'','number':c[C(0x1f4)],'externalKey':c[C(0x1e5)],'error':C(0x1f2),'type':'hookMessageStatus','authToken':c[C(0x1e6)]};c?.[C(0x1e3)]?.[C(0x1e2)]&&Queue_1['default'][D(0x1e9)](C(0x1ed),{'url':c['apiConfig']['urlMessageStatus'],'type':j[C(0x1fc)],'payload':j});throw new Error(i);}}};