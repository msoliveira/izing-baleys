'use strict';function a(){const s=['update','contactId','key','1790598UZJxhs','./GetTicketWbotBaileys','133RHHfzV','findAll','createdAt','1249808aniiXS','1099049pvfRmP','tenantId','2215248jbywog','../utils/logger','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Maybe\x20whatsapp\x20session\x20disconnected?\x20Err:\x20','contacts:','__importDefault','readMessages','warn','dataJson','cacheLayer','1405290YqBNBP','ticket:update','defineProperty','4730724QIsCKG',':unreads','./socketEmit','forEach','771834qbZHXT','log','__esModule','default'];a=function(){return s;};return a();}const m=b,n=b;(function(c,d){const k=b,l=b,e=c();while(!![]){try{const f=-parseInt(k(0x132))/0x1+-parseInt(k(0x12c))/0x2+parseInt(l(0x125))/0x3+-parseInt(k(0x121))/0x4+parseInt(k(0x11e))/0x5+parseInt(k(0x134))/0x6+-parseInt(k(0x12e))/0x7*(-parseInt(l(0x131))/0x8);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xaa9b9));function b(c,d){const e=a();return b=function(f,g){f=f-0x11e;let h=e[f];return h;},b(c,d);}var __importDefault=this&&this[m(0x138)]||function(c){return c&&c['__esModule']?c:{'default':c};};Object[m(0x120)](exports,n(0x127),{'value':!![]});const cache_1=require('../libs/cache'),Message_1=__importDefault(require('../models/Message')),logger_1=require(m(0x135)),GetTicketWbotBaileys_1=__importDefault(require(m(0x12d))),socketEmit_1=__importDefault(require(m(0x123))),SetTicketMessagesAsRead=async c=>{const o=n,p=n;await c[o(0x129)]({'unreadMessages':0x0}),await cache_1[p(0x13c)]['set'](p(0x137)+c[p(0x12a)]+o(0x122),'0');try{const d=await(0x0,GetTicketWbotBaileys_1[p(0x128)])(c),e=await Message_1['default'][p(0x12f)]({'where':{'ticketId':c['id'],'fromMe':![],'read':![]},'order':[[o(0x130),'DESC']]});e[o(0x124)](async f=>{const q=p,r=p,g=JSON['parse'](f[q(0x13b)]);g[q(0x12b)]&&g[r(0x12b)]['fromMe']===![]&&await d[r(0x139)]([g[q(0x12b)]]);}),await Message_1[p(0x128)]['update']({'read':!![]},{'where':{'ticketId':c['id'],'read':![]}}),(0x0,socketEmit_1['default'])({'tenantId':c[p(0x133)],'type':p(0x11f),'payload':c});}catch(f){console[o(0x126)](f),logger_1['logger'][o(0x13a)](o(0x136)+f);}};exports['default']=SetTicketMessagesAsRead;