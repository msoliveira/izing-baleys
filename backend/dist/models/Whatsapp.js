'use strict';const a2=b,a5=b;function a(){const ak=['tickets','sequelize-typescript','Column','CreateTokenWebHook','AllowNull','JSONB','684080GiGllv','NppcO','tokenAPI','defineProperty','design:type','messenger','default','chatFlowId','now','./Tenant','isDeleted','getOwnPropertyDescriptor','__decorate','Table','all','540716lIhUrN','Method\x20not\x20implemented.','BelongsTo','urlWabahooks','tenant','HookStatus','add','type','env','chatFlow','UpdatedAt','instagram','prototype','jsonwebtoken','lBhAd','UrlWabaWebHook','whatsapp','Unique','/fb-messenger-hooks/','getDataValue','WebHooksAPI','isDefault','../config/auth','number','23100520hvMvPI','function','waba','status','UrlMessengerWebHook','authToken','Default','1484147ngoAKL','TEXT','session','findAll','BeforeUpdate','design:paramtypes','DataType','getstatus','10000d','./Ticket','VIRTUAL','__metadata','7133112vwgkZa','decorate','/wabahooks/','length','BACKEND_URL','isActive','metadata','telegram','3746120gqRQJU','queue_transf','NODE_ENV','createdAt','PrimaryKey','design:returntype','6WtRhCw','map','dev','updatedAt','./ChatFlow','tenantId','BeforeCreate','name','__importDefault','farewellMessage','tokenHook','AfterUpdate','ENUM','AutoIncrement','fbPageId','gupshup','HasMany','__esModule','urlServiceStatus','wabaBSP','../config/webHooks.dev.json','object','8709729opfTDr','is_open_ia','instagramKey','instagramUser','360'];a=function(){return ak;};return a();}(function(c,d){const a0=b,a1=b,e=c();while(!![]){try{const f=parseInt(a0(0x1d9))/0x1+parseInt(a1(0x1ab))/0x2+parseInt(a0(0x1f3))/0x3*(parseInt(a0(0x1ba))/0x4)+-parseInt(a0(0x1ed))/0x5+parseInt(a1(0x1e5))/0x6+parseInt(a0(0x1a0))/0x7+-parseInt(a0(0x1d2))/0x8;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xd9fb7));var __decorate=this&&this[a2(0x1b7)]||function(e,f,g,h){const a3=a2,a4=a2;var j=arguments[a3(0x1e8)],k=j<0x3?f:h===null?h=Object[a3(0x1b6)](f,g):h,l;if(typeof Reflect===a3(0x19f)&&typeof Reflect[a4(0x1e6)]===a4(0x1d3))k=Reflect[a4(0x1e6)](e,f,g,h);else{for(var m=e[a3(0x1e8)]-0x1;m>=0x0;m--)if(l=e[m])k=(j<0x3?l(k):j>0x3?l(f,g,k):l(f,g))||k;}return j>0x3&&k&&Object[a3(0x1ae)](f,g,k),k;},__metadata=this&&this[a2(0x1e4)]||function(c,d){const a6=a2,a7=a5;if(typeof Reflect===a6(0x19f)&&typeof Reflect[a6(0x1eb)]==='function')return Reflect[a7(0x1eb)](c,d);},__importDefault=this&&this[a5(0x1fb)]||function(c){const a8=a5;return c&&c[a8(0x19b)]?c:{'default':c};};Object[a2(0x1ae)](exports,a5(0x19b),{'value':!![]});const jsonwebtoken_1=require(a2(0x1c7)),sequelize_typescript_1=require(a5(0x1a6)),webHooks_dev_json_1=__importDefault(require(a2(0x19e))),auth_1=__importDefault(require(a2(0x1d0))),Queue_1=__importDefault(require('../libs/Queue')),ApiConfig_1=__importDefault(require('./ApiConfig')),Tenant_1=__importDefault(require(a2(0x1b4))),Ticket_1=__importDefault(require(a2(0x1e2))),ChatFlow_1=__importDefault(require(a2(0x1f7)));let Whatsapp=class Whatsapp extends sequelize_typescript_1['Model']{static[a5(0x1e0)](){const a9=a5;throw new Error(a9(0x1bb));}get['UrlWabaWebHook'](){const aa=a2,ab=a5,c=this[aa(0x1cd)](ab(0x1fd)),d=this[aa(0x1cd)](aa(0x19d));let e;return e=process['env']['BACKEND_URL'],process['env'][aa(0x1ef)]===aa(0x1f5)&&(e=webHooks_dev_json_1[ab(0x1b1)][ab(0x1bd)]),e+'/wabahooks/'+d+'/'+c;}get[a5(0x1d6)](){const ac=a2,ad=a2,c=this[ac(0x1cd)](ad(0x1fd));let d;d=process['env'][ac(0x1e9)];if(process[ad(0x1c2)]['NODE_ENV']==='dev'){if('NppcO'!==ac(0x1ac)){const f=this[ad(0x1cd)]('tokenHook'),g=this[ad(0x1cd)](ac(0x19d));let h;return h=f[ac(0x1c2)]['BACKEND_URL'],g['env'][ad(0x1ef)]===ad(0x1f5)&&(h=i['default'][ad(0x1bd)]),h+ad(0x1e7)+g+'/'+f;}else d=webHooks_dev_json_1[ad(0x1b1)][ad(0x1bd)];}return d+ac(0x1cc)+c;}static async[a5(0x1bf)](c){const ae=a2,af=a5,{status:d,name:e,qrcode:f,number:g,tenantId:h,id:i}=c,j={'name':e,'number':g,'status':d,'qrcode':f,'timestamp':Date[ae(0x1b3)](),'type':'hookSessionStatus'},k=await ApiConfig_1[ae(0x1b1)][ae(0x1dc)]({'where':{'tenantId':h,'sessionId':i}});if(!k)return;await Promise[af(0x1b9)](k[af(0x1f4)](l=>{const ag=af,ah=ae;if(l['urlServiceStatus'])return ag(0x1c8)!==ag(0x1c8)?(j['authToken']&&(q[ag(0x1d7)]=r[ag(0x1d7)]),m[ah(0x1b1)][ag(0x1c0)]('WebHooksAPI',{'url':n[ag(0x19c)],'type':o['type'],'payload':p})):(l[ah(0x1d7)]&&(j[ah(0x1d7)]=l[ah(0x1d7)]),Queue_1[ag(0x1b1)][ah(0x1c0)](ah(0x1ce),{'url':l[ah(0x19c)],'type':j[ah(0x1c1)],'payload':j}));}));}static async[a5(0x1a8)](c){const ai=a2,aj=a2,{secret:d}=auth_1[ai(0x1b1)];if(!c?.[aj(0x1fd)]&&(c[ai(0x1c1)]===aj(0x1d4)||c['type']===ai(0x1b0))){const e=(0x0,jsonwebtoken_1['sign'])({'tenantId':c['tenantId'],'whatsappId':c['id']},d,{'expiresIn':aj(0x1e1)});c[ai(0x1fd)]=e;}}};function b(c,d){const e=a();return b=function(f,g){f=f-0x195;let h=e[f];return h;},b(c,d);}__decorate([sequelize_typescript_1[a2(0x1f1)],sequelize_typescript_1[a2(0x197)],sequelize_typescript_1['Column'],__metadata(a2(0x1af),Number)],Whatsapp[a2(0x1c6)],'id',void 0x0),__decorate([sequelize_typescript_1[a2(0x1a9)],sequelize_typescript_1[a2(0x1cb)],(0x0,sequelize_typescript_1[a5(0x1a7)])(sequelize_typescript_1['DataType'][a2(0x1da)]),__metadata(a5(0x1af),String)],Whatsapp[a2(0x1c6)],a5(0x1fa),void 0x0),__decorate([(0x0,sequelize_typescript_1[a5(0x1a7)])(sequelize_typescript_1[a2(0x1df)][a2(0x1da)]),__metadata(a5(0x1af),String)],Whatsapp[a2(0x1c6)],a2(0x1db),void 0x0),__decorate([(0x0,sequelize_typescript_1[a5(0x1a7)])(sequelize_typescript_1[a2(0x1df)][a2(0x1da)]),__metadata(a5(0x1af),String)],Whatsapp['prototype'],'qrcode',void 0x0),__decorate([sequelize_typescript_1[a2(0x1a7)],__metadata('design:type',String)],Whatsapp[a5(0x1c6)],a5(0x1d5),void 0x0),__decorate([sequelize_typescript_1[a2(0x1a7)],__metadata(a5(0x1af),String)],Whatsapp[a5(0x1c6)],'battery',void 0x0),__decorate([sequelize_typescript_1[a5(0x1a7)],__metadata(a5(0x1af),Boolean)],Whatsapp[a2(0x1c6)],'plugged',void 0x0),__decorate([(0x0,sequelize_typescript_1[a2(0x1d8)])(!![]),sequelize_typescript_1[a5(0x1a7)],__metadata('design:type',Boolean)],Whatsapp['prototype'],a5(0x1ea),void 0x0),__decorate([(0x0,sequelize_typescript_1[a5(0x1d8)])(![]),sequelize_typescript_1['Column'],__metadata(a2(0x1af),Boolean)],Whatsapp[a5(0x1c6)],a2(0x1b5),void 0x0),__decorate([sequelize_typescript_1[a5(0x1a7)],__metadata(a5(0x1af),Number)],Whatsapp['prototype'],'retries',void 0x0),__decorate([(0x0,sequelize_typescript_1[a5(0x1d8)])(![]),sequelize_typescript_1[a2(0x1a9)],sequelize_typescript_1[a5(0x1a7)],__metadata(a2(0x1af),Boolean)],Whatsapp['prototype'],a5(0x1cf),void 0x0),__decorate([(0x0,sequelize_typescript_1[a2(0x1d8)])(null),sequelize_typescript_1[a2(0x1a9)],sequelize_typescript_1[a5(0x1a7)],__metadata(a5(0x1af),String)],Whatsapp[a5(0x1c6)],'tokenTelegram',void 0x0),__decorate([(0x0,sequelize_typescript_1['Default'])(null),sequelize_typescript_1['AllowNull'],sequelize_typescript_1[a2(0x1a7)],__metadata(a2(0x1af),String)],Whatsapp[a5(0x1c6)],a2(0x1a3),void 0x0),__decorate([(0x0,sequelize_typescript_1['Default'])(null),sequelize_typescript_1['AllowNull'],sequelize_typescript_1[a2(0x1a7)],__metadata('design:type',String)],Whatsapp[a5(0x1c6)],a5(0x1a2),void 0x0),__decorate([(0x0,sequelize_typescript_1['Default'])(null),sequelize_typescript_1['AllowNull'],sequelize_typescript_1[a5(0x1a7)],__metadata(a2(0x1af),String)],Whatsapp[a5(0x1c6)],a5(0x198),void 0x0),__decorate([(0x0,sequelize_typescript_1[a2(0x1d8)])(null),sequelize_typescript_1['AllowNull'],(0x0,sequelize_typescript_1[a2(0x1a7)])(sequelize_typescript_1[a2(0x1df)][a2(0x1aa)]),__metadata(a5(0x1af),Object)],Whatsapp[a5(0x1c6)],'fbObject',void 0x0),__decorate([(0x0,sequelize_typescript_1[a5(0x1d8)])(a2(0x1ca)),(0x0,sequelize_typescript_1[a2(0x1a7)])(sequelize_typescript_1[a5(0x1df)][a2(0x196)](a5(0x1ca),a2(0x1ec),a5(0x1c5),a2(0x1b0))),__metadata('design:type',String)],Whatsapp['prototype'],'type',void 0x0),__decorate([sequelize_typescript_1['CreatedAt'],__metadata('design:type',Date)],Whatsapp[a5(0x1c6)],a2(0x1f0),void 0x0),__decorate([sequelize_typescript_1[a2(0x1c4)],__metadata(a5(0x1af),Date)],Whatsapp[a2(0x1c6)],a2(0x1f6),void 0x0),__decorate([sequelize_typescript_1['Column'],__metadata(a5(0x1af),Boolean)],Whatsapp[a2(0x1c6)],a5(0x1a1),void 0x0),__decorate([sequelize_typescript_1[a5(0x1a7)],__metadata(a5(0x1af),Number)],Whatsapp['prototype'],a2(0x1ee),void 0x0),__decorate([sequelize_typescript_1[a2(0x1a7)],__metadata(a2(0x1af),String)],Whatsapp[a2(0x1c6)],'color',void 0x0),__decorate([sequelize_typescript_1[a5(0x1a7)],__metadata(a2(0x1af),String)],Whatsapp[a5(0x1c6)],a2(0x1d1),void 0x0),__decorate([(0x0,sequelize_typescript_1['Column'])(sequelize_typescript_1[a2(0x1df)]['JSONB']),__metadata('design:type',Object)],Whatsapp[a2(0x1c6)],'phone',void 0x0),__decorate([(0x0,sequelize_typescript_1[a5(0x19a)])(()=>Ticket_1[a5(0x1b1)]),__metadata(a2(0x1af),Array)],Whatsapp[a5(0x1c6)],a2(0x1a5),void 0x0),__decorate([(0x0,sequelize_typescript_1['ForeignKey'])(()=>Tenant_1[a2(0x1b1)]),sequelize_typescript_1[a5(0x1a7)],__metadata(a5(0x1af),Number)],Whatsapp[a2(0x1c6)],a2(0x1f8),void 0x0),__decorate([(0x0,sequelize_typescript_1[a2(0x1bc)])(()=>Tenant_1[a2(0x1b1)]),__metadata(a2(0x1af),Tenant_1['default'])],Whatsapp[a5(0x1c6)],a2(0x1be),void 0x0),__decorate([(0x0,sequelize_typescript_1['ForeignKey'])(()=>ChatFlow_1[a5(0x1b1)]),sequelize_typescript_1[a2(0x1a7)],__metadata(a5(0x1af),Number)],Whatsapp[a5(0x1c6)],a2(0x1b2),void 0x0),__decorate([(0x0,sequelize_typescript_1[a2(0x1bc)])(()=>ChatFlow_1['default']),__metadata(a5(0x1af),ChatFlow_1[a5(0x1b1)])],Whatsapp[a5(0x1c6)],a5(0x1c3),void 0x0),__decorate([(0x0,sequelize_typescript_1[a5(0x1d8)])(null),sequelize_typescript_1[a2(0x1a9)],(0x0,sequelize_typescript_1[a2(0x1a7)])(sequelize_typescript_1[a2(0x1df)]['ENUM'](a2(0x1a4),a2(0x199))),__metadata(a2(0x1af),String)],Whatsapp['prototype'],a2(0x19d),void 0x0),__decorate([(0x0,sequelize_typescript_1[a2(0x1d8)])(null),sequelize_typescript_1[a5(0x1a9)],(0x0,sequelize_typescript_1[a2(0x1a7)])(sequelize_typescript_1['DataType']['TEXT']),__metadata(a5(0x1af),String)],Whatsapp[a2(0x1c6)],a5(0x1ad),void 0x0),__decorate([(0x0,sequelize_typescript_1[a2(0x1d8)])(null),sequelize_typescript_1[a5(0x1a9)],(0x0,sequelize_typescript_1[a5(0x1a7)])(sequelize_typescript_1[a5(0x1df)][a5(0x1da)]),__metadata(a5(0x1af),String)],Whatsapp[a2(0x1c6)],'tokenHook',void 0x0),__decorate([(0x0,sequelize_typescript_1[a5(0x1d8)])(null),sequelize_typescript_1[a5(0x1a9)],(0x0,sequelize_typescript_1[a5(0x1a7)])(sequelize_typescript_1[a5(0x1df)][a5(0x1da)]),__metadata(a5(0x1af),String)],Whatsapp[a2(0x1c6)],a5(0x1fc),void 0x0),__decorate([(0x0,sequelize_typescript_1['Column'])(sequelize_typescript_1[a5(0x1df)][a2(0x1e3)]),__metadata('design:type',String),__metadata(a5(0x1de),[])],Whatsapp[a5(0x1c6)],a5(0x1c9),null),__decorate([(0x0,sequelize_typescript_1[a5(0x1a7)])(sequelize_typescript_1['DataType']['VIRTUAL']),__metadata(a5(0x1af),String),__metadata('design:paramtypes',[])],Whatsapp[a5(0x1c6)],a5(0x1d6),null),__decorate([sequelize_typescript_1[a5(0x195)],__metadata(a5(0x1af),Function),__metadata('design:paramtypes',[Object]),__metadata('design:returntype',Promise)],Whatsapp,'HookStatus',null),__decorate([sequelize_typescript_1[a5(0x1dd)],sequelize_typescript_1[a5(0x1f9)],__metadata('design:type',Function),__metadata(a5(0x1de),[Whatsapp]),__metadata(a2(0x1f2),Promise)],Whatsapp,a5(0x1a8),null),Whatsapp=__decorate([sequelize_typescript_1[a2(0x1b8)]],Whatsapp),exports[a2(0x1b1)]=Whatsapp;