'use strict';const a2=b,a7=b;(function(c,d){const a0=b,a1=b,e=c();while(!![]){try{const f=parseInt(a0(0x15d))/0x1*(-parseInt(a1(0x134))/0x2)+parseInt(a0(0x149))/0x3*(-parseInt(a1(0x179))/0x4)+-parseInt(a1(0x16a))/0x5*(-parseInt(a0(0x150))/0x6)+parseInt(a1(0x14e))/0x7*(-parseInt(a1(0x171))/0x8)+parseInt(a0(0x183))/0x9*(parseInt(a1(0x164))/0xa)+parseInt(a0(0x15e))/0xb*(-parseInt(a0(0x174))/0xc)+parseInt(a1(0x182))/0xd*(parseInt(a1(0x16f))/0xe);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xed3f4));function b(c,d){const e=a();return b=function(f,g){f=f-0x11f;let h=e[f];return h;},b(c,d);}var __decorate=this&&this[a2(0x162)]||function(e,f,g,h){const a3=a2,a4=a2;var j=arguments[a3(0x13b)],k=j<0x3?f:h===null?h=Object[a3(0x13a)](f,g):h,l;if(typeof Reflect===a4(0x131)&&typeof Reflect[a4(0x126)]===a3(0x159))k=Reflect[a3(0x126)](e,f,g,h);else{for(var m=e[a4(0x13b)]-0x1;m>=0x0;m--)if(l=e[m])k=(j<0x3?l(k):j>0x3?l(f,g,k):l(f,g))||k;}return j>0x3&&k&&Object[a3(0x166)](f,g,k),k;},__metadata=this&&this['__metadata']||function(c,d){const a5=a2,a6=a2;if(typeof Reflect===a5(0x131)&&typeof Reflect[a6(0x180)]===a5(0x159))return Reflect[a6(0x180)](c,d);},__importDefault=this&&this['__importDefault']||function(c){return c&&c['__esModule']?c:{'default':c};};Object[a7(0x166)](exports,a2(0x142),{'value':!![]});const jsonwebtoken_1=require(a7(0x15b)),sequelize_typescript_1=require(a2(0x140)),webHooks_dev_json_1=__importDefault(require(a2(0x136))),auth_1=__importDefault(require(a2(0x147))),Queue_1=__importDefault(require(a2(0x133))),ApiConfig_1=__importDefault(require('./ApiConfig')),Tenant_1=__importDefault(require(a7(0x153))),Ticket_1=__importDefault(require(a7(0x141))),ChatFlow_1=__importDefault(require(a2(0x176)));function a(){const aj=['__decorate','messenger','12406850clYZZr','AfterUpdate','defineProperty','is_open_ia','360','10000d','4845545lGkgvb','HasMany','createdAt','DataType','tenantId','14ChQlca','BACKEND_URL','296AnKrLE','BelongsTo','waba','31860pPRTTQ','prototype','./ChatFlow','status','sign','724VAWDVs','isActive','map','qrcode','TEXT','queue_transf','urlServiceStatus','metadata','design:returntype','16225781COZETZ','9HpBiud','session','AutoIncrement','AllowNull','type','UpdatedAt','CreatedAt','phone','tickets','instagramUser','tenant','instagramKey','gupshup','CreateTokenWebHook','decorate','ENUM','NODE_ENV','BeforeUpdate','VIRTUAL','wabaBSP','BeforeCreate','design:paramtypes','design:type','farewellMessage','getDataValue','object','all','../libs/Queue','478BHYnEk','UrlMessengerWebHook','../config/webHooks.dev.json','Model','whatsapp','JSONB','getOwnPropertyDescriptor','length','findAll','telegram','now','dev','sequelize-typescript','./Ticket','__esModule','Method\x20not\x20implemented.','getstatus','env','UrlWabaWebHook','../config/auth','Table','8691AzOMtI','Unique','tokenAPI','hookSessionStatus','/fb-messenger-hooks/','233639fxIpFi','HookStatus','12hRhDbn','authToken','chatFlowId','./Tenant','urlWabahooks','name','/wabahooks/','tokenHook','number','function','Column','jsonwebtoken','PrimaryKey','7085GYILGB','11sBfeNm','plugged','Default','default'];a=function(){return aj;};return a();}let Whatsapp=class Whatsapp extends sequelize_typescript_1[a7(0x137)]{static[a2(0x144)](){const a8=a2;throw new Error(a8(0x143));}get[a2(0x146)](){const a9=a7,aa=a7,c=this[a9(0x130)](a9(0x157)),d=this['getDataValue'](aa(0x12b));let e;return e=process[a9(0x145)][aa(0x170)],process['env'][aa(0x128)]===a9(0x13f)&&(e=webHooks_dev_json_1[aa(0x161)][a9(0x154)]),e+aa(0x156)+d+'/'+c;}get[a7(0x135)](){const ab=a7,ac=a7,c=this[ab(0x130)]('tokenHook');let d;return d=process[ab(0x145)]['BACKEND_URL'],process['env']['NODE_ENV']==='dev'&&(d=webHooks_dev_json_1[ab(0x161)][ab(0x154)]),d+ab(0x14d)+c;}static async[a2(0x14f)](c){const ad=a2,ae=a2,{status:d,name:e,qrcode:f,number:g,tenantId:h,id:i}=c,j={'name':e,'number':g,'status':d,'qrcode':f,'timestamp':Date[ad(0x13e)](),'type':ad(0x14c)},k=await ApiConfig_1['default'][ae(0x13c)]({'where':{'tenantId':h,'sessionId':i}});if(!k)return;await Promise[ad(0x132)](k[ae(0x17b)](l=>{const af=ae,ag=ad;if(l[af(0x17f)])return l[af(0x151)]&&(j[ag(0x151)]=l['authToken']),Queue_1['default']['add']('WebHooksAPI',{'url':l['urlServiceStatus'],'type':j[af(0x187)],'payload':j});}));}static async[a2(0x125)](c){const ah=a7,ai=a7,{secret:d}=auth_1[ah(0x161)];if(!c?.[ai(0x157)]&&(c['type']===ah(0x173)||c['type']===ah(0x163))){const e=(0x0,jsonwebtoken_1[ah(0x178)])({'tenantId':c[ah(0x16e)],'whatsappId':c['id']},d,{'expiresIn':ai(0x169)});c[ai(0x157)]=e;}}};__decorate([sequelize_typescript_1[a2(0x15c)],sequelize_typescript_1[a2(0x185)],sequelize_typescript_1['Column'],__metadata(a2(0x12e),Number)],Whatsapp[a2(0x175)],'id',void 0x0),__decorate([sequelize_typescript_1[a7(0x186)],sequelize_typescript_1[a7(0x14a)],(0x0,sequelize_typescript_1['Column'])(sequelize_typescript_1['DataType'][a7(0x17d)]),__metadata('design:type',String)],Whatsapp[a2(0x175)],a2(0x155),void 0x0),__decorate([(0x0,sequelize_typescript_1['Column'])(sequelize_typescript_1[a2(0x16d)][a2(0x17d)]),__metadata(a7(0x12e),String)],Whatsapp['prototype'],a2(0x184),void 0x0),__decorate([(0x0,sequelize_typescript_1[a7(0x15a)])(sequelize_typescript_1[a7(0x16d)][a2(0x17d)]),__metadata(a2(0x12e),String)],Whatsapp[a2(0x175)],a2(0x17c),void 0x0),__decorate([sequelize_typescript_1['Column'],__metadata(a2(0x12e),String)],Whatsapp[a7(0x175)],a7(0x177),void 0x0),__decorate([sequelize_typescript_1['Column'],__metadata(a2(0x12e),String)],Whatsapp[a7(0x175)],'battery',void 0x0),__decorate([sequelize_typescript_1['Column'],__metadata(a7(0x12e),Boolean)],Whatsapp[a7(0x175)],a7(0x15f),void 0x0),__decorate([(0x0,sequelize_typescript_1[a7(0x160)])(!![]),sequelize_typescript_1[a2(0x15a)],__metadata(a7(0x12e),Boolean)],Whatsapp['prototype'],a7(0x17a),void 0x0),__decorate([(0x0,sequelize_typescript_1['Default'])(![]),sequelize_typescript_1['Column'],__metadata(a7(0x12e),Boolean)],Whatsapp['prototype'],'isDeleted',void 0x0),__decorate([sequelize_typescript_1[a2(0x15a)],__metadata(a2(0x12e),Number)],Whatsapp[a7(0x175)],'retries',void 0x0),__decorate([(0x0,sequelize_typescript_1['Default'])(![]),sequelize_typescript_1[a7(0x186)],sequelize_typescript_1[a7(0x15a)],__metadata('design:type',Boolean)],Whatsapp[a7(0x175)],'isDefault',void 0x0),__decorate([(0x0,sequelize_typescript_1[a2(0x160)])(null),sequelize_typescript_1['AllowNull'],sequelize_typescript_1[a2(0x15a)],__metadata(a7(0x12e),String)],Whatsapp['prototype'],'tokenTelegram',void 0x0),__decorate([(0x0,sequelize_typescript_1[a7(0x160)])(null),sequelize_typescript_1[a7(0x186)],sequelize_typescript_1[a2(0x15a)],__metadata('design:type',String)],Whatsapp[a7(0x175)],a7(0x121),void 0x0),__decorate([(0x0,sequelize_typescript_1[a7(0x160)])(null),sequelize_typescript_1[a2(0x186)],sequelize_typescript_1['Column'],__metadata(a2(0x12e),String)],Whatsapp[a7(0x175)],a7(0x123),void 0x0),__decorate([(0x0,sequelize_typescript_1[a7(0x160)])(null),sequelize_typescript_1[a7(0x186)],sequelize_typescript_1[a7(0x15a)],__metadata(a7(0x12e),String)],Whatsapp[a2(0x175)],'fbPageId',void 0x0),__decorate([(0x0,sequelize_typescript_1[a2(0x160)])(null),sequelize_typescript_1[a2(0x186)],(0x0,sequelize_typescript_1[a2(0x15a)])(sequelize_typescript_1[a7(0x16d)][a7(0x139)]),__metadata(a2(0x12e),Object)],Whatsapp[a2(0x175)],'fbObject',void 0x0),__decorate([(0x0,sequelize_typescript_1[a7(0x160)])(a7(0x138)),(0x0,sequelize_typescript_1[a7(0x15a)])(sequelize_typescript_1['DataType'][a2(0x127)](a7(0x138),a7(0x13d),'instagram',a7(0x163))),__metadata(a2(0x12e),String)],Whatsapp['prototype'],a2(0x187),void 0x0),__decorate([sequelize_typescript_1[a7(0x189)],__metadata('design:type',Date)],Whatsapp[a2(0x175)],a7(0x16c),void 0x0),__decorate([sequelize_typescript_1[a2(0x188)],__metadata(a7(0x12e),Date)],Whatsapp[a7(0x175)],'updatedAt',void 0x0),__decorate([sequelize_typescript_1[a2(0x15a)],__metadata(a7(0x12e),Boolean)],Whatsapp[a2(0x175)],a2(0x167),void 0x0),__decorate([sequelize_typescript_1[a7(0x15a)],__metadata('design:type',Number)],Whatsapp[a7(0x175)],a7(0x17e),void 0x0),__decorate([sequelize_typescript_1['Column'],__metadata(a2(0x12e),String)],Whatsapp[a7(0x175)],a7(0x158),void 0x0),__decorate([(0x0,sequelize_typescript_1[a2(0x15a)])(sequelize_typescript_1['DataType'][a2(0x139)]),__metadata('design:type',Object)],Whatsapp['prototype'],a7(0x11f),void 0x0),__decorate([(0x0,sequelize_typescript_1[a2(0x16b)])(()=>Ticket_1['default']),__metadata(a7(0x12e),Array)],Whatsapp[a7(0x175)],a2(0x120),void 0x0),__decorate([(0x0,sequelize_typescript_1['ForeignKey'])(()=>Tenant_1[a7(0x161)]),sequelize_typescript_1['Column'],__metadata('design:type',Number)],Whatsapp[a2(0x175)],a2(0x16e),void 0x0),__decorate([(0x0,sequelize_typescript_1[a7(0x172)])(()=>Tenant_1[a7(0x161)]),__metadata(a7(0x12e),Tenant_1[a7(0x161)])],Whatsapp[a7(0x175)],a7(0x122),void 0x0),__decorate([(0x0,sequelize_typescript_1['ForeignKey'])(()=>ChatFlow_1['default']),sequelize_typescript_1[a7(0x15a)],__metadata(a2(0x12e),Number)],Whatsapp[a2(0x175)],a2(0x152),void 0x0),__decorate([(0x0,sequelize_typescript_1['BelongsTo'])(()=>ChatFlow_1['default']),__metadata('design:type',ChatFlow_1[a2(0x161)])],Whatsapp['prototype'],'chatFlow',void 0x0),__decorate([(0x0,sequelize_typescript_1['Default'])(null),sequelize_typescript_1['AllowNull'],(0x0,sequelize_typescript_1[a2(0x15a)])(sequelize_typescript_1[a2(0x16d)]['ENUM'](a7(0x168),a7(0x124))),__metadata(a2(0x12e),String)],Whatsapp[a2(0x175)],'wabaBSP',void 0x0),__decorate([(0x0,sequelize_typescript_1[a2(0x160)])(null),sequelize_typescript_1[a2(0x186)],(0x0,sequelize_typescript_1[a7(0x15a)])(sequelize_typescript_1[a2(0x16d)][a7(0x17d)]),__metadata('design:type',String)],Whatsapp[a2(0x175)],a2(0x14b),void 0x0),__decorate([(0x0,sequelize_typescript_1[a2(0x160)])(null),sequelize_typescript_1[a7(0x186)],(0x0,sequelize_typescript_1['Column'])(sequelize_typescript_1[a2(0x16d)][a2(0x17d)]),__metadata(a2(0x12e),String)],Whatsapp[a7(0x175)],a7(0x157),void 0x0),__decorate([(0x0,sequelize_typescript_1[a2(0x160)])(null),sequelize_typescript_1['AllowNull'],(0x0,sequelize_typescript_1[a7(0x15a)])(sequelize_typescript_1[a2(0x16d)][a7(0x17d)]),__metadata(a7(0x12e),String)],Whatsapp[a2(0x175)],a2(0x12f),void 0x0),__decorate([(0x0,sequelize_typescript_1[a2(0x15a)])(sequelize_typescript_1[a2(0x16d)][a2(0x12a)]),__metadata(a2(0x12e),String),__metadata(a7(0x12d),[])],Whatsapp[a2(0x175)],a2(0x146),null),__decorate([(0x0,sequelize_typescript_1[a7(0x15a)])(sequelize_typescript_1[a7(0x16d)][a7(0x12a)]),__metadata(a7(0x12e),String),__metadata(a2(0x12d),[])],Whatsapp[a2(0x175)],a7(0x135),null),__decorate([sequelize_typescript_1[a2(0x165)],__metadata(a2(0x12e),Function),__metadata('design:paramtypes',[Object]),__metadata(a2(0x181),Promise)],Whatsapp,a7(0x14f),null),__decorate([sequelize_typescript_1[a7(0x129)],sequelize_typescript_1[a2(0x12c)],__metadata(a2(0x12e),Function),__metadata(a2(0x12d),[Whatsapp]),__metadata('design:returntype',Promise)],Whatsapp,a7(0x125),null),Whatsapp=__decorate([sequelize_typescript_1[a7(0x148)]],Whatsapp),exports[a2(0x161)]=Whatsapp;