'use strict';const q=b,r=b;(function(c,d){const o=b,p=b,e=c();while(!![]){try{const f=parseInt(o(0x1b2))/0x1+parseInt(o(0x18f))/0x2+-parseInt(o(0x185))/0x3*(-parseInt(o(0x19d))/0x4)+-parseInt(o(0x197))/0x5+-parseInt(o(0x1b1))/0x6*(-parseInt(o(0x1bb))/0x7)+-parseInt(p(0x1a5))/0x8+-parseInt(p(0x1ae))/0x9;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x81985));function a(){const J=['findByPk','Client\x20joined\x20a\x20ticket\x20channel\x20','IO_REDIS_PORT','tokenInvalid:','84FubAay','../models/User','Rdysj','\x20tickets\x20channel.','handshake','disconnect','qNcOG','socket.io-redis','4142504vmdWuX','emit','Client\x20connected\x20in\x20tenant',':joinChatBox','StELp',':joinTickets','userId','../utils/logger','A\x20client\x20joined\x20notification\x20channel\x20','369891pSQgln','user','update','30HjxtlS','253098njQxiE','data','IO_REDIS_SERVER','Socket\x20IO\x20not\x20initialized','uabSD','name','__esModule','auth','profile','615055LoDePQ','Server','../errors/AppError','__importDefault','use','isValid',':updateStatusUser','tenantId','env','warn','logger','join','connection','A\x20client\x20joined\x20to\x20','zLgAf','114999jgxPrm','initIO','default','./decodeTokenSocket','./socketChat/Chat','toString','yVUXs','BKBAj','defineProperty','token','692836VJOlOA','RUOOl','lastLogin','status',':notification','info','SOCKET\x20Client\x20disconnected\x20,\x20','authentication\x20error','3770505aSKBxX','getIO'];a=function(){return J;};return a();}var __importDefault=this&&this[q(0x1be)]||function(c){return c&&c['__esModule']?c:{'default':c};};Object[r(0x18d)](exports,q(0x1b8),{'value':!![]}),exports[r(0x198)]=exports[q(0x186)]=void 0x0;const socket_io_1=require('socket.io'),socket_io_redis_1=__importDefault(require(r(0x1a4))),AppError_1=__importDefault(require(r(0x1bd))),decodeTokenSocket_1=__importDefault(require(q(0x188))),logger_1=require(q(0x1ac)),User_1=__importDefault(require(r(0x19e))),Chat_1=__importDefault(require(r(0x189)));let io;const initIO=c=>{const s=q,t=r;io=new socket_io_1[(s(0x1bc))](c,{'cors':{'origin':'*'},'pingTimeout':0x2bf20,'pingInterval':0xea60});const d={'host':process[t(0x17e)][s(0x1b4)],'port':Number(process[t(0x17e)][s(0x19b)]),'username':process[t(0x17e)]['IO_REDIS_USERNAME'],'password':process['env']['IO_REDIS_PASSWORD']},e=socket_io_redis_1[t(0x187)];return io['adapter'](e(d)),io[s(0x1bf)](async(f,g)=>{const u=s,v=s;try{if(u(0x184)===u(0x1a3))i[v(0x180)][u(0x194)](v(0x19a)+j+':'+k),l['join'](m+':'+n);else{const i=f?.[v(0x1a1)]?.[v(0x1b9)]?.[v(0x18e)],j=(0x0,decodeTokenSocket_1[v(0x187)])(i);if(j[u(0x1c0)]){if(v(0x18b)==='zGyFr')throw new d[(u(0x187))](v(0x1b5));else{const l=f?.[u(0x1a1)]?.[v(0x1b9)];f[v(0x1a1)][u(0x1b9)]={...l,...j[u(0x1b3)],'id':String(j['data']['id']),'tenantId':String(j[u(0x1b3)]['tenantId'])};const m=await User_1[u(0x187)][v(0x199)](j[v(0x1b3)]['id'],{'attributes':['id',v(0x17d),u(0x1b7),'email',v(0x1ba),v(0x192),v(0x191),'lastOnline']});f['handshake'][v(0x1b9)][u(0x1af)]=m,g();}}g(new Error(u(0x196)));}}catch(n){logger_1[v(0x180)][v(0x17f)]('tokenInvalid:\x20'+f),f[v(0x1a6)]('tokenInvalid:'+f['id']),g(new Error('authentication\x20error'));}}),io['on'](t(0x182),f=>{const w=s,x=s;if(w(0x1a9)===x(0x1a9)){const {tenantId:g}=f[w(0x1a1)]['auth'];g&&(x(0x1b6)!=='uabSD'?f['logger'][w(0x194)]({'message':x(0x195)+g+',\x20'+h}):(logger_1[w(0x180)]['info']({'message':x(0x1a7),'data':f[w(0x1a1)]['auth']}),f['join'](g[w(0x18a)]()),f['on'](g+':userVerified',async i=>{const y=x,z=w;if(y(0x190)!==z(0x18c)){const j=await User_1[y(0x187)][y(0x199)](i[y(0x1ab)]);await j[z(0x1b0)]({'isOnline':!![]}),f[y(0x1a6)](i[z(0x17d)]+z(0x17c),j);}else{if(!f)throw new i[(z(0x187))](z(0x1b5));return h;}}),f['on'](g+w(0x1a8),i=>{const A=w,B=w;A(0x19f)!==A(0x19f)?(i['logger'][A(0x17f)]('tokenInvalid:\x20'+j),k['emit'](B(0x19c)+l['id']),m(new n('authentication\x20error'))):(logger_1[A(0x180)][A(0x194)]('Client\x20joined\x20a\x20ticket\x20channel\x20'+g+':'+i),f[A(0x181)](g+':'+i));}),f['on'](g+':joinNotification',()=>{const C=w,D=x;logger_1[C(0x180)][C(0x194)](C(0x1ad)+g+C(0x193)),f['join'](g+D(0x193));}),f['on'](g+w(0x1aa),i=>{const E=w,F=w;logger_1[E(0x180)]['info'](E(0x183)+g+':'+i+F(0x1a0)),f[E(0x181)](g+':'+i);}),Chat_1[x(0x187)]['register'](f))),f['on'](w(0x1a2),i=>{const G=w,H=w;logger_1[G(0x180)][G(0x194)]({'message':G(0x195)+g+',\x20'+i});});}else return g&&h[x(0x1b8)]?i:{'default':j};}),io;};exports[r(0x186)]=initIO;function b(c,d){const e=a();return b=function(f,g){f=f-0x17c;let h=e[f];return h;},b(c,d);}const getIO=()=>{const I=q;if(!io)throw new AppError_1[(I(0x187))]('Socket\x20IO\x20not\x20initialized');return io;};exports[q(0x198)]=getIO;