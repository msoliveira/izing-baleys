'use strict';const r=b,t=b;(function(c,d){const p=b,q=b,e=c();while(!![]){try{const f=-parseInt(p(0x147))/0x1+-parseInt(q(0x11c))/0x2+-parseInt(p(0x118))/0x3*(parseInt(q(0x128))/0x4)+-parseInt(p(0x148))/0x5+parseInt(q(0x130))/0x6*(-parseInt(p(0x144))/0x7)+-parseInt(p(0x108))/0x8*(parseInt(p(0x126))/0x9)+parseInt(p(0x117))/0xa;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x668ac));var __importDefault=this&&this[r(0x111)]||function(c){const s=r;return c&&c[s(0x129)]?c:{'default':c};};Object[r(0x119)](exports,'__esModule',{'value':!![]}),exports[t(0x134)]=exports[r(0x11a)]=void 0x0;const socket_io_1=require(t(0x12e)),socket_io_redis_1=__importDefault(require(t(0x124))),AppError_1=__importDefault(require(t(0x13c))),decodeTokenSocket_1=__importDefault(require(r(0x115))),logger_1=require(r(0x13d)),User_1=__importDefault(require(r(0x106))),Chat_1=__importDefault(require(r(0x109)));function a(){const L=['socket.io','email','2454coFTxb','Server','BBnAo','warn','getIO','default','tenantId','HuCiZ','data',':notification','handshake','IO_REDIS_PORT','../errors/AppError','../utils/logger','findByPk','A\x20client\x20joined\x20to\x20','A\x20client\x20joined\x20notification\x20channel\x20','Client\x20connected\x20in\x20tenant','WKgoN','logger','8785ROpfdd','status','tokenInvalid:\x20','22000wJhAjw','2158645ZhSVJT','IO_REDIS_SERVER','HETeU','authentication\x20error','tokenInvalid:','SOCKET\x20Client\x20disconnected\x20,\x20','update','gbZhi','profile','../models/User',':joinTickets','19528hqKgBs','./socketChat/Chat','toString','auth','\x20tickets\x20channel.','emit','user','info','IO_REDIS_USERNAME','__importDefault','token','name',':userVerified','./decodeTokenSocket','userId','25366670RdduKi','925503IQoKNF','defineProperty','initIO','UOXLj','661922jlWxmh','isValid','env','Socket\x20IO\x20not\x20initialized','lastOnline',':joinNotification','IO_REDIS_PASSWORD','Kelgk','socket.io-redis','akLZG','1881lDtddi','disconnect','4RYVRrd','__esModule','use','adapter','join','Client\x20joined\x20a\x20ticket\x20channel\x20'];a=function(){return L;};return a();}let io;function b(c,d){const e=a();return b=function(f,g){f=f-0x101;let h=e[f];return h;},b(c,d);}const initIO=c=>{const u=t,v=t;io=new socket_io_1[(u(0x131))](c,{'cors':{'origin':'*'},'pingTimeout':0x2bf20,'pingInterval':0xea60});const d={'host':process[u(0x11e)][u(0x149)],'port':Number(process[u(0x11e)][v(0x13b)]),'username':process[v(0x11e)][v(0x110)],'password':process[v(0x11e)][v(0x122)]},e=socket_io_redis_1[v(0x135)];return io[u(0x12b)](e(d)),io[u(0x12a)](async(f,g)=>{const w=v,x=u;if(w(0x11b)===w(0x132))i['logger']['info'](w(0x13f)+j+':'+k+x(0x10c)),l[x(0x12c)](m+':'+n);else try{if(w(0x125)!==w(0x125))i[w(0x143)][w(0x10f)](w(0x12d)+j+':'+k),l[w(0x12c)](m+':'+n);else{const j=f?.[w(0x13a)]?.[x(0x10b)]?.[w(0x112)],k=(0x0,decodeTokenSocket_1[x(0x135)])(j);if(k[x(0x11d)]){const l=f?.[x(0x13a)]?.['auth'];f[w(0x13a)][w(0x10b)]={...l,...k[x(0x138)],'id':String(k[x(0x138)]['id']),'tenantId':String(k[w(0x138)]['tenantId'])};const m=await User_1['default'][w(0x13e)](k[w(0x138)]['id'],{'attributes':['id',w(0x136),x(0x113),x(0x12f),x(0x105),x(0x145),'lastLogin',x(0x120)]});f['handshake'][x(0x10b)][w(0x10e)]=m,g();}g(new Error(x(0x14b)));}}catch(n){if('Kelgk'!==w(0x123))return g&&h[x(0x129)]?i:{'default':j};else logger_1['logger'][w(0x133)](x(0x146)+f),f[w(0x10d)](x(0x101)+f['id']),g(new Error('authentication\x20error'));}}),io['on']('connection',f=>{const y=u,z=v,{tenantId:g}=f[y(0x13a)][y(0x10b)];g&&(logger_1[z(0x143)][z(0x10f)]({'message':y(0x141),'data':f['handshake'][z(0x10b)]}),f['join'](g[y(0x10a)]()),f['on'](g+z(0x114),async h=>{const A=y,B=z;if(A(0x14a)==='mfJyF')i[A(0x143)][B(0x133)](B(0x146)+j),k[B(0x10d)]('tokenInvalid:'+l['id']),m(new n('authentication\x20error'));else{const j=await User_1[B(0x135)][B(0x13e)](h[B(0x116)]);await j[A(0x103)]({'isOnline':!![]}),f[A(0x10d)](h[B(0x136)]+':updateStatusUser',j);}}),f['on'](g+':joinChatBox',h=>{const C=z;logger_1[C(0x143)]['info']('Client\x20joined\x20a\x20ticket\x20channel\x20'+g+':'+h),f['join'](g+':'+h);}),f['on'](g+z(0x121),()=>{const D=z,E=y;if('tSOZA'===D(0x104)){if(!f)throw new i['default']('Socket\x20IO\x20not\x20initialized');return h;}else logger_1[E(0x143)]['info'](E(0x140)+g+E(0x139)),f['join'](g+E(0x139));}),f['on'](g+z(0x107),h=>{const F=y,G=y;F(0x142)==='bJHGC'?f['logger'][F(0x10f)]({'message':G(0x102)+g+',\x20'+h}):(logger_1[G(0x143)][G(0x10f)](F(0x13f)+g+':'+h+'\x20tickets\x20channel.'),f['join'](g+':'+h));}),Chat_1['default']['register'](f)),f['on'](y(0x127),h=>{const H=y,I=y;H(0x137)!=='HuCiZ'?(g[I(0x143)][H(0x10f)](H(0x140)+h+I(0x139)),i[I(0x12c)](j+I(0x139))):logger_1[H(0x143)][H(0x10f)]({'message':H(0x102)+g+',\x20'+h});});}),io;};exports['initIO']=initIO;const getIO=()=>{const J=t,K=t;if(!io)throw new AppError_1[(J(0x135))](J(0x11f));return io;};exports[t(0x134)]=getIO;