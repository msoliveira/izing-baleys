'use strict';const y=b,z=b;(function(c,d){const v=b,w=b,e=c();while(!![]){try{const f=-parseInt(v(0x14d))/0x1*(-parseInt(w(0x13d))/0x2)+-parseInt(v(0x150))/0x3*(-parseInt(v(0x135))/0x4)+-parseInt(w(0x151))/0x5+parseInt(v(0x146))/0x6*(-parseInt(v(0x132))/0x7)+parseInt(w(0x142))/0x8*(-parseInt(v(0x159))/0x9)+parseInt(v(0x158))/0xa*(-parseInt(v(0x15c))/0xb)+parseInt(w(0x15f))/0xc;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x73f64));function b(c,d){const e=a();return b=function(f,g){f=f-0x131;let h=e[f];return h;},b(c,d);}var __importDefault=this&&this['__importDefault']||function(c){const x=b;return c&&c[x(0x137)]?c:{'default':c};};Object[y(0x13a)](exports,y(0x137),{'value':!![]});const axios_1=__importDefault(require(y(0x14f))),fs_1=require('fs'),path_1=require(y(0x133)),AppError_1=__importDefault(require(z(0x157))),logger_1=require(z(0x143)),downloadFile=async(c,d,e)=>{const A=y,B=z,f=process[A(0x14c)]['API_URL_360']+A(0x148)+d,g=(0x0,path_1[A(0x15b)])(__dirname,'..','..',A(0x141),e),h=await(0x0,axios_1['default'])({'url':f,'method':B(0x136),'responseType':'stream','headers':{'D360-API-KEY':c}});await new Promise((i,j)=>{const C=A,D=B;h[C(0x14b)]['pipe']((0x0,fs_1['createWriteStream'])(g))['on'](D(0x14a),async()=>i(!![]))['on'](C(0x15d),k=>{const E=C;console['error'](E(0x140),k),j(new Error(k));});});},GetMediaWaba360=async({channel:c,msg:d,ticket:e})=>{const F=y,G=z;try{if(F(0x15a)===F(0x15a)){let f='',g,h;d?.['document']&&(F(0x15e)===F(0x149)?j[F(0x14b)][F(0x13b)]((0x0,k[F(0x134)])(l))['on'](G(0x14a),async()=>q(!![]))['on']('error',u=>{const H=F;q[H(0x15d)]('ERROR\x20DONWLOAD',u),r(new s(u));}):(f=d[F(0x14e)]['id']||'',g=d[G(0x14e)]['filename'],h=d['document'][F(0x154)]));if(d?.[G(0x144)]){if(F(0x155)===G(0x155))f=d['image']['id']||'',h=d[F(0x144)][F(0x154)];else{h=i[G(0x153)]['id']||'';const o=j['voice'][G(0x154)]||'',p=o['split'](';');k=p[F(0x160)]>0x1?p[0x0]:l[F(0x153)]['mime_type'];}}if(d?.[F(0x138)]){if(F(0x156)===F(0x156))f=d[G(0x138)]['id']||'',h=d[F(0x138)][F(0x154)];else{g[G(0x145)]['error'](h);throw new i[(F(0x13f))](G(0x139)+j);}}if(d?.[F(0x153)]){f=d['voice']['id']||'';const o=d['voice'][F(0x154)]||'',p=o[G(0x147)](';');h=p[F(0x160)]>0x1?p[0x0]:d[F(0x153)]['mime_type'];}d?.['audio']&&(F(0x131)===F(0x131)?(f=d[G(0x13e)]['id']||'',h=d[F(0x13e)][F(0x154)]):(g=h[G(0x13e)]['id']||'',i=j[G(0x13e)][G(0x154)]));const i=h?.[F(0x147)]('/')[0x1][G(0x147)](';')[0x0],j=new Date()[G(0x13c)](),k=g?g+'_'+e['id']+'_'+f+'_'+j+'.'+i:e['id']+'_'+f+'_'+j+'.'+i;return await downloadFile(c[G(0x152)],f,k),k;}else g=h[F(0x138)]['id']||'',i=j[G(0x138)][G(0x154)];}catch(s){logger_1[F(0x145)]['error'](s);throw new AppError_1[(G(0x13f))](G(0x139)+s);}};function a(){const I=['GET','__esModule','video','360_NOT_DOWNLOAD_MEDIA:\x20','defineProperty','pipe','getTime','4pzbyRu','audio','default','ERROR\x20DONWLOAD','public','2808ekMhEI','../../utils/logger','image','logger','6zjQZoX','split','/v1/media/','IBkrI','finish','data','env','309054fgmGZZ','document','axios','3FaShqA','3709585fkhNwu','tokenAPI','voice','mime_type','EBblB','URUyE','../../errors/AppError','8830090eaBBIe','7308wEoPBO','gtYbR','join','11IjqBDG','error','PqmXO','20161608aazsSS','length','MdCtY','1647415kxHxQj','path','createWriteStream','1288084tARvIV'];a=function(){return I;};return a();}exports[z(0x13f)]=GetMediaWaba360;