'use strict';function a(){const w=['data','nodeList','defineProperty','72xOhKUd','length','interactions','node','flow','1039829SNbTHK','split','findOne','name','1617684AinozX','getTime','util','userId','__esModule','2358608jmdAIV','default','join','media','type','isActive','25fXAYys','1141009OBERcb','154liIeHm','10070307QkdtHg','__importDefault','mediaUrl','celularTeste','2tRtJPd','390345xRWHKO','../../models/ChatFlow','2767530hTrTui','../../errors/AppError','public','update','path','base64'];a=function(){return w;};return a();}function b(c,d){const e=a();return b=function(f,g){f=f-0x8d;let h=e[f];return h;},b(c,d);}const r=b,t=b;(function(c,d){const p=b,q=b,e=c();while(!![]){try{const f=parseInt(p(0x96))/0x1*(-parseInt(q(0x9c))/0x2)+parseInt(p(0x9d))/0x3+-parseInt(p(0x8f))/0x4+-parseInt(p(0x95))/0x5*(parseInt(p(0xb1))/0x6)+parseInt(p(0xad))/0x7*(-parseInt(q(0xa8))/0x8)+parseInt(q(0x98))/0x9+-parseInt(q(0x9f))/0xa*(-parseInt(p(0x97))/0xb);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xacd56));var __importDefault=this&&this[r(0x99)]||function(c){const s=r;return c&&c[s(0x8e)]?c:{'default':c};};Object[t(0xa7)](exports,t(0x8e),{'value':!![]});const util_1=require(r(0xb3)),path_1=require(t(0xa3)),fs_1=require('fs'),ChatFlow_1=__importDefault(require(r(0x9e))),AppError_1=__importDefault(require(t(0xa0))),writeFileAsync=(0x0,util_1['promisify'])(fs_1['writeFile']),UpdateChatFlowService=async({chatFlowData:c,chatFlowId:d,tenantId:e})=>{const u=t,v=r,{name:f,flow:g,userId:h,isActive:i,celularTeste:j}=c,k=await ChatFlow_1[u(0x90)][v(0xaf)]({'where':{'id':d,'tenantId':e},'attributes':['id','name',v(0xac),v(0x8d),'isActive',u(0x9b)]});if(!k)throw new AppError_1['default']('ERR_NO_CHAT_FLOW_FOUND',0x194);for await(const l of g[v(0xac)][u(0xa6)]){if(l['type']===u(0xab))for await(const m of l[v(0xaa)]){if(m['type']==='MediaField'&&m[u(0xa5)][u(0x92)]){const n=new Date()[u(0xb2)]()+'-'+m[u(0xa5)][u(0xb0)];await writeFileAsync((0x0,path_1[v(0x91)])(__dirname,'..','..','..',u(0xa1),n),m[v(0xa5)][u(0x92)][u(0xae)](u(0xa4))[0x1],v(0xa4)),delete m[u(0xa5)][u(0x92)],m['data'][u(0x9a)]=n;}if(m[u(0x93)]==='MediaField'&&m[u(0xa5)][u(0x9a)]){const o=m[v(0xa5)][v(0x9a)][u(0xae)]('/');m['data']['mediaUrl']=o[o[v(0xa9)]-0x1];}}}return await k[v(0xa2)]({'name':f,'flow':g[v(0xac)],'userId':h,'isActive':g['isActive'],'celularTeste':g[u(0x9b)]}),await k['reload']({'attributes':['id',v(0xb0),v(0xac),'userId',v(0x94),v(0x9b)]}),k;};exports[r(0x90)]=UpdateChatFlowService;