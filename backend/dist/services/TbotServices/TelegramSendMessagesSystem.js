'use strict';const u=b,v=b;(function(c,d){const s=b,t=b,e=c();while(!![]){try{const f=-parseInt(s(0x1d0))/0x1*(-parseInt(s(0x1df))/0x2)+-parseInt(s(0x1cb))/0x3*(parseInt(t(0x1bf))/0x4)+parseInt(t(0x1d5))/0x5+-parseInt(s(0x1b9))/0x6+parseInt(t(0x1c4))/0x7+-parseInt(s(0x1c0))/0x8+parseInt(t(0x1d3))/0x9;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x512e6));var __importDefault=this&&this[u(0x1f3)]||function(c){return c&&c['__esModule']?c:{'default':c};};function b(c,d){const e=a();return b=function(f,g){f=f-0x1b9;let h=e[f];return h;},b(c,d);}Object['defineProperty'](exports,u(0x1d4),{'value':!![]});const path_1=require(u(0x1bd)),sequelize_1=require(u(0x1ee)),SetTicketMessagesAsRead_1=__importDefault(require('../../helpers/SetTicketMessagesAsRead')),socketEmit_1=__importDefault(require('../../helpers/socketEmit')),Message_1=__importDefault(require(v(0x1dd))),Ticket_1=__importDefault(require(v(0x1f2))),logger_1=require(u(0x1c6)),SendMessagesSystemWbot=async(c,d)=>{const w=v,x=u,e={'fromMe':!![],'messageId':{[sequelize_1['Op']['is']]:null},'status':w(0x1e4),[sequelize_1['Op']['or']]:[{'scheduleDate':{[sequelize_1['Op'][w(0x1ba)]]:new Date()}},{'scheduleDate':{[sequelize_1['Op']['is']]:null}}]},f=await Message_1[w(0x1ec)][x(0x1ef)]({'where':e,'include':[w(0x1cc),{'model':Ticket_1['default'],'as':w(0x1da),'where':{'tenantId':d,[sequelize_1['Op']['or']]:{'status':{[sequelize_1['Op']['ne']]:x(0x1d7)},'isFarewellMessage':!![]},'channel':'telegram','whatsappId':c['id']},'include':[x(0x1cc)]},{'model':Message_1[w(0x1ec)],'as':x(0x1ce),'include':[w(0x1cc)]}],'order':[[x(0x1c3),x(0x1d8)]]});let g;for(const h of f){const i=h,{ticket:j}=i,k=j['contact']['telegramId'],l={};i['quotedMsg']&&(l[x(0x1e0)]=i[x(0x1ce)][w(0x1d9)]);try{if(![x(0x1dc),w(0x1eb)][x(0x1db)](i['mediaType'])&&i[w(0x1e6)]){const n=(0x0,path_1[w(0x1e2)])(__dirname,'..','..','..',w(0x1e8)),o=(0x0,path_1[w(0x1e2)])(n,i[x(0x1e6)]);if(i[w(0x1e5)]===w(0x1d6)||i[w(0x1e5)]===w(0x1e9))g=await c[x(0x1c7)][x(0x1f0)](k,{'source':o},l);else{if(i[x(0x1e5)]===x(0x1bc))g=await c[w(0x1c7)][x(0x1c5)](k,{'source':o},l);else i['mediaType']===x(0x1e7)?g=await c[w(0x1c7)][w(0x1ed)](k,{'source':o},l):g=await c[x(0x1c7)]['sendDocument'](k,{'source':o},l);}logger_1[w(0x1e3)][x(0x1cf)](w(0x1de));}else g=await c[w(0x1c7)]['sendMessage'](k,i[w(0x1c9)],l),logger_1['logger']['info'](x(0x1be));const m={...i,...g,'id':i['id'],'timestamp':g['date']*0x3e8,'messageId':g['message_id'],'status':x(0x1bb),'ack':0x2};await Message_1[w(0x1ec)][w(0x1ca)]({...m},{'where':{'id':i['id']}}),(0x0,socketEmit_1[w(0x1ec)])({'tenantId':j['tenantId'],'type':w(0x1ea),'payload':{...i[x(0x1e1)],'id':i['id'],'mediaUrl':i[w(0x1cd)],'timestamp':m[w(0x1f1)],'messageId':g[w(0x1c2)],'status':x(0x1bb),'ack':0x2}}),logger_1[x(0x1e3)][x(0x1cf)](x(0x1d2)),await(0x0,SetTicketMessagesAsRead_1[x(0x1ec)])(j);}catch(p){const q=i['id'],r=i[w(0x1da)]['id'];logger_1[x(0x1e3)][x(0x1c1)]('Error\x20message\x20is\x20(tenant:\x20'+d+w(0x1c8)+r+')'),logger_1[x(0x1e3)][x(0x1c1)](x(0x1d1)+q+')::\x20'+p);}}};exports[u(0x1ec)]=SendMessagesSystemWbot;function a(){const y=['ASC','messageId','ticket','includes','chat','../../models/Message','sendMessage\x20media','3908aqvBsc','reply_to_message_id','dataValues','join','logger','pending','mediaType','mediaName','video','public','ptt','chat:ack','text','default','sendVideo','sequelize','findAll','sendVoice','timestamp','../../models/Ticket','__importDefault','687924ofcXUz','lte','sended','image','path','sendMessage\x20text','368bUObFf','3658264SjeIIE','error','message_id','createdAt','3353133xdCxFZ','sendPhoto','../../utils/logger','telegram','\x20|\x20Ticket:\x20','body','update','6468mEZhoN','contact','mediaUrl','quotedMsg','info','109IUvVBu','Error\x20send\x20message\x20(id:\x20','Message\x20Update\x20ok','1815057UTEjzj','__esModule','1045645OpmtZl','audio','closed'];a=function(){return y;};return a();}