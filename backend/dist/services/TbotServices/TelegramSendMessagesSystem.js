'use strict';function b(c,d){const e=a();return b=function(f,g){f=f-0x17c;let h=e[f];return h;},b(c,d);}const u=b,w=b;(function(c,d){const s=b,t=b,e=c();while(!![]){try{const f=parseInt(s(0x1a7))/0x1*(-parseInt(s(0x1ac))/0x2)+parseInt(t(0x17d))/0x3+-parseInt(s(0x196))/0x4*(-parseInt(t(0x1b2))/0x5)+-parseInt(t(0x1a9))/0x6*(-parseInt(s(0x183))/0x7)+parseInt(t(0x194))/0x8+parseInt(t(0x17c))/0x9+-parseInt(s(0x1ad))/0xa;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xeb9f4));var __importDefault=this&&this[u(0x18d)]||function(c){const v=u;return c&&c[v(0x184)]?c:{'default':c};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const path_1=require(w(0x1ab)),sequelize_1=require('sequelize'),SetTicketMessagesAsRead_1=__importDefault(require(u(0x185))),socketEmit_1=__importDefault(require(u(0x1b0))),Message_1=__importDefault(require(w(0x1b3))),Ticket_1=__importDefault(require(u(0x1a6))),logger_1=require(w(0x18e)),SendMessagesSystemWbot=async(c,d)=>{const x=w,y=u,e={'fromMe':!![],'messageId':{[sequelize_1['Op']['is']]:null},'status':x(0x19b),[sequelize_1['Op']['or']]:[{'scheduleDate':{[sequelize_1['Op']['lte']]:new Date()}},{'scheduleDate':{[sequelize_1['Op']['is']]:null}}]},f=await Message_1[y(0x180)][x(0x1a5)]({'where':e,'include':[y(0x1b6),{'model':Ticket_1['default'],'as':'ticket','where':{'tenantId':d,[sequelize_1['Op']['or']]:{'status':{[sequelize_1['Op']['ne']]:'closed'},'isFarewellMessage':!![]},'channel':y(0x189),'whatsappId':c['id']},'include':[x(0x1b6)]},{'model':Message_1[y(0x180)],'as':y(0x19d),'include':[y(0x1b6)]}],'order':[[x(0x18c),y(0x18a)]]});let g;for(const h of f){const i=h,{ticket:j}=i,k=j[y(0x1b6)]['telegramId'],l={};i[y(0x19d)]&&(l[x(0x1af)]=i[y(0x19d)][y(0x17e)]);try{if(![y(0x190),y(0x1a2)][y(0x197)](i['mediaType'])&&i[y(0x1b1)]){const n=(0x0,path_1['join'])(__dirname,'..','..','..',x(0x195)),o=(0x0,path_1[y(0x198)])(n,i['mediaName']);if(i[y(0x182)]===x(0x1a8)||i[x(0x182)]===x(0x19e))g=await c[y(0x189)]['sendVoice'](k,{'source':o},l);else{if(i[x(0x182)]===y(0x1aa))g=await c[x(0x189)][x(0x199)](k,{'source':o},l);else i[x(0x182)]===x(0x187)?g=await c[x(0x189)][y(0x1a1)](k,{'source':o},l):g=await c[y(0x189)][x(0x191)](k,{'source':o},l);}logger_1[y(0x181)][x(0x1b5)](x(0x18b));}else g=await c[x(0x189)]['sendMessage'](k,i['body'],l),logger_1[y(0x181)][x(0x1b5)](x(0x1ae));const m={...i,...g,'id':i['id'],'timestamp':g[y(0x1b4)]*0x3e8,'messageId':g[y(0x186)],'status':'sended','ack':0x2};await Message_1[y(0x180)][x(0x192)]({...m},{'where':{'id':i['id']}}),(0x0,socketEmit_1[x(0x180)])({'tenantId':j[x(0x19a)],'type':x(0x18f),'payload':{...i[x(0x1a3)],'id':i['id'],'mediaUrl':i[y(0x19c)],'timestamp':m[x(0x188)],'messageId':g[x(0x186)],'status':y(0x17f),'ack':0x2}}),logger_1[y(0x181)][y(0x1b5)](x(0x1a4)),await(0x0,SetTicketMessagesAsRead_1[x(0x180)])(j);}catch(p){const q=i['id'],r=i['ticket']['id'];logger_1['logger'][y(0x1a0)](y(0x19f)+d+x(0x193)+r+')'),logger_1[x(0x181)][x(0x1a0)]('Error\x20send\x20message\x20(id:\x20'+q+')::\x20'+p);}}};function a(){const z=['text','dataValues','Message\x20Update\x20ok','findAll','../../models/Ticket','151LGFPEB','audio','6990570rCbNxL','image','path','22484kBdNgM','44234420ukapHP','sendMessage\x20text','reply_to_message_id','../../helpers/socketEmit','mediaName','16885IFuYZw','../../models/Message','date','info','contact','7790076vjyBvw','5591541fJjuWU','messageId','sended','default','logger','mediaType','7FlbVbT','__esModule','../../helpers/SetTicketMessagesAsRead','message_id','video','timestamp','telegram','ASC','sendMessage\x20media','createdAt','__importDefault','../../utils/logger','chat:ack','chat','sendDocument','update','\x20|\x20Ticket:\x20','12808152ZIjBTc','public','1884iRGfhq','includes','join','sendPhoto','tenantId','pending','mediaUrl','quotedMsg','ptt','Error\x20message\x20is\x20(tenant:\x20','error','sendVideo'];a=function(){return z;};return a();}exports['default']=SendMessagesSystemWbot;