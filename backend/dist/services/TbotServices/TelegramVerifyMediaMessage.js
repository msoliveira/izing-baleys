'use strict';const w=b,y=b;function b(c,d){const e=a();return b=function(f,g){f=f-0x77;let h=e[f];return h;},b(c,d);}(function(c,d){const u=b,v=b,e=c();while(!![]){try{const f=-parseInt(u(0x81))/0x1*(-parseInt(v(0xaf))/0x2)+parseInt(u(0x7e))/0x3+parseInt(u(0x9c))/0x4+parseInt(u(0x77))/0x5*(parseInt(u(0xa7))/0x6)+-parseInt(u(0x94))/0x7*(-parseInt(u(0xa1))/0x8)+parseInt(u(0x97))/0x9+-parseInt(v(0x93))/0xa;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xef417));var __importDefault=this&&this[w(0x85)]||function(c){const x=w;return c&&c[x(0x7b)]?c:{'default':c};};Object[y(0x8c)](exports,w(0x7b),{'value':!![]});const path_1=require('path'),util_1=require(y(0x9e)),fs_1=require('fs'),axios_1=__importDefault(require('axios')),CreateMessageService_1=__importDefault(require(w(0x88))),logger_1=require(w(0x91)),getQuotedForMessageId_1=__importDefault(require(w(0x8e))),writeFileAsync=(0x0,util_1['promisify'])(fs_1[y(0x8b)]),getMediaInfo=c=>{const z=y,A=y,d=c['photo']?'photo':c[z(0x99)]?A(0x99):c['audio']?'audio':c[A(0xa3)]?'voice':c[A(0x79)]&&!c[A(0x79)][A(0xa8)]?A(0x79):A(0x8a),e=c[d],[f,g,h,i,j,k,l]=[d,e[A(0x82)]?e[A(0x82)]:'',![],null,e[z(0x89)]?e[A(0x89)]:e[e[A(0x9d)]-0x1][A(0x89)],c[A(0xa2)]?c['caption']:'',d==z(0xa3)];switch(d){case z(0x7f):return{'type':f,'mimeType':A(0xb2),'SAD':h,'fileName':i,'fileId':j,'caption':k,'SAV':l};break;case A(0x99):return{'type':f,'mimeType':g,'SAD':h,'fileName':i,'fileId':j,'caption':k,'SAV':l};break;case z(0x98):return{'type':f,'mimeType':g,'SAD':h,'fileName':i,'fileId':j,'caption':k,'SAV':l};break;case z(0xa3):return{'type':f,'mimeType':g,'SAD':h,'fileName':i,'fileId':j,'caption':k,'SAV':l};break;case z(0x79):return{'type':f,'mimeType':z(0x80),'SAD':h,'fileName':i,'fileId':j,'caption':k,'SAV':l,'SAS':!![]};break;default:return{'type':f,'mimeType':g,'SAD':!![],'fileName':e[A(0x9a)]?e[A(0x9a)]:null,'fileId':j,'caption':k,'SAV':l};break;}},downloadFile=async(c,d)=>{const B=y,C=y,e=await(0x0,axios_1['default'])({'url':c[B(0x9b)](),'method':C(0x92),'responseType':'stream'});await new Promise((f,g)=>{const D=B,E=B;D(0x9f)===D(0x7d)?e=f?.[E(0xae)]:e[D(0x8d)][D(0x83)]((0x0,fs_1[E(0xa0)])(d))['on']('finish',async()=>f(!![]))['on'](E(0x90),i=>{const F=D;console[F(0x90)]('ERROR\x20DONWLOAD',i),g(new Error(i));});});},VerifyMediaMessage=async(c,d,e,f)=>{const G=y,H=w;let g,h={};g=c?.[G(0xa9)],h=c?.['update'];!g&&h&&(g=h?.['edited_message']);const i=await getMediaInfo(g),j=await c[G(0xb4)][H(0xab)](i[H(0xa5)]);if(!j){if(H(0xb3)==='YdGeX'){e[G(0xa6)]['error'](G(0xaa)+f[G(0xa4)]);return;}else{logger_1['logger'][G(0x90)]('ERR_DOWNLOAD_MEDIA::\x20ID:\x20'+g[H(0xa4)]);return;}}const k=i[H(0x78)][G(0x7a)]('/')[0x1][G(0x7a)](';')[0x0],l=j[H(0x89)]+'_'+new Date()[H(0xb1)]()+'.'+k,m=(0x0,path_1['join'])(__dirname,'..','..','..',G(0x7c),l),n=await c[G(0xb4)][H(0xb0)](i['fileId']);await downloadFile(n,m);let o;if(g?.['reply_to_message']?.[G(0xa4)]){const s=await(0x0,getQuotedForMessageId_1[G(0x86)])(g[H(0x95)][G(0xa4)],e[H(0x8f)]);o=s?.['id']||undefined;}const p={'messageId':String(g?.[G(0xa4)]),'ticketId':e['id'],'contactId':d?undefined:f['id'],'body':g[H(0x96)]||g[H(0xa2)]||l,'fromMe':d,'read':d,'mediaUrl':l,'mediaType':i[G(0x78)]['split']('/')[0x0],'quotedMsgId':o,'timestamp':+g[G(0xac)]*0x3e8,'status':d?G(0xad):G(0x87)};await e[H(0x84)]({'lastMessage':g[G(0x96)]||g[H(0xa2)]||l,'lastMessageAt':new Date()[H(0xb1)](),'answered':d||![]});const q=await(0x0,CreateMessageService_1[H(0x86)])({'messageData':p,'tenantId':e[H(0x8f)]});return q;};exports[w(0x86)]=VerifyMediaMessage;function a(){const I=['error','../../utils/logger','GET','42775370HIpwjR','3997aVBFfi','reply_to_message','text','14889042qxQayH','audio','video','file_name','toString','310420ChYhNB','length','util','JjCaS','createWriteStream','15304typQiv','caption','voice','message_id','fileId','logger','78GSScJb','is_animated','message','ERR_DOWNLOAD_MEDIA::\x20ID:\x20','getFile','date','sended','edited_message','9150UUJvri','getFileLink','getTime','image/png','srPHK','telegram','129975LSrCEi','mimeType','sticker','split','__esModule','public','feaqz','1029306SnliFR','photo','image/webp','383gHrtaY','mime_type','pipe','update','__importDefault','default','received','../MessageServices/CreateMessageService','file_id','document','writeFile','defineProperty','data','../../helpers/getQuotedForMessageId','tenantId'];a=function(){return I;};return a();}