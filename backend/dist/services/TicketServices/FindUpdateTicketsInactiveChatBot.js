'use strict';const m=b,o=b;function b(c,d){const e=a();return b=function(f,g){f=f-0x130;let h=e[f];return h;},b(c,d);}(function(c,d){const k=b,l=b,e=c();while(!![]){try{const f=-parseInt(k(0x147))/0x1+-parseInt(l(0x14a))/0x2*(-parseInt(l(0x134))/0x3)+parseInt(k(0x13b))/0x4*(-parseInt(l(0x13f))/0x5)+-parseInt(l(0x14c))/0x6*(parseInt(k(0x133))/0x7)+parseInt(l(0x140))/0x8+-parseInt(k(0x137))/0x9*(-parseInt(k(0x145))/0xa)+parseInt(k(0x13d))/0xb*(parseInt(l(0x144))/0xc);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x8d984));function a(){const t=['7267733KQedNy','defineProperty','320WGaVFu','1749912MlBDDE','../../helpers/socketEmit','default','../../models/Ticket','24glwrtQ','170quLTIK','userId','1019903CJWsyG','sequelize','map','2242CVuRsz','\x0a\x20\x20\x20\x20select\x0a\x20\x20\x20\x20t.id,\x0a\x20\x20\x20\x20--t.\x22contactId\x22,\x0a\x20\x20\x20\x20--t.\x22lastInteractionBot\x22,\x0a\x20\x20\x20\x20--t.status,\x0a\x20\x20\x20\x20--config->\x27configurations\x27,\x0a\x20\x20\x20\x20--concat(config->\x27configurations\x27->\x27notResponseMessage\x27->\x27time\x27,\x20\x27\x20MINUTES\x27)::interval\x20as\x20time_action,\x0a\x20\x20\x20\x20config->\x27configurations\x27->\x27notResponseMessage\x27->\x27type\x27\x20as\x20type_action,\x0a\x20\x20\x20\x20config->\x27configurations\x27->\x27notResponseMessage\x27->\x27destiny\x27\x20as\x20destiny\x0a\x20\x20\x20\x20from\x20\x22Tickets\x22\x20t\x0a\x20\x20\x20\x20inner\x20join\x20\x22ChatFlow\x22\x20cf\x20on\x20t.\x22tenantId\x22\x20=\x20cf.\x22tenantId\x22\x20and\x20cf.id\x20=\x20t.\x22chatFlowId\x22\x0a\x20\x20\x20\x20inner\x20join\x20\x22Settings\x22\x20s\x20on\x20s.\x22tenantId\x22\x20=\x20cf.\x22tenantId\x22\x20and\x20s.\x22key\x22\x20=\x20\x27botTicketActive\x27\x0a\x20\x20\x20\x20cross\x20join\x20lateral\x20json_array_elements(cf.flow->\x27nodeList\x27)\x20as\x20config\x0a\x20\x20\x20\x20where\x20t.\x22chatFlowId\x22::text\x20=\x20s.value\x0a\x20\x20\x20\x20and\x20t.status\x20=\x20\x27pending\x27\x0a\x20\x20\x20\x20and\x20config->>\x27type\x27\x20=\x20\x27configurations\x27\x0a\x20\x20\x20\x20and\x20t.\x22lastInteractionBot\x22\x20<\x20CURRENT_TIMESTAMP\x20-\x20concat(config->\x27configurations\x27->\x27notResponseMessage\x27->\x27time\x27,\x20\x27\x20MINUTES\x27)::interval\x0a\x20\x20\x20\x20and\x20(t.\x22queueId\x22\x20is\x20null\x20and\x20t.\x22userId\x22\x20is\x20null)\x0a\x20\x20','6kCIOYI','queueId','QueryTypes','type_action','query','5798429tBzldw','591kXcWQa','ticket:update','destiny','560808IXuQKd','__esModule','findByPk','all','24504DmJpbd','__importDefault'];a=function(){return t;};return a();}var __importDefault=this&&this[m(0x13c)]||function(c){const n=m;return c&&c[n(0x138)]?c:{'default':c};};Object[o(0x13e)](exports,m(0x138),{'value':!![]});const sequelize_1=require(o(0x148)),Ticket_1=__importDefault(require(o(0x143))),socketEmit_1=__importDefault(require(m(0x141))),FindUpdateTicketsInactiveChatBot=async()=>{const p=o,q=m,c=p(0x14b),d=await Ticket_1[q(0x142)][q(0x148)]?.[p(0x132)](c,{'type':sequelize_1[q(0x130)]['SELECT']});Promise[q(0x13a)](d[p(0x149)](async e=>{const r=p,s=q;if(!e['destiny'])return;const f=await Ticket_1['default'][r(0x139)](e['id']);if(f){const g={'chatFlowId':null,'stepChatFlow':null,'botRetries':0x0,'lastInteractionBot':new Date()};e[r(0x131)]==0x1&&(g[r(0x14d)]=e[s(0x136)]),e[r(0x131)]==0x2&&(g[s(0x146)]=e[r(0x136)]),await f['update'](g),(0x0,socketEmit_1[r(0x142)])({'tenantId':f['tenantId'],'type':s(0x135),'payload':f});}}));};exports[o(0x142)]=FindUpdateTicketsInactiveChatBot;