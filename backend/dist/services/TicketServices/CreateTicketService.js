'use strict';const n=b,p=b;function a(){const s=['../../helpers/CheckContactOpenTickets','ticket','instagram','__importDefault','__esModule','default','15548FsQFbX','./ShowTicketService','102NgNSgR','267831SUgqUc','ERR_CREATING_TICKET','56495Lmodwu','1172071QJHPQi','129TqlUpy','../../helpers/socketEmit','ticket:update','3833552CECIWF','5027352ZbgKqJ','defineProperty','create','../../helpers/GetDefaultWhatsApp','30MhHUOL','whatsapp','7785729OGrdsT'];a=function(){return s;};return a();}(function(c,d){const l=b,m=b,e=c();while(!![]){try{const f=parseInt(l(0x1e8))/0x1+-parseInt(m(0x1e2))/0x2*(-parseInt(l(0x1e9))/0x3)+-parseInt(m(0x1d5))/0x4+parseInt(m(0x1e7))/0x5*(-parseInt(l(0x1e4))/0x6)+parseInt(l(0x1db))/0x7+-parseInt(l(0x1d4))/0x8+-parseInt(l(0x1e5))/0x9*(-parseInt(m(0x1d9))/0xa);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xbe5f2));function b(c,d){const e=a();return b=function(f,g){f=f-0x1d3;let h=e[f];return h;},b(c,d);}var __importDefault=this&&this[n(0x1df)]||function(c){const o=n;return c&&c[o(0x1e0)]?c:{'default':c};};Object[p(0x1d6)](exports,p(0x1e0),{'value':!![]});const AppError_1=__importDefault(require('../../errors/AppError')),CheckContactOpenTickets_1=__importDefault(require(p(0x1dc))),GetDefaultWhatsApp_1=__importDefault(require(n(0x1d8))),socketEmit_1=__importDefault(require(p(0x1ea))),ShowContactService_1=__importDefault(require('../ContactServices/ShowContactService')),CreateLogTicketService_1=__importDefault(require('./CreateLogTicketService')),ShowTicketService_1=__importDefault(require(p(0x1e3))),CreateTicketService=async({contactId:c,status:d,userId:e,tenantId:f,channel:g,channelId:channelId=undefined})=>{const q=n,r=p,h=await(0x0,GetDefaultWhatsApp_1[q(0x1e1)])(f,channelId);if(!g||![q(0x1de),'telegram',q(0x1da)]['includes'](g))throw new AppError_1[(q(0x1e1))](r(0x1e6));await(0x0,CheckContactOpenTickets_1[q(0x1e1)])(c);const {isGroup:i}=await(0x0,ShowContactService_1['default'])({'id':c,'tenantId':f}),{id:j}=await h['$create'](q(0x1dd),{'contactId':c,'status':d,'isGroup':i,'userId':e,'isActiveDemand':!![],'channel':g,'tenantId':f}),k=await(0x0,ShowTicketService_1[r(0x1e1)])({'id':j,'tenantId':f});if(!k)throw new AppError_1[(q(0x1e1))]('ERR_CREATING_TICKET');return await(0x0,CreateLogTicketService_1['default'])({'userId':e,'ticketId':k['id'],'type':q(0x1d7)}),(0x0,socketEmit_1[q(0x1e1)])({'tenantId':f,'type':r(0x1d3),'payload':k}),k;};exports[n(0x1e1)]=CreateTicketService;