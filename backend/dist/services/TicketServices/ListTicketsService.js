'use strict';function a(){const Y=['14BgEnop','QueryTypes','RUyFh','__esModule','true','findAll','2293455MrYbcm','1033257ypSyrk','admin','../SettingServices/ListSettingsService','open','\x0a\x20\x20\x20\x20select\x0a\x20\x20\x20\x20count(*)\x20OVER\x20(\x20)\x20as\x20count,\x0a\x20\x20\x20\x20c.\x22profilePicUrl\x22,\x0a\x20\x20\x20\x20c.\x22name\x22,\x0a\x20\x20\x20\x20u.\x22name\x22\x20as\x20username,\x0a\x20\x20\x20\x20q.queue,\x0a\x20\x20\x20\x20jsonb_build_object(\x27id\x27,\x20w.id,\x20\x27name\x27,\x20w.\x22name\x22\x20,\x20\x27isDeleted\x27\x20,\x20w.\x22isDeleted\x22)\x20whatsapp,\x0a\x20\x20\x20\x20t.*\x0a\x20\x20\x20\x20from\x20\x22Tickets\x22\x20t\x0a\x20\x20\x20\x20inner\x20join\x20\x22Whatsapps\x22\x20w\x20on\x20(w.id\x20=\x20t.\x22whatsappId\x22)\x0a\x20\x20\x20\x20left\x20join\x20\x22Contacts\x22\x20c\x20on\x20(t.\x22contactId\x22\x20=\x20c.id)\x0a\x20\x20\x20\x20left\x20join\x20\x22Users\x22\x20u\x20on\x20(u.id\x20=\x20t.\x22userId\x22)\x0a\x20\x20\x20\x20left\x20join\x20\x22Queues\x22\x20q\x20on\x20(t.\x22queueId\x22\x20=\x20q.id)\x0a\x20\x20\x20\x20where\x20t.\x22tenantId\x22\x20=\x20:tenantId\x0a\x20\x20\x20\x20and\x20c.\x22tenantId\x22\x20=\x20:tenantId\x0a\x20\x20\x20\x20and\x20t.status\x20in\x20(\x20:status\x20)\x0a\x20\x20\x20\x20and\x20coalesce(t.\x22queueId\x22,\x200)\x20in\x20(\x20:queuesIdsUser\x20)\x0a\x20\x20\x20\x20and\x20((\x20:isShowAll\x20=\x20\x27N\x27\x20and\x20\x20(\x0a\x20\x20\x20\x20\x20\x20(:isExistsQueueTenant\x20=\x20\x27S\x27)\x0a\x20\x20\x20\x20\x20\x20or\x20t.\x22userId\x22\x20=\x20:userId\x20or\x20exists\x20(select\x201\x20from\x20\x22ContactWallets\x22\x20cw\x20where\x20cw.\x22walletId\x22\x20=\x20:userId\x20and\x20cw.\x22contactId\x22\x20=\x20t.\x22contactId\x22)\x20)\x0a\x20\x20\x20\x20)\x20OR\x20(:isShowAll\x20=\x20\x27S\x27)\x20OR\x20(t.\x22isGroup\x22\x20=\x20true)\x20OR\x20(:isExistsQueueTenant\x20=\x20\x27N\x27)\x20)\x0a\x20\x20\x20\x20and\x20((\x20:isUnread\x20=\x20\x27S\x27\x20\x20and\x20t.\x22unreadMessages\x22\x20>\x200)\x20OR\x20(:isUnread\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20and\x20((:isNotAssigned\x20=\x20\x27S\x27\x20and\x20t.\x22userId\x22\x20is\x20null)\x20OR\x20(:isNotAssigned\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20and\x20((:isSearchParam\x20=\x20\x27S\x27\x20and\x20(\x20/*exists\x20(\x0a\x20\x20\x20\x20\x20\x20select\x201\x20from\x20\x22Messages\x22\x20m\x20where\x20m.\x22ticketId\x22\x20=\x20t.id\x0a\x20\x20\x20\x20\x20\x20and\x20upper(m.body)\x20like\x20upper(:searchParam)\x0a\x20\x20\x20\x20\x20\x20)\x20or\x20*/\x20(t.id::varchar\x20like\x20:searchParam)\x20or\x20(exists\x20(select\x201\x20from\x20\x22Contacts\x22\x20c\x20where\x20c.id\x20=\x20t.\x22contactId\x22\x20and\x20(upper(c.\x22name\x22)\x20like\x20upper(:searchParam)\x20or\x20c.\x22number\x22\x20like\x20:searchParam))))\x20OR\x20(:isSearchParam\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20)\x0a\x20\x20\x20\x20order\x20by\x20t.\x22updatedAt\x22\x20desc\x0a\x20\x20\x20\x20limit\x20:limit\x20offset\x20:offset\x20;\x0a\x20\x20','hChKg','defineProperty','queueId','ERR_NO_STATUS_SELECTED','push','../../models/Queue','default','32931OBowxX','map','mYrZM','profile','ylHjI','length','count','fNcHL','tywbe','key','107852WQrgQH','closed','SELECT','value','pending','../../errors/AppError','__importDefault','NotViewAssignedTickets','enabled','743250lgyano','../../models/User','7154476guZLzw','7396160EWVJZj','find','EJvCj','VQbqM'];a=function(){return Y;};return a();}function b(c,d){const e=a();return b=function(f,g){f=f-0xe7;let h=e[f];return h;},b(c,d);}const N=b,P=b;(function(c,d){const L=b,M=b,e=c();while(!![]){try{const f=parseInt(L(0xef))/0x1*(parseInt(L(0x109))/0x2)+parseInt(L(0x110))/0x3+-parseInt(L(0xf9))/0x4+parseInt(M(0x10f))/0x5+-parseInt(L(0x102))/0x6+parseInt(L(0x104))/0x7+-parseInt(M(0x105))/0x8;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xef571));var __importDefault=this&&this[N(0xff)]||function(c){const O=N;return c&&c[O(0x10c)]?c:{'default':c};};Object[P(0xe9)](exports,N(0x10c),{'value':!![]});const sequelize_1=require('sequelize'),Ticket_1=__importDefault(require('../../models/Ticket')),UsersQueues_1=__importDefault(require('../../models/UsersQueues')),AppError_1=__importDefault(require(N(0xfe))),Queue_1=__importDefault(require(N(0xed))),User_1=__importDefault(require(N(0x103))),ListSettingsService_1=__importDefault(require(N(0x112))),ListTicketsService=async({searchParam:searchParam='',pageNumber:pageNumber='1',status:c,date:d,showAll:e,userId:f,withUnreadMessages:g,queuesIds:h,isNotAssignedUser:i,includeNotQueueDefined:j,tenantId:k,profile:l})=>{const Q=P,R=P,m=e==Q(0x10d)&&l==='admin',n=g&&g==Q(0x10d)?'S':'N',o=i&&i=='true'?'S':'N',p=m?'S':'N',q=h?'S':'N',r=searchParam?'S':'N',s=await(0x0,ListSettingsService_1[Q(0xee)])(k),t=s?.[Q(0x106)](F=>{const S=Q,T=Q;return F[S(0xf8)]===S(0x100);})?.[R(0xfc)]===R(0x101)?'S':'N';if(!c&&!m)throw new AppError_1[(Q(0xee))](R(0xeb),0x194);m&&(c=[Q(0x113),'pending',R(0xfa)]);const u=await Queue_1['default']['count']({'where':{'tenantId':k}})>0x0?'S':'N',v=await User_1[R(0xee)]['findByPk'](f);let w;if(v[R(0xf2)]===R(0x111)){if(Q(0x10b)===Q(0xf6)){const G=i['findIndex'](H=>o(p)==H);G>-0x1&&o['push'](p(q));}else w=await Queue_1[R(0xee)][Q(0x10e)]({'where':{'tenantId':k,'isActive':!![]},'attributes':['id']}),w=w[R(0xf0)](G=>{const U=R,V=Q;if(U(0xf3)!==V(0xf3))e=f=U(0xe7);else return{'queueId':G['id']};});}else w=await UsersQueues_1[Q(0xee)][Q(0x10e)]({'where':{'userId':f}});let x=w['map'](G=>G[R(0xea)]);x[R(0xec)](0x0);if(h){const G=[];h['forEach'](H=>{const W=R,X=Q;if(W(0x108)!=='VQbqM')d=['open',X(0xfd),X(0xfa)];else{const J=x['findIndex'](K=>Number(H)==K);if(J>-0x1){if(W(0xf7)!=='lMwWU')G['push'](Number(H));else return g&&h[W(0x10c)]?H:{'default':j};}}}),x=G[Q(0xf4)]?G:[0x0];}!x[R(0xf4)]&&(x=[0x0]);let y;if(l==Q(0x111))Q(0xe8)!==R(0xe8)?d=[0x0]:y=y=R(0xe7);else{if(R(0xf1)!==Q(0x107))y='\x0a\x20\x20\x20\x20select\x0a\x20\x20\x20\x20count(*)\x20OVER\x20(\x20)\x20as\x20count,\x0a\x20\x20\x20\x20c.\x22profilePicUrl\x22,\x0a\x20\x20\x20\x20c.\x22name\x22,\x0a\x20\x20\x20\x20u.\x22name\x22\x20as\x20username,\x0a\x20\x20\x20\x20q.queue,\x0a\x20\x20\x20\x20jsonb_build_object(\x27id\x27,\x20w.id,\x20\x27name\x27,\x20w.\x22name\x22\x20,\x20\x27isDeleted\x27\x20,\x20w.\x22isDeleted\x22)\x20whatsapp,\x0a\x20\x20\x20\x20t.*\x0a\x20\x20\x20\x20from\x20\x22Tickets\x22\x20t\x0a\x20\x20\x20\x20inner\x20join\x20\x22Whatsapps\x22\x20w\x20on\x20(w.id\x20=\x20t.\x22whatsappId\x22)\x0a\x20\x20\x20\x20left\x20join\x20\x22Contacts\x22\x20c\x20on\x20(t.\x22contactId\x22\x20=\x20c.id)\x0a\x20\x20\x20\x20left\x20join\x20\x22Users\x22\x20u\x20on\x20(u.id\x20=\x20t.\x22userId\x22)\x0a\x20\x20\x20\x20left\x20join\x20\x22Queues\x22\x20q\x20on\x20(t.\x22queueId\x22\x20=\x20q.id)\x0a\x20\x20\x20\x20where\x20t.\x22tenantId\x22\x20=\x20:tenantId\x0a\x20\x20\x20\x20and\x20c.\x22tenantId\x22\x20=\x20:tenantId\x0a\x20\x20\x20\x20and\x20t.status\x20in\x20(\x20:status\x20)\x0a\x20\x20\x20\x20and\x20coalesce(t.\x22queueId\x22,\x200)\x20in\x20(\x20:queuesIdsUser\x20)\x0a\x20\x20\x20\x20and\x20(((\x0a\x20\x20\x20\x20\x20\x20(:isExistsQueueTenant\x20=\x20\x27S\x27)\x0a\x20\x20\x20\x20\x20\x20or\x20t.\x22userId\x22\x20=\x20:userId\x20or\x20exists\x20(select\x201\x20from\x20\x22ContactWallets\x22\x20cw\x20where\x20cw.\x22walletId\x22\x20=\x20:userId\x20and\x20cw.\x22contactId\x22\x20=\x20t.\x22contactId\x22)\x20)\x0a\x20\x20\x20\x20)\x20OR\x20(:isShowAll\x20=\x20\x27S\x27)\x20OR\x20(t.\x22isGroup\x22\x20=\x20true)\x20OR\x20(:isExistsQueueTenant\x20=\x20\x27N\x27)\x20)\x0a\x20\x20\x20\x20and\x20((\x20:isUnread\x20=\x20\x27S\x27\x20\x20and\x20t.\x22unreadMessages\x22\x20>\x200)\x20OR\x20(:isUnread\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20and\x20((:isNotAssigned\x20=\x20\x27S\x27\x20and\x20t.\x22userId\x22\x20is\x20null)\x20OR\x20(:isNotAssigned\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20and\x20((:isNotViewAssignedTickets\x20=\x20\x27S\x27\x20and\x20((t.\x22userId\x22\x20=\x20:userId\x20and\x20t.status\x20\x20in\x20(\x20:status\x20))\x20or\x20(t.\x22userId\x22\x20is\x20null\x20and\x20t.status\x20\x20in\x20(\x20:status\x20))))\x20OR\x20(:isNotViewAssignedTickets\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20and\x20((:isSearchParam\x20=\x20\x27S\x27\x20and\x20(\x20/*exists\x20(\x0a\x20\x20\x20\x20\x20\x20select\x201\x20from\x20\x22Messages\x22\x20m\x20where\x20m.\x22ticketId\x22\x20=\x20t.id\x0a\x20\x20\x20\x20\x20\x20and\x20upper(m.body)\x20like\x20upper(:searchParam)\x0a\x20\x20\x20\x20\x20\x20)\x20or\x20*/\x20(t.id::varchar\x20like\x20:searchParam)\x20or\x20(exists\x20(select\x201\x20from\x20\x22Contacts\x22\x20c\x20where\x20c.id\x20=\x20t.\x22contactId\x22\x20and\x20(upper(c.\x22name\x22)\x20like\x20upper(:searchParam)\x20or\x20c.\x22number\x22\x20like\x20:searchParam))))\x20OR\x20(:isSearchParam\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20)\x0a\x20\x20\x20\x20order\x20by\x20t.\x22updatedAt\x22\x20desc\x0a\x20\x20\x20\x20limit\x20:limit\x20offset\x20:offset\x20;\x0a\x20\x20';else return{'queueId':d['id']};}const z=0x1e,A=z*(+pageNumber-0x1),B=await Ticket_1['default']['sequelize']?.['query'](y,{'replacements':{'tenantId':k,'isQueuesIds':q,'status':c,'isShowAll':p,'isExistsQueueTenant':u,'queuesIdsUser':x,'userId':f,'isUnread':n,'isNotAssigned':o,'isSearchParam':r,'searchParam':'%'+searchParam+'%','limit':z,'offset':A,'isNotViewAssignedTickets':t,'profile':l},'type':sequelize_1[Q(0x10a)][R(0xfb)],'nest':!![]});let C=0x0,D=0x0;B?.[Q(0xf4)]&&(C=B[0x0][Q(0xf5)],D=B[R(0xf4)]);const E=C>A+D;return{'tickets':B||[],'count':C,'hasMore':E};};exports[N(0xee)]=ListTicketsService;