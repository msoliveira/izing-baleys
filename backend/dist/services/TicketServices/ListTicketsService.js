'use strict';function a(){const V=['../../models/Queue','ERR_NO_STATUS_SELECTED','../../models/User','HcfOB','../../models/Ticket','497973nYQnxy','closed','\x0a\x20\x20\x20\x20select\x0a\x20\x20\x20\x20count(*)\x20OVER\x20(\x20)\x20as\x20count,\x0a\x20\x20\x20\x20c.\x22profilePicUrl\x22,\x0a\x20\x20\x20\x20c.\x22name\x22,\x0a\x20\x20\x20\x20u.\x22name\x22\x20as\x20username,\x0a\x20\x20\x20\x20q.queue,\x0a\x20\x20\x20\x20jsonb_build_object(\x27id\x27,\x20w.id,\x20\x27name\x27,\x20w.\x22name\x22\x20,\x20\x27isDeleted\x27\x20,\x20w.\x22isDeleted\x22)\x20whatsapp,\x0a\x20\x20\x20\x20t.*\x0a\x20\x20\x20\x20from\x20\x22Tickets\x22\x20t\x0a\x20\x20\x20\x20inner\x20join\x20\x22Whatsapps\x22\x20w\x20on\x20(w.id\x20=\x20t.\x22whatsappId\x22)\x0a\x20\x20\x20\x20left\x20join\x20\x22Contacts\x22\x20c\x20on\x20(t.\x22contactId\x22\x20=\x20c.id)\x0a\x20\x20\x20\x20left\x20join\x20\x22Users\x22\x20u\x20on\x20(u.id\x20=\x20t.\x22userId\x22)\x0a\x20\x20\x20\x20left\x20join\x20\x22Queues\x22\x20q\x20on\x20(t.\x22queueId\x22\x20=\x20q.id)\x0a\x20\x20\x20\x20where\x20t.\x22tenantId\x22\x20=\x20:tenantId\x0a\x20\x20\x20\x20and\x20c.\x22tenantId\x22\x20=\x20:tenantId\x0a\x20\x20\x20\x20and\x20t.status\x20in\x20(\x20:status\x20)\x0a\x20\x20\x20\x20and\x20coalesce(t.\x22queueId\x22,\x200)\x20in\x20(\x20:queuesIdsUser\x20)\x0a\x20\x20\x20\x20and\x20(((\x0a\x20\x20\x20\x20\x20\x20(:isExistsQueueTenant\x20=\x20\x27S\x27)\x0a\x20\x20\x20\x20\x20\x20or\x20t.\x22userId\x22\x20=\x20:userId\x20or\x20exists\x20(select\x201\x20from\x20\x22ContactWallets\x22\x20cw\x20where\x20cw.\x22walletId\x22\x20=\x20:userId\x20and\x20cw.\x22contactId\x22\x20=\x20t.\x22contactId\x22)\x20)\x0a\x20\x20\x20\x20)\x20OR\x20(:isShowAll\x20=\x20\x27S\x27)\x20OR\x20(t.\x22isGroup\x22\x20=\x20true)\x20OR\x20(:isExistsQueueTenant\x20=\x20\x27N\x27)\x20)\x0a\x20\x20\x20\x20and\x20((\x20:isUnread\x20=\x20\x27S\x27\x20\x20and\x20t.\x22unreadMessages\x22\x20>\x200)\x20OR\x20(:isUnread\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20and\x20((:isNotAssigned\x20=\x20\x27S\x27\x20and\x20t.\x22userId\x22\x20is\x20null)\x20OR\x20(:isNotAssigned\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20and\x20((:isNotViewAssignedTickets\x20=\x20\x27S\x27\x20and\x20((t.\x22userId\x22\x20=\x20:userId\x20and\x20t.status\x20\x20in\x20(\x20:status\x20))\x20or\x20(t.\x22userId\x22\x20is\x20null\x20and\x20t.status\x20\x20in\x20(\x20:status\x20))))\x20OR\x20(:isNotViewAssignedTickets\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20and\x20((:isSearchParam\x20=\x20\x27S\x27\x20and\x20(\x20/*exists\x20(\x0a\x20\x20\x20\x20\x20\x20select\x201\x20from\x20\x22Messages\x22\x20m\x20where\x20m.\x22ticketId\x22\x20=\x20t.id\x0a\x20\x20\x20\x20\x20\x20and\x20upper(m.body)\x20like\x20upper(:searchParam)\x0a\x20\x20\x20\x20\x20\x20)\x20or\x20*/\x20(t.id::varchar\x20like\x20:searchParam)\x20or\x20(exists\x20(select\x201\x20from\x20\x22Contacts\x22\x20c\x20where\x20c.id\x20=\x20t.\x22contactId\x22\x20and\x20(upper(c.\x22name\x22)\x20like\x20upper(:searchParam)\x20or\x20c.\x22number\x22\x20like\x20:searchParam))))\x20OR\x20(:isSearchParam\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20)\x0a\x20\x20\x20\x20order\x20by\x20t.\x22updatedAt\x22\x20desc\x0a\x20\x20\x20\x20limit\x20:limit\x20offset\x20:offset\x20;\x0a\x20\x20','96xzaTho','624976vFGbtX','pending','QueryTypes','default','338911ljEmRq','enabled','16ifCVji','findAll','1682244ecJCZO','4358cnLZFy','429ugCRWn','nJTCw','admin','smFTq','../../models/UsersQueues','__esModule','open','findIndex','\x0a\x20\x20\x20\x20select\x0a\x20\x20\x20\x20count(*)\x20OVER\x20(\x20)\x20as\x20count,\x0a\x20\x20\x20\x20c.\x22profilePicUrl\x22,\x0a\x20\x20\x20\x20c.\x22name\x22,\x0a\x20\x20\x20\x20u.\x22name\x22\x20as\x20username,\x0a\x20\x20\x20\x20q.queue,\x0a\x20\x20\x20\x20jsonb_build_object(\x27id\x27,\x20w.id,\x20\x27name\x27,\x20w.\x22name\x22\x20,\x20\x27isDeleted\x27\x20,\x20w.\x22isDeleted\x22)\x20whatsapp,\x0a\x20\x20\x20\x20t.*\x0a\x20\x20\x20\x20from\x20\x22Tickets\x22\x20t\x0a\x20\x20\x20\x20inner\x20join\x20\x22Whatsapps\x22\x20w\x20on\x20(w.id\x20=\x20t.\x22whatsappId\x22)\x0a\x20\x20\x20\x20left\x20join\x20\x22Contacts\x22\x20c\x20on\x20(t.\x22contactId\x22\x20=\x20c.id)\x0a\x20\x20\x20\x20left\x20join\x20\x22Users\x22\x20u\x20on\x20(u.id\x20=\x20t.\x22userId\x22)\x0a\x20\x20\x20\x20left\x20join\x20\x22Queues\x22\x20q\x20on\x20(t.\x22queueId\x22\x20=\x20q.id)\x0a\x20\x20\x20\x20where\x20t.\x22tenantId\x22\x20=\x20:tenantId\x0a\x20\x20\x20\x20and\x20c.\x22tenantId\x22\x20=\x20:tenantId\x0a\x20\x20\x20\x20and\x20t.status\x20in\x20(\x20:status\x20)\x0a\x20\x20\x20\x20and\x20coalesce(t.\x22queueId\x22,\x200)\x20in\x20(\x20:queuesIdsUser\x20)\x0a\x20\x20\x20\x20and\x20((\x20:isShowAll\x20=\x20\x27N\x27\x20and\x20\x20(\x0a\x20\x20\x20\x20\x20\x20(:isExistsQueueTenant\x20=\x20\x27S\x27)\x0a\x20\x20\x20\x20\x20\x20or\x20t.\x22userId\x22\x20=\x20:userId\x20or\x20exists\x20(select\x201\x20from\x20\x22ContactWallets\x22\x20cw\x20where\x20cw.\x22walletId\x22\x20=\x20:userId\x20and\x20cw.\x22contactId\x22\x20=\x20t.\x22contactId\x22)\x20)\x0a\x20\x20\x20\x20)\x20OR\x20(:isShowAll\x20=\x20\x27S\x27)\x20OR\x20(t.\x22isGroup\x22\x20=\x20true)\x20OR\x20(:isExistsQueueTenant\x20=\x20\x27N\x27)\x20)\x0a\x20\x20\x20\x20and\x20((\x20:isUnread\x20=\x20\x27S\x27\x20\x20and\x20t.\x22unreadMessages\x22\x20>\x200)\x20OR\x20(:isUnread\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20and\x20((:isNotAssigned\x20=\x20\x27S\x27\x20and\x20t.\x22userId\x22\x20is\x20null)\x20OR\x20(:isNotAssigned\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20and\x20((:isSearchParam\x20=\x20\x27S\x27\x20and\x20(\x20/*exists\x20(\x0a\x20\x20\x20\x20\x20\x20select\x201\x20from\x20\x22Messages\x22\x20m\x20where\x20m.\x22ticketId\x22\x20=\x20t.id\x0a\x20\x20\x20\x20\x20\x20and\x20upper(m.body)\x20like\x20upper(:searchParam)\x0a\x20\x20\x20\x20\x20\x20)\x20or\x20*/\x20(t.id::varchar\x20like\x20:searchParam)\x20or\x20(exists\x20(select\x201\x20from\x20\x22Contacts\x22\x20c\x20where\x20c.id\x20=\x20t.\x22contactId\x22\x20and\x20(upper(c.\x22name\x22)\x20like\x20upper(:searchParam)\x20or\x20c.\x22number\x22\x20like\x20:searchParam))))\x20OR\x20(:isSearchParam\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20)\x0a\x20\x20\x20\x20order\x20by\x20t.\x22updatedAt\x22\x20desc\x0a\x20\x20\x20\x20limit\x20:limit\x20offset\x20:offset\x20;\x0a\x20\x20','9jfkqPB','map','LwHjV','length','15823930owFswc','queueId','804ldaRqQ','true','key','query','__importDefault','find','count','523555nzDfdW','sequelize','forEach','ZBzZe','push','Jogdi','value'];a=function(){return V;};return a();}function b(c,d){const e=a();return b=function(f,g){f=f-0x18e;let h=e[f];return h;},b(c,d);}const O=b,Q=b;(function(c,d){const M=b,N=b,e=c();while(!![]){try{const f=-parseInt(M(0x1b2))/0x1+-parseInt(N(0x1b7))/0x2*(parseInt(M(0x1b8))/0x3)+parseInt(N(0x1b4))/0x4*(parseInt(M(0x19e))/0x5)+-parseInt(N(0x1b6))/0x6+parseInt(N(0x1aa))/0x7*(-parseInt(N(0x1ad))/0x8)+parseInt(M(0x191))/0x9*(-parseInt(M(0x195))/0xa)+parseInt(N(0x1ae))/0xb*(parseInt(N(0x197))/0xc);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xd19cd));var __importDefault=this&&this[O(0x19b)]||function(c){const P=O;return c&&c[P(0x1bd)]?c:{'default':c};};Object['defineProperty'](exports,O(0x1bd),{'value':!![]});const sequelize_1=require(Q(0x19f)),Ticket_1=__importDefault(require(Q(0x1a9))),UsersQueues_1=__importDefault(require(O(0x1bc))),AppError_1=__importDefault(require('../../errors/AppError')),Queue_1=__importDefault(require(Q(0x1a5))),User_1=__importDefault(require(Q(0x1a7))),ListSettingsService_1=__importDefault(require('../SettingServices/ListSettingsService')),ListTicketsService=async({searchParam:searchParam='',pageNumber:pageNumber='1',status:c,date:d,showAll:e,userId:f,withUnreadMessages:g,queuesIds:h,isNotAssignedUser:i,includeNotQueueDefined:j,tenantId:k,profile:l})=>{const R=O,S=Q,m=e=='true'&&l===R(0x1ba),n=g&&g==S(0x198)?'S':'N',o=i&&i==R(0x198)?'S':'N',p=m?'S':'N',q=h?'S':'N',r=searchParam?'S':'N',s=await(0x0,ListSettingsService_1[S(0x1b1)])(k),t=s?.[S(0x19c)](F=>{const T=S;return F[T(0x199)]==='NotViewAssignedTickets';})?.[R(0x1a4)]===R(0x1b3)?'S':'N';if(!c&&!m){if(S(0x1a8)!=='UZrnV')throw new AppError_1[(S(0x1b1))](R(0x1a6),0x194);else d=[0x0];}if(m){if('nXkxe'!==R(0x1bb))c=[R(0x18e),R(0x1af),R(0x1ab)];else{const H=i[R(0x18f)](I=>o(p)==I);H>-0x1&&o[S(0x1a2)](p(q));}}const u=await Queue_1[R(0x1b1)]['count']({'where':{'tenantId':k}})>0x0?'S':'N',v=await User_1[R(0x1b1)]['findByPk'](f);let w;v['profile']===R(0x1ba)?R(0x1a3)!==R(0x1b9)?(w=await Queue_1[R(0x1b1)][S(0x1b5)]({'where':{'tenantId':k,'isActive':!![]},'attributes':['id']}),w=w[R(0x192)](H=>{return{'queueId':H['id']};})):d=R(0x1ac):w=await UsersQueues_1['default'][S(0x1b5)]({'where':{'userId':f}});let x=w[R(0x192)](I=>I[R(0x196)]);x[S(0x1a2)](0x0);if(h){const I=[];h[S(0x1a0)](J=>{const U=S,K=x['findIndex'](L=>Number(J)==L);K>-0x1&&I[U(0x1a2)](Number(J));}),x=I[S(0x194)]?I:[0x0];}!x[S(0x194)]&&('ZBzZe'!==S(0x1a1)?(g=h[0x0][S(0x19d)],i=j[R(0x194)]):x=[0x0]);let y;l==S(0x1ba)?'iDpAi'==='OhakS'?e=f=S(0x190):y=y=S(0x190):y='\x0a\x20\x20\x20\x20select\x0a\x20\x20\x20\x20count(*)\x20OVER\x20(\x20)\x20as\x20count,\x0a\x20\x20\x20\x20c.\x22profilePicUrl\x22,\x0a\x20\x20\x20\x20c.\x22name\x22,\x0a\x20\x20\x20\x20u.\x22name\x22\x20as\x20username,\x0a\x20\x20\x20\x20q.queue,\x0a\x20\x20\x20\x20jsonb_build_object(\x27id\x27,\x20w.id,\x20\x27name\x27,\x20w.\x22name\x22\x20,\x20\x27isDeleted\x27\x20,\x20w.\x22isDeleted\x22)\x20whatsapp,\x0a\x20\x20\x20\x20t.*\x0a\x20\x20\x20\x20from\x20\x22Tickets\x22\x20t\x0a\x20\x20\x20\x20inner\x20join\x20\x22Whatsapps\x22\x20w\x20on\x20(w.id\x20=\x20t.\x22whatsappId\x22)\x0a\x20\x20\x20\x20left\x20join\x20\x22Contacts\x22\x20c\x20on\x20(t.\x22contactId\x22\x20=\x20c.id)\x0a\x20\x20\x20\x20left\x20join\x20\x22Users\x22\x20u\x20on\x20(u.id\x20=\x20t.\x22userId\x22)\x0a\x20\x20\x20\x20left\x20join\x20\x22Queues\x22\x20q\x20on\x20(t.\x22queueId\x22\x20=\x20q.id)\x0a\x20\x20\x20\x20where\x20t.\x22tenantId\x22\x20=\x20:tenantId\x0a\x20\x20\x20\x20and\x20c.\x22tenantId\x22\x20=\x20:tenantId\x0a\x20\x20\x20\x20and\x20t.status\x20in\x20(\x20:status\x20)\x0a\x20\x20\x20\x20and\x20coalesce(t.\x22queueId\x22,\x200)\x20in\x20(\x20:queuesIdsUser\x20)\x0a\x20\x20\x20\x20and\x20(((\x0a\x20\x20\x20\x20\x20\x20(:isExistsQueueTenant\x20=\x20\x27S\x27)\x0a\x20\x20\x20\x20\x20\x20or\x20t.\x22userId\x22\x20=\x20:userId\x20or\x20exists\x20(select\x201\x20from\x20\x22ContactWallets\x22\x20cw\x20where\x20cw.\x22walletId\x22\x20=\x20:userId\x20and\x20cw.\x22contactId\x22\x20=\x20t.\x22contactId\x22)\x20)\x0a\x20\x20\x20\x20)\x20OR\x20(:isShowAll\x20=\x20\x27S\x27)\x20OR\x20(t.\x22isGroup\x22\x20=\x20true)\x20OR\x20(:isExistsQueueTenant\x20=\x20\x27N\x27)\x20)\x0a\x20\x20\x20\x20and\x20((\x20:isUnread\x20=\x20\x27S\x27\x20\x20and\x20t.\x22unreadMessages\x22\x20>\x200)\x20OR\x20(:isUnread\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20and\x20((:isNotAssigned\x20=\x20\x27S\x27\x20and\x20t.\x22userId\x22\x20is\x20null)\x20OR\x20(:isNotAssigned\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20and\x20((:isNotViewAssignedTickets\x20=\x20\x27S\x27\x20and\x20((t.\x22userId\x22\x20=\x20:userId\x20and\x20t.status\x20\x20in\x20(\x20:status\x20))\x20or\x20(t.\x22userId\x22\x20is\x20null\x20and\x20t.status\x20\x20in\x20(\x20:status\x20))))\x20OR\x20(:isNotViewAssignedTickets\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20and\x20((:isSearchParam\x20=\x20\x27S\x27\x20and\x20(\x20/*exists\x20(\x0a\x20\x20\x20\x20\x20\x20select\x201\x20from\x20\x22Messages\x22\x20m\x20where\x20m.\x22ticketId\x22\x20=\x20t.id\x0a\x20\x20\x20\x20\x20\x20and\x20upper(m.body)\x20like\x20upper(:searchParam)\x0a\x20\x20\x20\x20\x20\x20)\x20or\x20*/\x20(t.id::varchar\x20like\x20:searchParam)\x20or\x20(exists\x20(select\x201\x20from\x20\x22Contacts\x22\x20c\x20where\x20c.id\x20=\x20t.\x22contactId\x22\x20and\x20(upper(c.\x22name\x22)\x20like\x20upper(:searchParam)\x20or\x20c.\x22number\x22\x20like\x20:searchParam))))\x20OR\x20(:isSearchParam\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20)\x0a\x20\x20\x20\x20order\x20by\x20t.\x22updatedAt\x22\x20desc\x0a\x20\x20\x20\x20limit\x20:limit\x20offset\x20:offset\x20;\x0a\x20\x20';const z=0x1e,A=z*(+pageNumber-0x1),B=await Ticket_1[R(0x1b1)][S(0x19f)]?.[S(0x19a)](y,{'replacements':{'tenantId':k,'isQueuesIds':q,'status':c,'isShowAll':p,'isExistsQueueTenant':u,'queuesIdsUser':x,'userId':f,'isUnread':n,'isNotAssigned':o,'isSearchParam':r,'searchParam':'%'+searchParam+'%','limit':z,'offset':A,'isNotViewAssignedTickets':t,'profile':l},'type':sequelize_1[R(0x1b0)]['SELECT'],'nest':!![]});let C=0x0,D=0x0;B?.[S(0x194)]&&('LwHjV'===S(0x193)?(C=B[0x0]['count'],D=B[R(0x194)]):d=[S(0x18e),'pending',R(0x1ab)]);const E=C>A+D;return{'tickets':B||[],'count':C,'hasMore':E};};exports[O(0x1b1)]=ListTicketsService;