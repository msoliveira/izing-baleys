'use strict';function a(){const G=['broadcastVoice','pending','sendMessage\x20media','image','instagram','sequelize','broadcastVideo','logger','4974959JonUND','228xdHBUY','Error\x20message\x20is\x20(tenant:\x20','mediaName','../../models/Ticket','error','ASC','fs/promises','__importDefault','public','toBuffer','70435lTlTUG','lte','default','ticket','mp4','item_id','ptt','contact','../../helpers/socketEmit','sended','instagramPK','findAll','chat:ack','video','18yHybEA','text','quotedMsg','sendMessage\x20text','2489936spcwwM','mediaUrl','info','../../utils/logger','Error\x20send\x20message\x20(id:\x20',')::\x20','entity','chat','4eDqejq','path','106570zHHvfq','fluent-ffmpeg','.mp4','../../utils/sleepRandomTime','\x20|\x20Ticket:\x20','tenantId','3144480vMqIQg','log','30LvcdqQ','6248459YwcxfR','Message\x20Update\x20ok','1223925BiWvOl','update','end','readFile','closed','20cSmzjf','toFormat','saveToFile','__esModule','broadcastPhoto','mediaType','../../models/Message'];a=function(){return G;};return a();}const z=b,B=b;(function(c,d){const x=b,y=b,e=c();while(!![]){try{const f=-parseInt(x(0x1ee))/0x1*(parseInt(x(0x1de))/0x2)+-parseInt(x(0x1e9))/0x3*(-parseInt(x(0x1dc))/0x4)+-parseInt(y(0x208))/0x5*(-parseInt(x(0x1fe))/0x6)+-parseInt(x(0x1e7))/0x7+-parseInt(x(0x1d4))/0x8*(-parseInt(y(0x1d0))/0x9)+parseInt(y(0x1e6))/0xa*(parseInt(y(0x1fd))/0xb)+-parseInt(y(0x1e4))/0xc;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xab6f3));function b(c,d){const e=a();return b=function(f,g){f=f-0x1c4;let h=e[f];return h;},b(c,d);}var __importDefault=this&&this[z(0x205)]||function(c){const A=z;return c&&c[A(0x1f1)]?c:{'default':c};};Object['defineProperty'](exports,z(0x1f1),{'value':!![]});const promises_1=require(B(0x204)),fluent_ffmpeg_1=__importDefault(require(B(0x1df))),path_1=require(z(0x1dd)),sequelize_1=require(B(0x1fa)),sharp_1=__importDefault(require('sharp')),socketEmit_1=__importDefault(require(B(0x1ca))),Message_1=__importDefault(require(B(0x1f4))),Ticket_1=__importDefault(require(z(0x201))),logger_1=require(B(0x1d7)),sleepRandomTime_1=require(z(0x1e1)),SendMessagesSystemWbot=async(c,d)=>{const C=z,D=B,e={'fromMe':!![],'messageId':{[sequelize_1['Op']['is']]:null},'status':C(0x1f6),[sequelize_1['Op']['or']]:[{'scheduleDate':{[sequelize_1['Op'][C(0x209)]]:new Date()}},{'scheduleDate':{[sequelize_1['Op']['is']]:null}}]},f=await Message_1['default'][C(0x1cd)]({'where':e,'include':[C(0x1c9),{'model':Ticket_1[D(0x1c4)],'as':C(0x1c5),'where':{'tenantId':d,[sequelize_1['Op']['or']]:{'status':{[sequelize_1['Op']['ne']]:C(0x1ed)},'isFarewellMessage':!![]},'channel':C(0x1f9),'whatsappId':c['id']},'include':[D(0x1c9)]},{'model':Message_1[C(0x1c4)],'as':C(0x1d2),'include':[C(0x1c9)]}],'order':[['createdAt',C(0x203)]]});let g;for(const h of f){const i=h,{ticket:j}=i,k=j[D(0x1c9)][D(0x1cc)],l=await c[D(0x1da)]['directThread']([k]);try{if(![C(0x1db),'text']['includes'](i['mediaType'])&&i[C(0x200)]){const n=(0x0,path_1['join'])(__dirname,'..','..','..',C(0x206)),o=(0x0,path_1['join'])(n,i['mediaName']),p=await(0x0,promises_1[D(0x1ec)])(o);console[D(0x1e5)](o);if(i[C(0x1f3)]==='audio'||i[C(0x1f3)]===D(0x1c8)){const q=i[C(0x200)]['split']('.'),r=(0x0,path_1['join'])(n,q[0x0]+D(0x1e0));await new Promise((t,u)=>{const E=D,F=C;(0x0,fluent_ffmpeg_1[E(0x1c4)])(o)[E(0x1ef)](F(0x1c6))['on'](F(0x202),v=>u(v))['on'](E(0x1eb),()=>t(!![]))[F(0x1f0)](r);});const s=await(0x0,promises_1[D(0x1ec)])(r);g=await l[D(0x1f5)]({'file':s});}if(i[C(0x1f3)]===C(0x1f8)){const t=await(0x0,sharp_1['default'])(p)['jpeg']()[C(0x207)]();g=await l[C(0x1f2)]({'file':t});}i[C(0x1f3)]===C(0x1cf)&&(g=await l[C(0x1fb)]({'video':p})),logger_1[D(0x1fc)]['info'](D(0x1f7));}[D(0x1db),C(0x1d1)]['includes'](i[D(0x1f3)])&&!i['mediaName']&&(g=await l['broadcastText'](i['body']),logger_1[D(0x1fc)][C(0x1d6)](D(0x1d3)));const m={...i,...g,'id':i['id'],'timestamp':i['timestamp'],'messageId':g[D(0x1c7)],'status':D(0x1cb),'ack':0x2};await Message_1[C(0x1c4)][D(0x1ea)]({...m},{'where':{'id':i['id']}}),(0x0,socketEmit_1[D(0x1c4)])({'tenantId':j[D(0x1e3)],'type':C(0x1ce),'payload':{...i['dataValues'],'mediaUrl':i[C(0x1d5)],'id':i['id'],'timestamp':i['timestamp'],'messageId':g[D(0x1c7)],'status':'sended','ack':0x2}}),logger_1[C(0x1fc)][C(0x1d6)](C(0x1e8)),await(0x0,sleepRandomTime_1['sleepRandomTime'])({'minMilliseconds':Number(0x7d0),'maxMilliseconds':Number(0xbb8)});}catch(u){const v=i['id'],w=i[C(0x1c5)]['id'];logger_1[C(0x1fc)]['error'](C(0x1ff)+d+D(0x1e2)+w+')'),logger_1[D(0x1fc)][D(0x202)](C(0x1d8)+v+D(0x1d9)+u);}}};exports[B(0x1c4)]=SendMessagesSystemWbot;