'use strict';const w=b,x=b;function b(c,d){const e=a();return b=function(f,g){f=f-0x7d;let h=e[f];return h;},b(c,d);}(function(c,d){const u=b,v=b,e=c();while(!![]){try{const f=-parseInt(u(0x9a))/0x1+parseInt(u(0x8b))/0x2+parseInt(v(0xa5))/0x3*(-parseInt(u(0x7f))/0x4)+parseInt(v(0xae))/0x5+-parseInt(u(0x95))/0x6*(parseInt(u(0x9f))/0x7)+-parseInt(v(0xa0))/0x8+-parseInt(u(0x90))/0x9*(-parseInt(v(0x8f))/0xa);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x56935));var __importDefault=this&&this['__importDefault']||function(c){return c&&c['__esModule']?c:{'default':c};};function a(){const I=['audio','12xbwblP','ERROR\x20DONWLOAD','application','getTime','audio_src','data','text','image_versions2','vTZdL','video_versions','../MessageServices/CreateMessageService','pipe','609714aiEvMJ','finish','__esModule','received','3219690BDZsKs','36Hwegad','message','caption','áudio','item_type','12OWDFgi','length','default','url','sended','528439LZWzjv','media_type','defineProperty','GET','PjxUX','1483076lyoFEk','1300336VupmBa','vídeo','tenantId','arquivo','update','173787zoShRb','toString','error','voice_media','media','split','video','candidates','image','251920utHbNn','axios'];a=function(){return I;};return a();}Object[w(0x9c)](exports,w(0x8d),{'value':!![]});const path_1=require('path'),fs_1=require('fs'),axios_1=__importDefault(require(x(0x7d))),CreateMessageService_1=__importDefault(require(w(0x89))),getExt=c=>{const y=w,z=x,d=c[y(0xaa)]('?'),e=d[0x0][z(0xaa)]('/'),f=e[e[y(0x96)]-0x1]['split']('.');return f[0x1];},downloadFile=async(c,d)=>{const A=x,B=x,e=await(0x0,axios_1[A(0x97)])({'url':c[B(0xa6)](),'method':A(0x9d),'responseType':'stream'});await new Promise((f,g)=>{const C=B,D=A;if('hKrYn'===C(0x9e))return g&&h[D(0x8d)]?i:{'default':j};else e[C(0x84)][C(0x8a)]((0x0,fs_1['createWriteStream'])(d))['on'](C(0x8c),async()=>f(!![]))['on'](D(0xa7),i=>{const E=C,F=C;E(0x87)!=='mtAct'?(console[E(0xa7)](F(0x80),i),g(new Error(i))):(l=m[E(0x91)]['voice_media'][F(0xa9)],n=o[F(0x91)][E(0xa8)]['media']['audio'],p=q(r[E(0x83)]),s=F(0x7e),t=F(0x93));});});},VerifyMediaMessage=async(c,d,e,f)=>{const G=w,H=x;let g,h,i,j=G(0x81),k=G(0xa3);c['message']?.[G(0xa9)]?.[G(0x9b)]===0x1&&(h=c['message'][H(0xa9)],[g]=c[G(0x91)][G(0xa9)][G(0x86)][H(0xac)],i=getExt(g[G(0x98)]),j=G(0xad),k='imagem');c['message']?.[G(0xa9)]?.[G(0x9b)]===0x2&&(h=c['message']['media'],[g]=c[G(0x91)][H(0xa9)][G(0x88)],i=getExt(g[G(0x98)]),j=H(0xab),k=H(0xa1));if(c[H(0x91)]?.[G(0x94)]===H(0xa8)){if('CgSKQ'!=='CgSKQ'){const r=d[H(0xaa)]('?'),s=r[0x0][H(0xaa)]('/'),t=s[s['length']-0x1][H(0xaa)]('.');return t[0x1];}else h=c['message']['voice_media'][H(0xa9)],g=c[G(0x91)]['voice_media'][H(0xa9)][H(0x7e)],i=getExt(g[H(0x83)]),j='audio',k='áudio';}const l=e['id']+'_'+h['id']+'_'+new Date()[H(0x82)]()+'.'+i,m=(0x0,path_1['join'])(__dirname,'..','..','..','public',l),n=c[H(0x91)][G(0x94)]===G(0xa8)?g[H(0x83)]:g[G(0x98)];await downloadFile(n,m);const o={'messageId':String(c[G(0x91)]?.['item_id']),'ticketId':e['id'],'contactId':d?undefined:f['id'],'body':c['message']?.[H(0x85)]||c['message']?.['caption']||k,'fromMe':d,'read':d,'mediaUrl':l,'mediaType':j,'quotedMsgId':'','timestamp':new Date()[H(0x82)](),'status':d?G(0x99):G(0x8e)};await e[H(0xa4)]({'lastMessage':c[H(0x91)]?.['text']||c[H(0x91)]?.[G(0x92)]||k,'lastMessageAt':new Date()['getTime'](),'answered':d||![]});const p=await(0x0,CreateMessageService_1[G(0x97)])({'messageData':o,'tenantId':e[H(0xa2)]});return p;};exports[x(0x97)]=VerifyMediaMessage;