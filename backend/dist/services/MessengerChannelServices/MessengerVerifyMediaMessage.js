'use strict';const z=b,A=b;(function(c,d){const x=b,y=b,e=c();while(!![]){try{const f=-parseInt(x(0x90))/0x1*(parseInt(y(0x8e))/0x2)+parseInt(y(0x89))/0x3+parseInt(y(0x7c))/0x4+parseInt(x(0x8b))/0x5*(-parseInt(y(0x81))/0x6)+-parseInt(y(0x93))/0x7+parseInt(x(0x9f))/0x8+parseInt(x(0x9e))/0x9;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xc474c));var __importDefault=this&&this['__importDefault']||function(c){return c&&c['__esModule']?c:{'default':c};};function b(c,d){const e=a();return b=function(f,g){f=f-0x7c;let h=e[f];return h;},b(c,d);}Object[z(0x9a)](exports,A(0x88),{'value':!![]});const path_1=require(A(0xa4)),axios_1=__importDefault(require('axios')),fs_1=require('fs'),content_disposition_1=__importDefault(require(z(0x84))),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),getQuotedForMessageId_1=__importDefault(require(z(0x9c))),downloadFile=async(c,d)=>{const B=z,C=A,e=await(0x0,axios_1[B(0x86)])({'url':c,'method':C(0x8c),'responseType':'stream'}),f=e[B(0xa7)][C(0x84)]?content_disposition_1[C(0x86)][B(0x96)](e[B(0xa7)]['content-disposition']||''):{'parameters':{}};let g='';const h=f?.[B(0xa1)]?.[C(0x87)];if(h){const j=f['parameters'][B(0x87)];g=new Date()[B(0x7f)]()+'-'+j;}else{if('HJiCQ'!=='HJiCQ')k['data']['pipe']((0x0,l['createWriteStream'])(m))['on'](B(0x99),async()=>s(t))['on'](C(0x8a),w=>{const D=C,E=C;s[D(0x8a)](E(0x95),w),t(new u(w));});else{const l=e[B(0xa7)][B(0x8f)],m=l[C(0x94)]('/')[0x1];g=d+'-'+new Date()[B(0x7f)]()+'.'+m;}}const i=(0x0,path_1[B(0x9d)])(__dirname,'..','..','..',B(0x7d),g);return await new Promise((n,o)=>{const F=B,G=C;e['data']['pipe']((0x0,fs_1[F(0x82)])(i))['on']('finish',async()=>n(g))['on'](F(0x8a),p=>{const H=F,I=G;console[H(0x8a)](I(0x95),p),o(new Error(p));});}),g;},MessengerVerifyMediaMessage=async(c,d,e,f)=>{const J=z,K=z;let g;await Promise['all'](d['message'][J(0xa3)][K(0x92)](async(h,i)=>{const L=K,M=J,j=e['id']+'_'+d[L(0xa5)];g=await downloadFile(h[M(0x97)][M(0x80)],j);let k;if(d?.[M(0x9b)]?.[M(0x98)]?.[L(0xa2)]){if(L(0x7e)==='zTolT'){const n=f['parameters'][M(0x87)];g=new h()['getTime']()+'-'+n;}else{const n=await(0x0,getQuotedForMessageId_1['default'])(d['message']['reply_to'][M(0xa2)],e[L(0x83)]);k=n?.['id']||undefined;}}const l={'messageId':i>0x0?d[L(0xa5)]+'__'+i:d['message_id']||'','ticketId':e['id'],'contactId':f['id'],'body':d['message']?.[M(0x91)]||'','fromMe':d[L(0xa0)],'read':![],'mediaUrl':g,'mediaType':d['type'],'quotedMsgId':k,'timestamp':+d[M(0x8d)],'status':M(0xa6)};await e[L(0x85)]({'lastMessage':d[M(0x9b)]?.[M(0x91)]||g||'','lastMessageAt':new Date()[M(0x7f)](),'answered':![]}),await(0x0,CreateMessageService_1[M(0x86)])({'messageData':l,'tenantId':e[M(0x83)]});}));};exports['default']=MessengerVerifyMediaMessage;function a(){const N=['tenantId','content-disposition','update','default','filename','__esModule','3949938mccQpV','error','10wmUfQp','GET','timestamp','1388598VhINUG','content-type','2riXTOK','text','map','2992927dDPtkq','split','ERROR\x20DONWLOAD','parse','payload','reply_to','finish','defineProperty','message','../../helpers/getQuotedForMessageId','join','34407qkOgnk','6006872qPZmbH','fromMe','parameters','mid','attachments','path','message_id','received','headers','3456348rMOLwh','public','TEwrY','getTime','url','943716HoJRfi','createWriteStream'];a=function(){return N;};return a();}