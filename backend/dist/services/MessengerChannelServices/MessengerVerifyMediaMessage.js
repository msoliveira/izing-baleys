'use strict';const z=b,A=b;(function(c,d){const w=b,x=b,e=c();while(!![]){try{const f=-parseInt(w(0x156))/0x1*(-parseInt(x(0x149))/0x2)+parseInt(x(0x13f))/0x3+parseInt(w(0x143))/0x4+parseInt(w(0x146))/0x5*(-parseInt(x(0x153))/0x6)+-parseInt(w(0x145))/0x7*(parseInt(x(0x140))/0x8)+parseInt(w(0x162))/0x9+-parseInt(w(0x15a))/0xa;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x4037e));var __importDefault=this&&this['__importDefault']||function(c){const y=b;return c&&c[y(0x144)]?c:{'default':c};};function a(){const L=['default','1122804rhsmQH','goTJB','error','254642krnPpD','GET','../../helpers/getQuotedForMessageId','type','6703020ljnpUZ','defineProperty','filename','getTime','content-type','reply_to','stream','ERROR\x20DONWLOAD','4432779JRbwIK','content-disposition','message','finish','headers','timestamp','data','all','1311417DVCQMY','10456gqmsve','payload','split','471340rmvexp','__esModule','973WEMACJ','5ooWWDU','map','path','2AZLUFB','mid','message_id','text','parameters','axios','tenantId','../MessageServices/CreateMessageService','jQGed'];a=function(){return L;};return a();}Object[z(0x15b)](exports,'__esModule',{'value':!![]});const path_1=require(z(0x148)),axios_1=__importDefault(require(z(0x14e))),fs_1=require('fs'),content_disposition_1=__importDefault(require(A(0x163))),CreateMessageService_1=__importDefault(require(A(0x150))),getQuotedForMessageId_1=__importDefault(require(z(0x158))),downloadFile=async(c,d)=>{const B=A,C=z,e=await(0x0,axios_1['default'])({'url':c,'method':B(0x157),'responseType':C(0x160)}),f=e[B(0x13b)]['content-disposition']?content_disposition_1[C(0x152)]['parse'](e[C(0x13b)][B(0x163)]||''):{'parameters':{}};let g='';const h=f?.['parameters']?.[C(0x15c)];if(h){const j=f[C(0x14d)][B(0x15c)];g=new Date()[B(0x15d)]()+'-'+j;}else{const k=e[B(0x13b)][C(0x15e)],l=k[C(0x142)]('/')[0x1];g=d+'-'+new Date()[C(0x15d)]()+'.'+l;}const i=(0x0,path_1['join'])(__dirname,'..','..','..','public',g);return await new Promise((m,n)=>{const D=C,E=B;'goTJB'===D(0x154)?e[E(0x13d)]['pipe']((0x0,fs_1['createWriteStream'])(i))['on'](D(0x13a),async()=>m(g))['on']('error',o=>{const F=E,G=E;console[F(0x155)](F(0x161),o),n(new Error(o));}):(h[E(0x155)](D(0x161),i),j(new k(l)));}),g;},MessengerVerifyMediaMessage=async(c,d,e,f)=>{const H=z,I=A;let g;await Promise[H(0x13e)](d[I(0x139)]['attachments'][H(0x147)](async(h,i)=>{const J=H,K=H,j=e['id']+'_'+d[J(0x14b)];g=await downloadFile(h[K(0x141)]['url'],j);let k;if(d?.['message']?.[K(0x15f)]?.[K(0x14a)]){if('ZdHsZ'!==K(0x151)){const m=await(0x0,getQuotedForMessageId_1['default'])(d[K(0x139)][K(0x15f)]['mid'],e[J(0x14f)]);k=m?.['id']||undefined;}else{const o=g[K(0x13b)][J(0x15e)],p=o[K(0x142)]('/')[0x1];h=i+'-'+new j()['getTime']()+'.'+p;}}const l={'messageId':i>0x0?d['message_id']+'__'+i:d[K(0x14b)]||'','ticketId':e['id'],'contactId':f['id'],'body':d['message']?.[J(0x14c)]||'','fromMe':d['fromMe'],'read':![],'mediaUrl':g,'mediaType':d[K(0x159)],'quotedMsgId':k,'timestamp':+d[K(0x13c)],'status':'received'};await e['update']({'lastMessage':d[J(0x139)]?.[K(0x14c)]||g||'','lastMessageAt':new Date()[J(0x15d)](),'answered':![]}),await(0x0,CreateMessageService_1[J(0x152)])({'messageData':l,'tenantId':e[K(0x14f)]});}));};function b(c,d){const e=a();return b=function(f,g){f=f-0x139;let h=e[f];return h;},b(c,d);}exports[z(0x152)]=MessengerVerifyMediaMessage;