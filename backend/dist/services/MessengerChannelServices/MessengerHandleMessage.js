'use strict';const t=b,v=b;function a(){const A=['video','124LWRspR','audio','getMessengerBot','994257dWcLHI','yQMrV','isCampaignMessage','2tBMmxa','43318KWEXuN','HgHAA','page','IoJjK','read','../ChatFlowServices/VerifyStepsChatFlowTicket','shift','messaging','./MessengerVerifyMessage','1820ZJTBNN','isFarewellMessage','entry','location','text','default','mid','image','message','logger','__esModule','length','tenantId','kfMdr','error','7lJoKNN','../WbotServices/helpers/VerifyBusinessHours','9519kuvMki','messenger','__importDefault','42689TsKWhe','./MessengerMarkRead','1982280ALSGbh','2652448xYnrfK','type','2576030EWFYyI','fallback','../../utils/logger','object','file'];a=function(){return A;};return a();}(function(c,d){const r=b,s=b,e=c();while(!![]){try{const f=-parseInt(r(0x119))/0x1*(parseInt(r(0xfb))/0x2)+parseInt(s(0x116))/0x3*(-parseInt(r(0xf5))/0x4)+parseInt(r(0xef))/0x5+parseInt(s(0xec))/0x6*(-parseInt(r(0x114))/0x7)+-parseInt(r(0xed))/0x8+-parseInt(s(0xf8))/0x9+parseInt(r(0x105))/0xa*(parseInt(r(0xfc))/0xb);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x4dbfd));var __importDefault=this&&this[t(0x118)]||function(c){const u=t;return c&&c[u(0x10f)]?c:{'default':c};};Object['defineProperty'](exports,t(0x10f),{'value':!![]});function b(c,d){const e=a();return b=function(f,g){f=f-0xeb;let h=e[f];return h;},b(c,d);}const logger_1=require(t(0xf1)),FindOrCreateTicketService_1=__importDefault(require('../TicketServices/FindOrCreateTicketService')),messengerBot_1=require('../../libs/messengerBot'),MessengerVerifyContact_1=__importDefault(require('./MessengerVerifyContact')),MessengerVerifyMessage_1=__importDefault(require(t(0x104))),MessengerVerifyMediaMessage_1=__importDefault(require('./MessengerVerifyMediaMessage')),VerifyStepsChatFlowTicket_1=__importDefault(require(t(0x101))),MessengerMarkRead_1=__importDefault(require(t(0xeb))),MessengerShowChannel_1=__importDefault(require('./MessengerShowChannel')),VerifyBusinessHours_1=__importDefault(require(v(0x115))),getMessageType=c=>{const w=t,x=v,{attachments:d}=c,e=d&&d[w(0x110)]>0x0;if(c[w(0x109)]&&!e)return x(0x109);if(e&&d[0x0][w(0xee)]===w(0x10c))return'image';if(e&&d[0x0][w(0xee)]==='audio')return w(0xf6);if(e&&d[0x0][w(0xee)]===w(0xf4))return w(0xf4);if(e&&d[0x0]['type']==='location')return x(0x108);if(e&&d[0x0][x(0xee)]===w(0xf3))return w(0xf3);if(e&&d[0x0][x(0xee)]===w(0xf0))return w(0xf0);},MessengerHandleMessage=async c=>{return new Promise((d,e)=>{((async()=>{const y=b,z=b;let f,g;const h=0x1;try{if(c[y(0xf2)]!==y(0xfe))return;const i=c[z(0x107)][y(0x102)](),j=i?.[y(0x103)][y(0x102)]();f=await(0x0,MessengerShowChannel_1[z(0x10a)])({'fbPageId':i['id']});if(!f)return;const k=await(0x0,messengerBot_1[y(0xf7)])(f['id']);if(!j?.[z(0x10d)]&&j[z(0x100)]){if(y(0xff)!==y(0xfd)){(0x0,MessengerMarkRead_1[y(0x10a)])(j,f[z(0x111)]);return;}else g[y(0x10e)][z(0x113)](h),i(j);}g=await(0x0,MessengerVerifyContact_1['default'])(j['sender'],k,f[z(0x111)]);const l={...j,'type':getMessageType(j['message']),'fromMe':![],'body':j?.[y(0x10d)]?.[y(0x109)]||'','timestamp':j['timestamp'],'message_id':j[y(0x10d)][z(0x10b)]},m=await(0x0,FindOrCreateTicketService_1['default'])({'contact':g,'whatsappId':f['id'],'unreadMessages':h,'tenantId':f[y(0x111)],'msg':l,'channel':z(0x117)});if(m?.[z(0xfa)]){d();return;}if(m?.[z(0x106)]){if(y(0x112)===z(0xf9)){const {attachments:p}=e,q=p&&p[y(0x110)]>0x0;if(f[z(0x109)]&&!q)return y(0x109);if(q&&p[0x0][z(0xee)]===z(0x10c))return z(0x10c);if(q&&p[0x0]['type']===y(0xf6))return y(0xf6);if(q&&p[0x0][y(0xee)]==='video')return z(0xf4);if(q&&p[0x0][y(0xee)]===y(0x108))return z(0x108);if(q&&p[0x0][y(0xee)]===z(0xf3))return y(0xf3);if(q&&p[0x0][y(0xee)]===y(0xf0))return z(0xf0);}else{d();return;}}l[y(0xee)]!==z(0x109)?await(0x0,MessengerVerifyMediaMessage_1[z(0x10a)])(f,l,m,g):await(0x0,MessengerVerifyMessage_1[y(0x10a)])(l,m,g),await(0x0,VerifyStepsChatFlowTicket_1[y(0x10a)])(l,m),await(0x0,VerifyBusinessHours_1[z(0x10a)])(l,m),d();}catch(p){logger_1['logger'][y(0x113)](p),e(p);}})());});};exports[v(0x10a)]=MessengerHandleMessage;