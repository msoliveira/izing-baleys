'use strict';const I=b,J=b;(function(c,d){const G=b,H=b,e=c();while(!![]){try{const f=parseInt(G(0x149))/0x1*(-parseInt(G(0x131))/0x2)+-parseInt(H(0x152))/0x3*(parseInt(H(0x165))/0x4)+parseInt(H(0x142))/0x5*(parseInt(H(0x15a))/0x6)+-parseInt(G(0x151))/0x7*(-parseInt(G(0x140))/0x8)+-parseInt(G(0x162))/0x9+-parseInt(H(0x13c))/0xa+parseInt(H(0x154))/0xb;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xed5b1));function a(){const W=['findOne','3268dehGNr','__esModule','sendMessage','__createBinding','writable','whatsapp','create','getOwnPropertyDescriptor','get','attrs','../../utils/logger','11757140ZOHuYU','../../models/Message','__setModuleDefault','call-id','3752TCIeEi','offer','5aofpDp','error','../BaileysServices/CreateOrUpdateBaileysService','vkmKQ','../../models/Setting','prototype','ebwsm','370ZvAWPP','value','logger','enabled','As\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.','../../models/Contact','tag','ttTxk','1484oMoOvm','78471ihGLHn','klqTG','39819538OLuNau','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20','getMinutes','default','rejectCall','rejectCalls','6877206vDmhxu','../TicketServices/FindOrCreateTicketService','replace','__importStar','call-creator','getHours','call','contacts.upsert','7482519dQjVUC','defineProperty','content','196rwPvGE'];a=function(){return W;};return a();}var __createBinding=this&&this[I(0x134)]||(Object[J(0x137)]?function(c,d,e,f){const K=J,L=I;if(f===undefined)f=e;var g=Object[K(0x138)](d,e);(!g||(K(0x139)in g?!d[L(0x132)]:g[L(0x135)]||g['configurable']))&&(g={'enumerable':!![],'get':function(){return d[e];}}),Object[L(0x163)](c,f,g);}:function(c,d,e,f){if(f===undefined)f=e;c[f]=d[e];}),__setModuleDefault=this&&this[J(0x13e)]||(Object[I(0x137)]?function(c,d){const M=I,N=I;Object[M(0x163)](c,M(0x157),{'enumerable':!![],'value':d});}:function(c,d){c['default']=d;}),__importStar=this&&this[J(0x15d)]||function(c){const O=J,P=J;if(c&&c['__esModule'])return c;var d={};if(c!=null){for(var e in c)if(e!==O(0x157)&&Object[O(0x147)]['hasOwnProperty']['call'](c,e))__createBinding(d,c,e);}return __setModuleDefault(d,c),d;},__importDefault=this&&this['__importDefault']||function(c){const Q=J;return c&&c[Q(0x132)]?c:{'default':c};};function b(c,d){const e=a();return b=function(f,g){f=f-0x131;let h=e[f];return h;},b(c,d);}Object[J(0x163)](exports,I(0x132),{'value':!![]});const Sentry=__importStar(require('@sentry/node')),Contact_1=__importDefault(require(J(0x14e))),Setting_1=__importDefault(require(I(0x146))),logger_1=require(J(0x13b)),CreateOrUpdateBaileysService_1=__importDefault(require(J(0x144))),FindOrCreateTicketService_1=__importDefault(require(J(0x15b))),Message_1=__importDefault(require(I(0x13d))),wbotMonitor=async(c,d,e)=>{const R=I,S=J;try{if(R(0x148)!==R(0x148)){if(k===l)m=n;o[p]=q[r];}else c['ws']['on']('CB:call',async g=>{const T=R,U=R,h=g[T(0x164)][0x0];if(h[T(0x14f)]===T(0x141)){if('klqTG'!==U(0x153))e[U(0x157)]=f;else{const j=await Setting_1[U(0x157)][U(0x166)]({'where':{'key':T(0x159),'tenantId':e}});j[T(0x14a)]===U(0x14c)&&c[U(0x158)](h['attrs'][T(0x13f)],h[T(0x13a)][T(0x15e)]);}}if(h[T(0x14f)]==='terminate'){if('WXQuV'!=='LEMvM'){const k=await Setting_1[U(0x157)][T(0x166)]({'where':{'key':'rejectCalls','tenantId':e}});if(k['value']==='enabled'){if(T(0x150)!==T(0x145)){const l=U(0x14d),m=await Setting_1[T(0x157)]['findOne']({'where':{'key':'callRejectMessage','tenantId':e}}),n=await c[U(0x133)](g['attrs']['from'],{'text':m[U(0x14a)]||l}),o=g[T(0x13a)]['from'][T(0x15c)](/\D/g,''),p=await Contact_1[U(0x157)]['findOne']({'where':{'tenantId':e,'number':o}}),q=await(0x0,FindOrCreateTicketService_1['default'])({'contact':p,'whatsappId':c['id'],'unreadMessages':0x1,'tenantId':e,'channel':T(0x136)}),r=new Date(),s=r[T(0x15f)](),t=r[T(0x156)](),u=U(0x155)+s+':'+t,v={'messageId':n['key']['id'],'ticketId':q['id'],'contactId':p['id'],'body':u,'dataJson':n+'','fromMe':![],'mediaType':T(0x160),'read':!![],'quotedMsgId':null,'ack':0x1};await q['update']({'lastMessage':u}),await Message_1[T(0x157)]['create']({...v,'tenantId':e});}else f[T(0x158)](g[T(0x13a)][T(0x13f)],h[T(0x13a)][U(0x15e)]);}}else return e[f];}}),c['ev']['on'](S(0x161),async g=>{const V=R;await(0x0,CreateOrUpdateBaileysService_1[V(0x157)])({'whatsappId':d['id'],'contacts':g});});}catch(g){Sentry['captureException'](g),logger_1[S(0x14b)][R(0x143)](g);}};exports[J(0x157)]=wbotMonitor;