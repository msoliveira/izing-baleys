'use strict';const I=b,J=b;(function(c,d){const G=b,H=b,e=c();while(!![]){try{const f=-parseInt(G(0x1e9))/0x1+-parseInt(H(0x20c))/0x2+parseInt(H(0x1f2))/0x3+parseInt(G(0x202))/0x4*(parseInt(G(0x205))/0x5)+-parseInt(H(0x1cb))/0x6*(parseInt(G(0x219))/0x7)+parseInt(G(0x1c7))/0x8*(parseInt(G(0x213))/0x9)+parseInt(H(0x225))/0xa*(parseInt(G(0x1d0))/0xb);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xc2049));var __createBinding=this&&this[I(0x1fb)]||(Object[J(0x204)]?function(c,d,e,f){const K=I,L=J;if(f===undefined)f=e;var g=Object[K(0x21f)](d,e);(!g||(K(0x1d2)in g?!d[L(0x206)]:g[K(0x209)]||g[L(0x1df)]))&&(g={'enumerable':!![],'get':function(){if('JDSMc'!=='JDSMc'){if(e===l)d=n;c[p]=q[r];}else return d[e];}}),Object['defineProperty'](c,f,g);}:function(c,d,e,f){if(f===undefined)f=e;c[f]=d[e];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[I(0x204)]?function(c,d){const M=I,N=I;Object[M(0x1fa)](c,M(0x21d),{'enumerable':!![],'value':d});}:function(c,d){const O=I;c[O(0x21d)]=d;}),__importStar=this&&this['__importStar']||function(c){const P=I,Q=I;if(c&&c[P(0x206)])return c;var d={};if(c!=null){for(var e in c)if(e!==Q(0x21d)&&Object['prototype']['hasOwnProperty'][Q(0x1f5)](c,e))__createBinding(d,c,e);}return __setModuleDefault(d,c),d;},__importDefault=this&&this[I(0x214)]||function(c){const R=I;return c&&c[R(0x206)]?c:{'default':c};};Object[J(0x1fa)](exports,J(0x206),{'value':!![]}),exports[J(0x1da)]=void 0x0;function b(c,d){const e=a();return b=function(f,g){f=f-0x1c4;let h=e[f];return h;},b(c,d);}const path_1=__importStar(require(J(0x1c5))),sequelize_1=require(I(0x201)),Message_1=__importDefault(require(J(0x1d9))),Ticket_1=__importDefault(require(J(0x1e1))),logger_1=require(J(0x1d1)),fs_1=__importDefault(require('fs')),mime_types_1=__importDefault(require(J(0x20d))),child_process_1=require(I(0x217)),ffmpeg_1=__importDefault(require(I(0x1f3))),SetTicketMessagesAsRead_1=__importDefault(require('../../helpers/SetTicketMessagesAsRead')),publicFolder=path_1['default']['resolve'](__dirname,'..','..','..',J(0x221)),SendMessagesSystemWbotBaileys=async(c,d,e=undefined)=>{const S=I,T=I;let f;if(!e){const h={'fromMe':!![],'messageId':{[sequelize_1['Op']['is']]:null},'status':S(0x1ef),[sequelize_1['Op']['or']]:[{'scheduleDate':{[sequelize_1['Op'][T(0x20f)]]:new Date()}},{'scheduleDate':{[sequelize_1['Op']['is']]:null}}]};f=await Message_1[S(0x21d)]['findAll']({'where':h,'include':[{'model':Ticket_1[S(0x21d)],'as':T(0x1eb),'where':{'tenantId':d,[sequelize_1['Op']['or']]:{'status':{[sequelize_1['Op']['ne']]:S(0x226)},'isFarewellMessage':!![]},'channel':S(0x223),'whatsappId':c['id']},'include':[S(0x1d7)]}],'order':[[T(0x21a),S(0x1ff)]]});}else{if(T(0x1e0)!=='haZzv')f=e;else throw new d(S(0x224));}let g;await f[T(0x1fe)](async j=>{const U=S,V=S;if(U(0x1e4)===V(0x1e4)){let k={};const {ticket:l}=j,m=l[V(0x1d7)][V(0x1cc)],n=l?.['isGroup']?V(0x1e5):V(0x1dc),o=m+'@'+n;if(j[U(0x1e8)]){if(U(0x1e7)==='rilUN')h={'audio':i[V(0x21d)][V(0x1dd)](j),'mimetype':k?V(0x203):l,'ptt':!![]};else{const q=await Message_1[U(0x21d)][V(0x1db)]({'where':{'id':j[U(0x1e8)]}});k=q;}}try{if(U(0x1fc)!==U(0x1fc))e=f;else{if(j[V(0x1f0)]!==U(0x1fd)&&j[U(0x220)]){const t=await(0x0,path_1['join'])(__dirname,'..','..','..',V(0x221)),u=(0x0,path_1[U(0x1cf)])(t,j[V(0x220)]),v=await(0x0,exports['getMessageOptions'])(j['mediaName'],u);v&&(g=await c[U(0x1d4)](o,{...v})),logger_1[U(0x1d8)][V(0x20b)](V(0x1f6));}else{if(U(0x200)!=='ivkxV'){if(k['id']){if(U(0x1ec)!==V(0x1f7)){let w={'quoted':{'key':{'remoteJid':o,'id':k['messageId']},'message':{'extendedTextMessage':{'text':k['body']}}}};g=await c[V(0x1d4)](o,{'text':j[V(0x1c8)]},{...w});}else e[U(0x21d)]=f;}else'JwVBm'===U(0x1c9)?(0x0,j['exec'])(k['default']['path']+V(0x21e)+l+U(0x211)+m+V(0x1f9),(z,A,B)=>{if(z)q(z);r(s);}):g=await c['sendMessage'](o,{'text':j[U(0x1c8)]});logger_1[U(0x1d8)][U(0x20b)](V(0x1f4));}else return e[V(0x1d8)][V(0x1ed)](f),null;}const s={'messageId':g[V(0x1f8)]['id'],'status':U(0x1c4)};await Message_1[V(0x21d)][U(0x1c6)]({...s},{'where':{'id':j['id']}}),logger_1['logger'][U(0x20b)](V(0x1e2)),await(0x0,SetTicketMessagesAsRead_1[U(0x21d)])(l),logger_1[U(0x1d8)][V(0x20b)](V(0x1d4));}}catch(A){if(U(0x1ce)!==V(0x222)){const B=j['id'],C=j[U(0x1eb)]['id'];A[V(0x215)]===U(0x212)&&await Message_1[V(0x21d)][U(0x207)]({'where':{'id':j['id']}}),logger_1[V(0x1d8)][V(0x1ed)](U(0x216)+d+V(0x1f1)+C+')'),logger_1[V(0x1d8)]['error'](U(0x20a)+B+U(0x1cd)+A);}else{if(p===q)r=s;var F=t[U(0x21f)](u,v);(!F||(U(0x1d2)in F?!w[U(0x206)]:F[V(0x209)]||F['configurable']))&&(F={'enumerable':!![],'get':function(){return F[F];}}),z[U(0x1fa)](A,B,F);}}}else j={'video':k[U(0x21d)][V(0x1dd)](l),'caption':m?n:o,'fileName':p};});},getMessageOptions=async(c,d,f)=>{const W=J,X=J,g=mime_types_1[W(0x21d)][X(0x1d3)](d),h=String(g)['split']('/')[0x0];try{if(X(0x218)!==X(0x218))i={'image':j[X(0x21d)][X(0x1dd)](k),'caption':l?m:n};else{if(!g){if('gdvwO'!==W(0x1de)){const l=i+'/'+new j()[W(0x1e6)]()+X(0x1d5);return new k((t,u)=>{const Y=X,Z=X;(0x0,l[Y(0x20e)])(p[Y(0x21d)][Z(0x1c5)]+Z(0x21e)+q+Y(0x211)+l+Y(0x1f9),(w,x,y)=>{if(w)u(w);t(l);});});}else throw new Error('Invalid\x20mimetype');}let j;if(h===X(0x21b))j={'video':fs_1[X(0x21d)][X(0x1dd)](d),'caption':f?f:c,'fileName':c};else{if(h===W(0x1e3)){const l=c[X(0x210)](X(0x1ea)),m=await processAudio(d);l?j={'audio':fs_1[W(0x21d)][X(0x1dd)](m),'mimetype':l?W(0x203):g,'ptt':!![]}:W(0x1d6)!==W(0x1d6)?h={'audio':i[X(0x21d)][X(0x1dd)](j),'mimetype':k?X(0x203):l,'ptt':!![]}:j={'audio':fs_1[W(0x21d)][X(0x1dd)](m),'mimetype':l?X(0x203):g,'ptt':!![]};}else{if(h===X(0x1ee)){if(X(0x21c)!==X(0x208))j={'document':fs_1[W(0x21d)]['readFileSync'](d),'caption':f?f:c,'fileName':c,'mimetype':g};else return g&&h[X(0x206)]?i:{'default':j};}else h===X(0x1ca)?j={'document':fs_1[X(0x21d)][W(0x1dd)](d),'caption':f?f:c,'fileName':c,'mimetype':g}:j={'image':fs_1[X(0x21d)][X(0x1dd)](d),'caption':f?f:c};}}return j;}}catch(p){return logger_1[W(0x1d8)]['error'](p),null;}};exports['getMessageOptions']=getMessageOptions;const processAudio=async c=>{const a0=I,d=publicFolder+'/'+new Date()[a0(0x1e6)]()+'.mp3';return new Promise((e,f)=>{const a1=a0,a2=a0;(0x0,child_process_1[a1(0x20e)])(ffmpeg_1[a2(0x21d)][a1(0x1c5)]+a1(0x21e)+c+a2(0x211)+d+a2(0x1f9),(g,h,i)=>{if(g)f(g);e(d);});});};function a(){const a3=['../../models/Ticket','Message\x20Update','audio','MRKrI','g.us','getTime','DkDix','quotedMsgId','1039328fDsuoL','audio-record-site','ticket','AITPV','error','document','pending','mediaType','\x20|\x20Ticket:\x20','3783771QVKKmk','@ffmpeg-installer/ffmpeg','sendMessage\x20text','call','sendMessage\x20media','itPmf','key','\x20-y','defineProperty','__createBinding','XnzAQ','chat','forEach','ASC','KGRYk','sequelize','4678172wxnoTT','audio/mp4','create','5vmtkxE','__esModule','destroy','xieRR','writable','Error\x20send\x20message\x20(id:\x20','info','1367516ZeZViF','mime-types','exec','lte','includes','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','ENOENT','895815uzqLsh','__importDefault','code','Error\x20message\x20is\x20(tenant:\x20','child_process','xlCRE','1691403BKGZVg','createdAt','video','IukiY','default','\x20-i\x20','getOwnPropertyDescriptor','mediaName','public','KHXKn','whatsapp','Invalid\x20mimetype','7404770JMnmUO','closed','sended','path','update','64JxleZd','body','uUese','application','36aSeyub','number',')::','VcEWK','join','11EqzNrN','../../utils/logger','get','lookup','sendMessage','.mp3','hcFKQ','contact','logger','../../models/Message','getMessageOptions','findOne','s.whatsapp.net','readFileSync','gdvwO','configurable','fttBB'];a=function(){return a3;};return a();}exports[J(0x21d)]=SendMessagesSystemWbotBaileys;