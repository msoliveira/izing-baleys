'use strict';const I=b,J=b;(function(c,d){const G=b,H=b,e=c();while(!![]){try{const f=parseInt(G(0x1a5))/0x1+-parseInt(H(0x1c9))/0x2+-parseInt(G(0x1cd))/0x3*(-parseInt(H(0x1ff))/0x4)+-parseInt(H(0x1ef))/0x5+-parseInt(H(0x1de))/0x6*(parseInt(G(0x206))/0x7)+-parseInt(H(0x1bb))/0x8*(-parseInt(H(0x1ce))/0x9)+parseInt(H(0x1e2))/0xa*(-parseInt(G(0x1af))/0xb);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x9f127));var __createBinding=this&&this[I(0x1c2)]||(Object[J(0x1d1)]?function(c,d,e,f){const K=J,L=J;if(f===undefined)f=e;var g=Object['getOwnPropertyDescriptor'](d,e);(!g||(K(0x1fd)in g?!d[K(0x1e8)]:g[L(0x1c1)]||g[K(0x1fb)]))&&(g={'enumerable':!![],'get':function(){return d[e];}}),Object['defineProperty'](c,f,g);}:function(c,d,e,f){if(f===undefined)f=e;c[f]=d[e];}),__setModuleDefault=this&&this[J(0x1a8)]||(Object[I(0x1d1)]?function(c,d){const M=I,N=I;Object[M(0x1fc)](c,N(0x1ca),{'enumerable':!![],'value':d});}:function(c,d){const O=J;c[O(0x1ca)]=d;}),__importStar=this&&this[I(0x1d0)]||function(c){const P=I,Q=I;if(c&&c[P(0x1e8)])return c;var d={};if(c!=null){for(var e in c)if(e!==P(0x1ca)&&Object[Q(0x1a4)]['hasOwnProperty'][P(0x1d6)](c,e))__createBinding(d,c,e);}return __setModuleDefault(d,c),d;},__importDefault=this&&this[I(0x1d8)]||function(c){const R=I;return c&&c[R(0x1e8)]?c:{'default':c};};Object[I(0x1fc)](exports,I(0x1e8),{'value':!![]}),exports[J(0x1cc)]=void 0x0;function a(){const a3=['messageId','\x20-y','alPWl','8hVVHNM','../../utils/logger','key','forEach','SrzWN','audio','writable','__createBinding','ZXpGN','getOwnPropertyDescriptor','YOBVw','audio/mp4','destroy','getTime','1633206FiDVDx','default','audio-record-site','getMessageOptions','36SbWcsC','9955809qxUEIr','.mp3','__importStar','create','oXltA','update','video','lookup','call','BIhKn','__importDefault',')::','SAWhd','g.us','EGKxc','contact','263994qWbZBW','whatsapp','gDbeZ','ticket','10XSTTHH','sequelize','hwhOR','join','logger','readFileSync','__esModule','number','Error\x20message\x20is\x20(tenant:\x20','YIKMT','pending','public','path','4112145pGbycp','exec','includes','application','ASC','findOne','Message\x20Update','uObYS','Error\x20send\x20message\x20(id:\x20','error','@ffmpeg-installer/ffmpeg','\x20-i\x20','configurable','defineProperty','get','body','348724yYGRYl','document','sendMessage\x20text','findAll','split','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','sended','42qZdbYF','prototype','951620EplIko','OXfYE','mediaName','__setModuleDefault','info','lte','code','Invalid\x20mimetype','../../models/Message','\x20|\x20Ticket:\x20','6043488MiwLAi','VFPPf','chat','resolve','evcFi','sendMessage','RjeZo','sendMessage\x20media','mime-types'];a=function(){return a3;};return a();}const path_1=__importStar(require('path')),sequelize_1=require(J(0x1e3)),Message_1=__importDefault(require(I(0x1ad))),Ticket_1=__importDefault(require('../../models/Ticket')),logger_1=require(J(0x1bc)),fs_1=__importDefault(require('fs')),mime_types_1=__importDefault(require(I(0x1b7))),child_process_1=require('child_process'),ffmpeg_1=__importDefault(require(J(0x1f9))),SetTicketMessagesAsRead_1=__importDefault(require('../../helpers/SetTicketMessagesAsRead')),publicFolder=path_1[I(0x1ca)][J(0x1b2)](__dirname,'..','..','..',I(0x1ed)),SendMessagesSystemWbotBaileys=async(c,d,e=undefined)=>{const S=J,T=J;let f;if(!e){if(S(0x1ba)===S(0x1ba)){const h={'fromMe':!![],'messageId':{[sequelize_1['Op']['is']]:null},'status':T(0x1ec),[sequelize_1['Op']['or']]:[{'scheduleDate':{[sequelize_1['Op'][T(0x1aa)]]:new Date()}},{'scheduleDate':{[sequelize_1['Op']['is']]:null}}]};f=await Message_1['default'][S(0x202)]({'where':h,'include':[{'model':Ticket_1['default'],'as':'ticket','where':{'tenantId':d,[sequelize_1['Op']['or']]:{'status':{[sequelize_1['Op']['ne']]:'closed'},'isFarewellMessage':!![]},'channel':S(0x1df),'whatsappId':c['id']},'include':[S(0x1dd)]}],'order':[['createdAt',T(0x1f3)]]});}else{const j=i+'/'+new j()[T(0x1c8)]()+S(0x1cf);return new k((t,u)=>{const U=S,V=T;(0x0,j[U(0x1f0)])(p['default'][U(0x1ee)]+V(0x1fa)+q+U(0x204)+j+'\x20-y',(w,x,y)=>{if(w)u(w);t(j);});});}}else f=e;let g;await f[T(0x1be)](async j=>{const W=T,X=S;if(W(0x1a6)===W(0x1bf))e['default']=f;else{let l={};const {ticket:m}=j,n=m[X(0x1dd)][W(0x1e9)],o=m?.['isGroup']?X(0x1db):'s.whatsapp.net',p=n+'@'+o;if(j['quotedMsgId']){const q=await Message_1[W(0x1ca)][W(0x1f4)]({'where':{'id':j['quotedMsgId']}});l=q;}try{if(W(0x1dc)===X(0x1dc)){if(j['mediaType']!==X(0x1b1)&&j[W(0x1a7)]){if(X(0x1e0)===W(0x1e0)){const s=await(0x0,path_1[X(0x1e5)])(__dirname,'..','..','..','public'),t=(0x0,path_1[W(0x1e5)])(s,j['mediaName']),u=await(0x0,exports['getMessageOptions'])(j[W(0x1a7)],t);u&&(X(0x1c3)===X(0x1d7)?k={'document':l['default'][W(0x1e7)](m),'caption':n?o:p,'fileName':q,'mimetype':r}:g=await c[W(0x1b4)](p,{...u})),logger_1['logger']['info'](X(0x1b6));}else h={'audio':i[W(0x1ca)]['readFileSync'](j),'mimetype':k?X(0x1c6):l,'ptt':!![]};}else{if(W(0x1c5)===W(0x1b3))e=f;else{if(l['id']){let y={'quoted':{'key':{'remoteJid':p,'id':l[W(0x1b8)]},'message':{'extendedTextMessage':{'text':l['body']}}}};g=await c[W(0x1b4)](p,{'text':j[W(0x1fe)]},{...y});}else{if(W(0x1eb)===X(0x1eb))g=await c[X(0x1b4)](p,{'text':j[X(0x1fe)]});else return e[X(0x1e6)]['error'](f),null;}logger_1[W(0x1e6)][X(0x1a9)](W(0x201));}}const r={'messageId':g[X(0x1bd)]['id'],'status':W(0x205)};await Message_1['default'][X(0x1d3)]({...r},{'where':{'id':j['id']}}),logger_1['logger'][W(0x1a9)](X(0x1f5)),await(0x0,SetTicketMessagesAsRead_1[W(0x1ca)])(m),logger_1['logger'][W(0x1a9)](W(0x1b4));}else h={'audio':i[X(0x1ca)][X(0x1e7)](j),'mimetype':k?X(0x1c6):l,'ptt':!![]};}catch(B){const C=j['id'],D=j[W(0x1e1)]['id'];B[W(0x1ab)]==='ENOENT'&&await Message_1[W(0x1ca)][X(0x1c7)]({'where':{'id':j['id']}}),logger_1[X(0x1e6)]['error'](W(0x1ea)+d+X(0x1ae)+D+')'),logger_1[W(0x1e6)][X(0x1f8)](W(0x1f7)+C+X(0x1d9)+B);}}});},getMessageOptions=async(c,d,f)=>{const Y=I,Z=J,g=mime_types_1[Y(0x1ca)][Z(0x1d5)](d),h=String(g)[Y(0x203)]('/')[0x0];try{if(!g)throw new Error(Y(0x1ac));let i;if(h===Y(0x1d4))i={'video':fs_1[Y(0x1ca)][Z(0x1e7)](d),'caption':f?f:c,'fileName':c};else{if(h===Y(0x1c0)){if('QxoAp'!=='QxoAp')k={'document':l['default']['readFileSync'](m),'caption':n?o:p,'fileName':q,'mimetype':r};else{const k=c[Z(0x1f1)](Z(0x1cb)),l=await processAudio(d);if(k)'IDuyf'===Z(0x1f6)?(0x0,j[Z(0x1f0)])(k['default'][Y(0x1ee)]+'\x20-i\x20'+l+Y(0x204)+m+Z(0x1b9),(w,x,y)=>{if(w)q(w);r(s);}):i={'audio':fs_1[Z(0x1ca)][Y(0x1e7)](l),'mimetype':k?Y(0x1c6):g,'ptt':!![]};else{if(Y(0x1e4)===Z(0x1e4))i={'audio':fs_1[Y(0x1ca)][Z(0x1e7)](l),'mimetype':k?Z(0x1c6):g,'ptt':!![]};else{if(p===q)r=s;var o=t[Z(0x1c4)](u,v);(!o||('get'in o?!w[Y(0x1e8)]:o[Y(0x1c1)]||o[Z(0x1fb)]))&&(o={'enumerable':!![],'get':function(){return o[F];}}),z[Z(0x1fc)](A,B,o);}}}}else{if(h===Y(0x200)){if(Y(0x1b5)!==Z(0x1b5))return e[f];else i={'document':fs_1['default'][Y(0x1e7)](d),'caption':f?f:c,'fileName':c,'mimetype':g};}else{if(h===Z(0x1f2))i={'document':fs_1[Y(0x1ca)]['readFileSync'](d),'caption':f?f:c,'fileName':c,'mimetype':g};else{if(Y(0x1da)!=='IWucp')i={'image':fs_1[Z(0x1ca)][Z(0x1e7)](d),'caption':f?f:c};else{if(h)i(j);k(l);}}}}}return i;}catch(q){if(Y(0x1b0)===Y(0x1b0))return logger_1['logger'][Z(0x1f8)](q),null;else i={'image':j[Z(0x1ca)][Z(0x1e7)](k),'caption':l?m:n};}};exports[I(0x1cc)]=getMessageOptions;const processAudio=async c=>{const a0=J,d=publicFolder+'/'+new Date()['getTime']()+a0(0x1cf);return new Promise((e,f)=>{const a1=a0,a2=a0;if(a1(0x1d2)!=='BilOM')(0x0,child_process_1[a1(0x1f0)])(ffmpeg_1['default'][a1(0x1ee)]+'\x20-i\x20'+c+'\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20'+d+a2(0x1b9),(g,h,i)=>{if(g)f(g);e(d);});else return g&&h[a2(0x1e8)]?i:{'default':j};});};function b(c,d){const e=a();return b=function(f,g){f=f-0x1a4;let h=e[f];return h;},b(c,d);}exports[J(0x1ca)]=SendMessagesSystemWbotBaileys;