'use strict';const y=b,A=b;(function(c,d){const w=b,x=b,e=c();while(!![]){try{const f=parseInt(w(0x133))/0x1+parseInt(x(0x13f))/0x2*(parseInt(x(0x129))/0x3)+-parseInt(x(0x130))/0x4*(parseInt(x(0x157))/0x5)+-parseInt(x(0x142))/0x6*(parseInt(w(0x122))/0x7)+parseInt(w(0x152))/0x8*(parseInt(w(0x13d))/0x9)+parseInt(w(0x148))/0xa*(parseInt(w(0x12e))/0xb)+-parseInt(w(0x151))/0xc;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x7f222));function a(){const F=['exists','bjMST','../../libs/wbot-baileys','Numero','E-mail','__importDefault','5822520QDYjup','4089664CaSSyq','CONTACT_NOT_FOUND','e-mail','CONNECTED','findOne','14015nDFgUq','head','Email','error','Nome','lodash','7xiyczC','jid','readFile','findOrCreate','ImportFileContactsService','push','../../models/Contact','555mzaubN','@$s.whatsapp.net','length','onWhatsApp','ByXnd','1287Hfhtqo','setTags','1316rfJhyH','Número\x20não\x20é\x20uma\x20conta\x20válida\x20','setWallets','588424yQwutR','../../models/Whatsapp','__esModule','../../errors/AppError','defineProperty','split','values','replace','rEPDU','tenantId','18tFOUfu','número','8362CLdhKL','email','number','2858586EQFFys','NOT_FOUND_WHATSAPP_CONNECTED','Número','has','wwaOW','numero','1730WAsxtq','nome','default'];a=function(){return F;};return a();}var __importDefault=this&&this[y(0x150)]||function(c){const z=y;return c&&c[z(0x135)]?c:{'default':c};};Object[A(0x137)](exports,y(0x135),{'value':!![]}),exports[y(0x126)]=void 0x0;const lodash_1=require(A(0x121)),xlsx_1=__importDefault(require('xlsx')),Contact_1=__importDefault(require(A(0x128))),Whatsapp_1=__importDefault(require(A(0x134))),AppError_1=__importDefault(require(y(0x136))),wbot_baileys_1=require(A(0x14d));async function ImportFileContactsService(c,d,e,f){const B=A,C=A,g=xlsx_1['default'][B(0x124)](d?.['path']),h=(0x0,lodash_1[C(0x158)])(Object[B(0x139)](g['Sheets'])),i=xlsx_1[B(0x14a)]['utils']['sheet_to_json'](h,{'header':0x0}),j=[];i['forEach'](l=>{const D=C,E=C;if('ByXnd'!==D(0x12d))f=g['nome']||h[D(0x120)];else{let n='',o='',p='';((0x0,lodash_1['has'])(l,E(0x149))||(0x0,lodash_1['has'])(l,D(0x120)))&&(n=l['nome']||l[D(0x120)]),((0x0,lodash_1[D(0x145)])(l,'numero')||(0x0,lodash_1[E(0x145)])(l,D(0x13e))||(0x0,lodash_1[D(0x145)])(l,E(0x14e))||(0x0,lodash_1[E(0x145)])(l,E(0x144)))&&(o=l[D(0x147)]||l[D(0x13e)]||l[E(0x14e)]||l[E(0x144)],o=(''+o)[D(0x13a)](/\D/g,'')),((0x0,lodash_1[D(0x145)])(l,E(0x140))||(0x0,lodash_1['has'])(l,E(0x154))||(0x0,lodash_1[D(0x145)])(l,E(0x159))||(0x0,lodash_1[D(0x145)])(l,E(0x14f)))&&(p=l['email']||l['e-mail']||l[E(0x159)]||l['E-mail']),n=n||o,n&&o&&o[E(0x12b)]>=0xa&&(E(0x13b)==='rEPDU'?j['push']({'name':n,'number':o,'email':p,'tenantId':c}):e[E(0x127)](f));}});const k=[];for(const l of j){try{l[B(0x141)]=l['number']['replace']('-','')['replace']('\x20','')['replace']('(','')['replace'](')','');const m=await Whatsapp_1[B(0x14a)][C(0x156)]({'where':{'status':C(0x155),'tenantId':c,'type':'whatsapp'}});if(!m)throw new AppError_1['default'](B(0x143),0x194);const n=(0x0,wbot_baileys_1['getWbot'])(m['id']),o=l['number']+C(0x12a),p=await n[C(0x12c)](o);if(p[0x0][B(0x14b)]==![]){if(C(0x146)===C(0x146))throw new AppError_1[(C(0x14a))](B(0x153),0x194);else e[B(0x15a)]('Número\x20não\x20é\x20uma\x20conta\x20válida\x20'+f[B(0x141)]);}l[C(0x141)]=p[0x0][B(0x123)][C(0x138)]('@')[0x0];const [q,r]=await Contact_1['default'][C(0x125)]({'where':{'number':l[B(0x141)],'tenantId':l[B(0x13c)]},'defaults':l}),s=q;r&&k[C(0x127)](q),e?.[B(0x12b)]&&await s[B(0x12f)](e,{'through':{'tenantId':c}}),f?.[C(0x12b)]&&await s[C(0x132)](f,{'through':{'tenantId':c}});}catch(u){'bjMST'===B(0x14c)?console[C(0x15a)](C(0x131)+l[B(0x141)]):(j=k[C(0x147)]||l['número']||m[B(0x14e)]||n[C(0x144)],o=(''+p)['replace'](/\D/g,''));}}return k;}function b(c,d){const e=a();return b=function(f,g){f=f-0x120;let h=e[f];return h;},b(c,d);}exports[A(0x126)]=ImportFileContactsService;