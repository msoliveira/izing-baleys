'use strict';const u=b,v=b;(function(c,d){const r=b,s=b,e=c();while(!![]){try{const f=parseInt(r(0x1a2))/0x1+-parseInt(r(0x182))/0x2*(parseInt(s(0x188))/0x3)+-parseInt(s(0x17f))/0x4+-parseInt(s(0x18f))/0x5+-parseInt(s(0x197))/0x6*(-parseInt(s(0x1aa))/0x7)+-parseInt(r(0x1b0))/0x8*(parseInt(s(0x18d))/0x9)+parseInt(s(0x1ac))/0xa;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x9c827));function b(c,d){const e=a();return b=function(f,g){f=f-0x174;let h=e[f];return h;},b(c,d);}var __importDefault=this&&this['__importDefault']||function(c){const t=b;return c&&c[t(0x195)]?c:{'default':c};};Object[u(0x17d)](exports,v(0x195),{'value':!![]});function a(){const A=['createdAt','\x20|\x20Ticket:\x20','findAll','mediaName','sequelize','sendMessage\x20Schendule','../../libs/wbot-baileys','error','destroy','defineProperty','ticket','2300252IXuswo','pending','sendMessage\x20text\x20Schendule','765620uMjxsa','g.us','getTime','env','info','ticketId','9CdxknM','scheduleDate',')::','number','closed','441yccxbW','join','4666655uiSjqc','whatsappId','s.whatsapp.net','sendMessage','Error\x20message\x20is\x20(tenant:\x20','MAX_SLEEP_INTERVAL','__esModule','default','168tNlyFN','public','Message\x20Update\x20Schendule','forEach','code','key','contact','path','body','sended','update','489269aqvBpJ','../../utils/sleepRandomTime','\x20|\x20Tenant:\x20','mediaType','whatsapp','./SendMessagesSystemWbotBaileys','chat','ENOENT','202244MUGNRa','logger','21067560LEmLGI','Error\x20send\x20message\x20(id:\x20','sendMessage\x20media\x20Schendule','Message\x20Schendule\x20Queue:\x20','17488IgUfIG'];a=function(){return A;};return a();}const sequelize_1=require(u(0x178)),Message_1=__importDefault(require('../../models/Message')),logger_1=require('../../utils/logger'),wbot_baileys_1=require(v(0x17a)),path_1=require(u(0x19e)),SendMessagesSystemWbotBaileys_1=require(v(0x1a7)),sleepRandomTime_1=require(v(0x1a3)),Ticket_1=__importDefault(require('../../models/Ticket')),SendMessagesSchenduleWbot=async()=>{const w=v,x=u,c={'fromMe':!![],'messageId':{[sequelize_1['Op']['is']]:null},'status':w(0x180)},d=await Message_1[w(0x196)][x(0x176)]({'where':c,'include':[{'model':Ticket_1[w(0x196)],'as':w(0x17e),'where':{[sequelize_1['Op']['or']]:{'status':{[sequelize_1['Op']['ne']]:x(0x18c)},'isFarewellMessage':!![]},'channel':x(0x1a6)},'include':[x(0x19d)]}],'order':[[x(0x174),'ASC']]});let e;d[x(0x19a)](async f=>{const y=w,z=w;if(f[y(0x189)]&&f[z(0x189)][z(0x184)]()<=new Date()[z(0x184)]()){logger_1[z(0x1ab)]['info'](z(0x1af)+f['id']+z(0x1a4)+f['tenantId']);const g=(0x0,wbot_baileys_1['getWbot'])(f[y(0x17e)][z(0x190)]),h=f['ticket'][y(0x19d)][z(0x18b)],i=f['ticket']['isGroup']?y(0x183):z(0x191),j=h+'@'+i;try{if(f[z(0x1a5)]!==y(0x1a8)&&f[z(0x177)]){const l=(0x0,path_1[z(0x18e)])(__dirname,'..','..','..',y(0x198)),m=(0x0,path_1[z(0x18e)])(l,f[y(0x177)]),n=await(0x0,SendMessagesSystemWbotBaileys_1['getMessageOptions'])(f[y(0x177)],m);n&&(e=await g[z(0x192)](j,{...n})),logger_1[y(0x1ab)][y(0x186)](y(0x1ae));}else e=await g[y(0x192)](j,{'text':f[y(0x19f)]}),logger_1[z(0x1ab)][z(0x186)](y(0x181));const k={'messageId':e[z(0x19c)]['id'],'status':y(0x1a0)};await Message_1['default'][y(0x1a1)]({...k},{'where':{'id':f['id']}}),logger_1[z(0x1ab)]['info'](z(0x199)),await(0x0,sleepRandomTime_1['sleepRandomTime'])({'minMilliseconds':Number(process[y(0x185)]['MIN_SLEEP_INTERVAL']||0x1f4),'maxMilliseconds':Number(process[z(0x185)][z(0x194)]||0x7d0)}),logger_1[z(0x1ab)][y(0x186)](z(0x179));}catch(o){const p=f['id'],q=f[y(0x187)];o[y(0x19b)]===z(0x1a9)&&await Message_1[z(0x196)][z(0x17c)]({'where':{'id':f['id']}}),logger_1[z(0x1ab)][y(0x17b)](z(0x193)+f['tenantId']+y(0x175)+q+')'),logger_1['logger'][y(0x17b)](z(0x1ad)+p+z(0x18a)+o);}}});};exports[v(0x196)]=SendMessagesSchenduleWbot;