'use strict';const t=b,v=b;(function(c,d){const r=b,s=b,e=c();while(!![]){try{const f=parseInt(r(0x1d9))/0x1*(parseInt(s(0x1df))/0x2)+parseInt(s(0x1af))/0x3+parseInt(s(0x1d2))/0x4+parseInt(r(0x1b8))/0x5+parseInt(r(0x1b4))/0x6*(parseInt(s(0x1d7))/0x7)+-parseInt(r(0x1ca))/0x8*(-parseInt(s(0x1b6))/0x9)+-parseInt(s(0x1e1))/0xa;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x76f27));var __importDefault=this&&this[t(0x1c9)]||function(c){const u=t;return c&&c[u(0x1d1)]?c:{'default':c};};function a(){const A=['Error\x20message\x20is\x20(tenant:\x20','sendMessage','tenantId','findAll','mediaName','__esModule','3699952zyzarN','key','info','mediaType','contact','2494184KjcPkD','scheduleDate','682541Cspuep','sleepRandomTime','error','Message\x20Update\x20Schendule','ENOENT','getTime','2CIajDn','body','24778370ChscGA','path','logger','code','createdAt','default','1023072CSqNjh','Error\x20send\x20message\x20(id:\x20',')::','\x20|\x20Ticket:\x20','whatsappId','6UyghAh','getMessageOptions','5460417xTLYiw','join','267330uXGRXW','destroy','forEach','../../utils/logger','closed','whatsapp','pending','MAX_SLEEP_INTERVAL','ticket','sended','sendMessage\x20media\x20Schendule','env','sequelize','isGroup','sendMessage\x20text\x20Schendule','update','chat','__importDefault','8cUukje','\x20|\x20Tenant:\x20'];a=function(){return A;};return a();}function b(c,d){const e=a();return b=function(f,g){f=f-0x1ac;let h=e[f];return h;},b(c,d);}Object['defineProperty'](exports,t(0x1d1),{'value':!![]});const sequelize_1=require(v(0x1c4)),Message_1=__importDefault(require('../../models/Message')),logger_1=require(v(0x1bb)),wbot_baileys_1=require('../../libs/wbot-baileys'),path_1=require(v(0x1e2)),SendMessagesSystemWbotBaileys_1=require('./SendMessagesSystemWbotBaileys'),sleepRandomTime_1=require('../../utils/sleepRandomTime'),Ticket_1=__importDefault(require('../../models/Ticket')),SendMessagesSchenduleWbot=async()=>{const w=t,x=v,c={'fromMe':!![],'messageId':{[sequelize_1['Op']['is']]:null},'status':w(0x1be)},d=await Message_1[w(0x1ae)][w(0x1cf)]({'where':c,'include':[{'model':Ticket_1[w(0x1ae)],'as':w(0x1c0),'where':{[sequelize_1['Op']['or']]:{'status':{[sequelize_1['Op']['ne']]:w(0x1bc)},'isFarewellMessage':!![]},'channel':x(0x1bd)},'include':[x(0x1d6)]}],'order':[[x(0x1ad),'ASC']]});let e;d[x(0x1ba)](async f=>{const y=x,z=w;if(f[y(0x1d8)]&&f[z(0x1d8)][z(0x1de)]()<=new Date()[y(0x1de)]()){logger_1[z(0x1e3)][z(0x1d4)]('Message\x20Schendule\x20Queue:\x20'+f['id']+z(0x1cb)+f['tenantId']);const g=(0x0,wbot_baileys_1['getWbot'])(f['ticket'][z(0x1b3)]),h=f[z(0x1c0)][z(0x1d6)]['number'],i=f[z(0x1c0)][z(0x1c5)]?'g.us':'s.whatsapp.net',j=h+'@'+i;try{if(f[z(0x1d5)]!==z(0x1c8)&&f[y(0x1d0)]){const l=(0x0,path_1['join'])(__dirname,'..','..','..','public'),m=(0x0,path_1[z(0x1b7)])(l,f[z(0x1d0)]),n=await(0x0,SendMessagesSystemWbotBaileys_1[z(0x1b5)])(f[z(0x1d0)],m);n&&(e=await g[y(0x1cd)](j,{...n})),logger_1['logger'][y(0x1d4)](z(0x1c2));}else e=await g['sendMessage'](j,{'text':f[y(0x1e0)]}),logger_1[z(0x1e3)][z(0x1d4)](z(0x1c6));const k={'messageId':e[z(0x1d3)]['id'],'status':z(0x1c1)};await Message_1['default'][y(0x1c7)]({...k},{'where':{'id':f['id']}}),logger_1[y(0x1e3)][y(0x1d4)](y(0x1dc)),await(0x0,sleepRandomTime_1[y(0x1da)])({'minMilliseconds':Number(process['env']['MIN_SLEEP_INTERVAL']||0x1f4),'maxMilliseconds':Number(process[y(0x1c3)][z(0x1bf)]||0x7d0)}),logger_1[z(0x1e3)][z(0x1d4)]('sendMessage\x20Schendule');}catch(o){const p=f['id'],q=f['ticketId'];o[y(0x1ac)]===y(0x1dd)&&await Message_1['default'][z(0x1b9)]({'where':{'id':f['id']}}),logger_1[y(0x1e3)]['error'](y(0x1cc)+f[z(0x1ce)]+z(0x1b2)+q+')'),logger_1[y(0x1e3)][z(0x1db)](z(0x1b0)+p+y(0x1b1)+o);}}});};exports[v(0x1ae)]=SendMessagesSchenduleWbot;