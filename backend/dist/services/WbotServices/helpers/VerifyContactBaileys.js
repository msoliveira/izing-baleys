'use strict';function b(c,d){const e=a();return b=function(f,g){f=f-0x136;let h=e[f];return h;},b(c,d);}const aB=b,aC=b;(function(c,d){const az=b,aA=b,e=c();while(!![]){try{const f=-parseInt(az(0x180))/0x1+parseInt(aA(0x171))/0x2*(parseInt(az(0x177))/0x3)+-parseInt(aA(0x142))/0x4*(parseInt(az(0x1cc))/0x5)+parseInt(az(0x17a))/0x6*(-parseInt(az(0x162))/0x7)+parseInt(aA(0x194))/0x8+-parseInt(az(0x1bc))/0x9+parseInt(az(0x179))/0xa;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x847a2));var __importDefault=this&&this[aB(0x1ae)]||function(c){return c&&c['__esModule']?c:{'default':c};};Object['defineProperty'](exports,aC(0x174),{'value':!![]}),exports[aB(0x18d)]=exports[aB(0x16b)]=exports[aB(0x160)]=exports[aC(0x1a2)]=exports[aB(0x140)]=exports[aC(0x1c6)]=void 0x0;const CreateOrUpdateContactService_1=__importDefault(require(aC(0x1a9))),baileys_1=require(aB(0x18c)),CreateMessageService_1=__importDefault(require(aC(0x158))),util_1=require(aC(0x193)),fs_1=require('fs'),path_1=require(aC(0x1ca)),logger_1=require(aB(0x17c)),Message_1=__importDefault(require('../../../models/Message')),writeFileAsync=(0x0,util_1[aC(0x198)])(fs_1[aB(0x1cb)]),VerifyContactBaileys=async(c,d,e,f=![],g=undefined)=>{const aD=aC,aE=aC;let h='',i='',j='';if(f)h=g[aD(0x181)],j=g['subject'],i=g['id'][aE(0x15b)]('@')[0x0];else{if('BzrpH'==='BzrpH'){c[aD(0x1ac)][aE(0x150)]?i=c[aE(0x1ac)][aD(0x150)]?.['split']('@')[0x0]:aD(0x18a)!==aE(0x18a)?e[aD(0x1a8)][aE(0x19c)](f):i=c['key'][aE(0x14c)]?.['split']('@')[0x0];if(c[aD(0x1ac)][aE(0x172)])h=i,j=i;else{if(aE(0x1ab)!==aE(0x18e))h=c[aE(0x18f)],j=c[aE(0x18f)];else{h='*'+i?.['message']?.[aD(0x146)]?.[aD(0x149)]+'*';for(const o of m[aE(0x144)]?.[aD(0x146)]?.[aE(0x159)][0x0]?.[aD(0x141)]){o+='\x0a\x0a'+o['title'];}return l;}}}else e[aE(0x1a8)]['error'](f);}const k={'name':h,'number':i,'profilePicUrl':e,'tenantId':Number(d),'pushname':j,'isUser':![],'isWAContact':![],'isGroup':f},l=await(0x0,CreateOrUpdateContactService_1['default'])(k);return l;};exports[aC(0x1c6)]=VerifyContactBaileys;const VerifyMessageBaileys=async(c,d,e,f)=>{const aF=aB,aG=aC,g=await(0x0,exports[aF(0x160)])(c),h=await(0x0,exports[aG(0x16b)])(c),i={'messageId':String(c['key']['id']),'ticketId':e['id'],'contactId':d?undefined:f['id'],'body':String(h),'fromMe':d,'read':d,'mediaType':getTypeMessage(c),'quotedMsgId':g?.['id'],'timestamp':new Date()[aG(0x143)](),'status':aF(0x1b2),'dataJson':JSON['stringify'](c)};await e[aF(0x186)]({'lastMessage':String(h),'lastMessageAt':new Date()['getTime'](),'answered':d||![]}),await(0x0,CreateMessageService_1[aF(0x17b)])({'messageData':i,'tenantId':e[aF(0x1b3)]});};exports[aB(0x140)]=VerifyMessageBaileys;const VerifyMediaMessageBaileys=async(c,d,e)=>{const aH=aC,aI=aB,f=await(0x0,exports[aH(0x160)])(c);try{if(aI(0x1a7)!=='LpMjR'){const g=await downloadMedia(c);if(g[aH(0x188)]===aH(0x19c))throw new Error(aH(0x175));if(!g){if(aI(0x13d)===aH(0x185))f=new g()[aH(0x143)]()+'_'+h;else throw new Error('ERR_WAPP_DOWNLOAD_MEDIA');}if(!g['filename']){const k=g['mimetype'][aI(0x15b)]('/')[0x1]['split'](';')[0x0];g[aI(0x178)]=new Date()[aH(0x143)]()+'.'+k;}else{const l=g['filename'][aI(0x15b)]('.')[aI(0x16f)](),m=g[aI(0x178)][aI(0x15b)]('.')['slice'](0x0,-0x1)['join']('.')['replace'](/\s/g,'_')[aI(0x1ba)](aI(0x16d))['replace'](/[\u0300-\u036f]/g,'');g[aI(0x178)]=m[aI(0x1b4)]()+'_'+new Date()[aH(0x143)]()+'.'+l;}try{aH(0x1af)!==aH(0x1a5)?await writeFileAsync((0x0,path_1[aI(0x165)])(__dirname,'..','..','..','..',aH(0x15c),g[aI(0x178)]),g[aI(0x188)],aI(0x151)):(i=j[aI(0x181)],k=l[aH(0x181)],m=n['id']['split']('@')[0x0]);}catch(o){if(aH(0x166)===aH(0x164)){var q=i[aH(0x196)](j)[aI(0x16a)]('base64');let r=aH(0x147)+q+'\x20|\x20https://maps.google.com/maps?q='+k+aI(0x167)+l+aI(0x19e)+m+',\x20'+n+'\x20';return r;}else logger_1[aH(0x1a8)][aI(0x19c)](o);}const h=await(0x0,exports[aI(0x16b)])(c),i={'messageId':String(c[aI(0x1ac)]['id']),'ticketId':d['id'],'contactId':c[aH(0x1ac)][aI(0x172)]?undefined:e['id'],'body':h||g[aI(0x178)],'fromMe':!!c[aI(0x1ac)][aH(0x172)],'read':!!c[aI(0x1ac)][aI(0x172)],'quotedMsgId':f?.['id'],'mediaUrl':g['filename'],'dataJson':JSON[aI(0x16c)](c),'mediaType':g[aH(0x15e)]['split']('/')[0x0]};await d['update']({'lastMessage':h||g[aI(0x178)]}),await(0x0,CreateMessageService_1[aI(0x17b)])({'messageData':i,'tenantId':d[aI(0x1b3)]});}else e+='\x0a\x0a'+f[aH(0x168)];}catch(r){logger_1['logger'][aI(0x19c)](r);}};exports[aC(0x1a2)]=VerifyMediaMessageBaileys;const verifyQuotedMessage=async c=>{const aJ=aB;if(!c)return null;const d=(0x0,exports['getQuotedMessageId'])(c);if(!d)return null;const e=await Message_1['default'][aJ(0x19f)]({'where':{'messageId':d}});if(!e)return null;return e;};exports[aC(0x160)]=verifyQuotedMessage;function a(){const aW=['gOHbH','error','uaovX','&z=17&hl=pt-BR|','findOne','hydratedTemplate','vcard','VerifyMediaMessageBaileys','Get\x20Type\x20Message\x20->\x20','viewOnceMessage','bOqVG','application','zcZqG','logger','../../ContactServices/CreateOrUpdateContactService','IUpvr','YuHXU','key','isqzK','__importDefault','ZsqMs','caption','rOjJL','received','tenantId','trim','hydratedFourRowTemplate','next','bPlDd','buttonText','buttonsMessage','normalize','jpegThumbnail','2738781zHBTfJ','buttonsResponseMessage','reactionMessage','listResponseMessage','getContentType','image','contentText','templateMessage','imageMessage','znFKp','VerifyContactBaileys','zjrEA','cayMY','Chegou\x20Aqui','path','writeFile','1233745YbwTxN','FueNw','contactMessage','stickerMessage','\x20de\x20baixar\x20o\x20arquivo','buttons','header','value','mEtYl','warn','vouDq','YvndS','quotedMessage','VerifyMessageBaileys','rows','4wMdVTe','getTime','message','selectedButtonId','listMessage','data:image/png;base64,\x20','type','description','aVNLp','Não\x20encontrou\x20o\x20tipo\x20em\x20getBodyMessage:\x20','remoteJid','displayText','protocolMessage','documentWithCaptionMessage','participant','base64','degreesLatitude','ephemeralMessage','Áudio','fourRowTemplate','zdoxo','log','../../MessageServices/CreateMessageService','sections','OVwEl','split','public','editedMessage','mimetype','ZeRox','verifyQuotedMessage','find','72478nsDlVD','video','OuTwm','join','OGCZN','%2C','title','document','toString','getBodyMessage','stringify','NFD','documentMessage','pop','text','16OBqNvp','fromMe','contextInfo','__esModule','ERR_WAPP_DOWNLOAD_MEDIA','\x20-\x20','301794yWMrKP','filename','1149480DUOLlT','6ynsKnW','default','../../../utils/logger','locationMessage','>>>>\x20erro\x20','audioMessage','401859WxipWn','subject','DFkvU','conversation','degreesLongitude','cXhpJ','update','FIEgt','data','downloadContentFromMessage','ILNKL','ILUDn','@whiskeysockets/baileys','getQuotedMessageId','WsITn','pushName','liveLocationMessage','extendedTextMessage','replace','util','4689320xgavhx','DsDfp','from','videoMessage','promisify','nlefZ','interactiveMessage'];a=function(){return aW;};return a();}const downloadMedia=async c=>{const aK=aB,aL=aB,d=c[aK(0x144)]?.[aK(0x1c4)]||c['message']?.[aL(0x17f)]||c[aL(0x144)]?.[aK(0x197)]||c['message']?.[aL(0x136)]||c['message']?.['documentMessage']||c['message']?.[aK(0x14f)]?.[aL(0x144)]?.[aK(0x16e)]||c[aL(0x144)]?.[aL(0x191)]?.[aL(0x173)]?.[aL(0x13f)]?.[aK(0x1c4)]||c['message']?.[aK(0x191)]?.['contextInfo']?.[aL(0x13f)]?.['videoMessage'];let e=d[aL(0x15e)][aL(0x15b)]('/')[0x0][aL(0x192)](aK(0x1a6),aL(0x169))?d['mimetype']['split']('/')[0x0][aK(0x192)](aL(0x1a6),'document'):d[aK(0x15e)][aL(0x15b)]('/')[0x0],f,g=0x0;(c[aL(0x144)]?.[aL(0x16e)]||c[aK(0x144)]?.[aL(0x14f)])&&('IrWqU'!=='MblmP'?e='document':d=aK(0x1b9));while(g<0xa&&!f){try{g>0x1?logger_1[aL(0x1a8)][aL(0x13c)]('Tentativa\x20'+g+aL(0x137)):'',f=await(0x0,baileys_1[aK(0x189)])(c['message']?.[aL(0x17f)]||c[aK(0x144)]?.[aL(0x197)]||c['message']?.[aL(0x16e)]||c[aK(0x144)]?.[aL(0x14f)]?.[aK(0x144)]?.[aL(0x16e)]||c[aL(0x144)]?.[aK(0x1c4)]||c[aL(0x144)]?.[aL(0x136)]||c[aK(0x144)]?.['extendedTextMessage']?.[aK(0x173)][aL(0x13f)]?.[aK(0x1c4)]||c[aK(0x144)]?.['extendedTextMessage']?.[aK(0x173)]['quotedMessage']?.[aK(0x197)]||c[aK(0x144)]?.['buttonsMessage']?.[aL(0x1c4)]||c['message']?.[aL(0x1c3)]?.[aL(0x155)]?.[aL(0x1c4)]||c['message']?.[aK(0x1c3)]?.[aK(0x1a0)]?.['imageMessage']||c[aL(0x144)]?.[aK(0x1c3)]?.[aK(0x1b5)]?.['imageMessage']||c[aK(0x144)]?.[aK(0x19a)]?.[aL(0x139)]?.[aK(0x1c4)],e);}catch(l){if(aL(0x15a)===aK(0x199)){const n=g[aL(0x178)]['split']('.')[aL(0x16f)](),o=h[aK(0x178)][aK(0x15b)]('.')['slice'](0x0,-0x1)[aL(0x165)]('.')[aK(0x192)](/\s/g,'_')[aK(0x1ba)](aK(0x16d))[aL(0x192)](/[\u0300-\u036f]/g,'');i['filename']=o[aK(0x1b4)]()+'_'+new j()['getTime']()+'.'+n;}else g++,await new Promise(n=>setTimeout(n,0x3e8*g*0x2)),logger_1[aL(0x1a8)][aL(0x13c)](aL(0x17e)+g+aL(0x137));}}let h=Buffer[aK(0x196)]([]);try{if(aK(0x1cd)===aL(0x19b))e+='\x0a\x0a'+f[aK(0x1b8)][aK(0x14d)];else for await(const o of f){h=Buffer['concat']([h,o]);}}catch(p){if(aL(0x187)===aK(0x187))return{'data':'error','mimetype':'','filename':''};else throw new d('ERR_WAPP_DOWNLOAD_MEDIA');}if(!h)throw new Error(aL(0x175));let i=c[aL(0x144)]?.[aK(0x16e)]?.['fileName']||'';if(!i){const r=d[aK(0x15e)]['split']('/')[0x1][aK(0x15b)](';')[0x0];i=new Date()[aK(0x143)]()+'.'+r;}else i=new Date()[aL(0x143)]()+'_'+i;const j={'data':h,'mimetype':d[aK(0x15e)],'filename':i};return j;},msgLocation=(c,d,e)=>{const aM=aB,aN=aC;if(c){var f=Buffer[aM(0x196)](c)['toString'](aN(0x151));let g=aM(0x147)+f+'\x20|\x20https://maps.google.com/maps?q='+d+'%2C'+e+aN(0x19e)+d+',\x20'+e+'\x20';return g;}},getBodyMessage=async c=>{const aO=aB,aP=aB;let d;try{if(c?.['message']?.[aO(0x1b9)]?.['contentText']){if(aP(0x182)===aP(0x182)){d='*'+c?.[aO(0x144)]?.[aO(0x1b9)]?.[aO(0x1c2)]+'*';for(const e of c[aO(0x144)]?.[aP(0x1b9)]?.[aP(0x138)]){d+='\x0a\x0a'+e[aO(0x1b8)]['displayText'];}return d;}else d=aO(0x17f);}else{if(c?.[aP(0x144)]?.['listMessage']){d='*'+c?.[aO(0x144)]?.[aO(0x146)]?.['description']+'*';for(const g of c[aP(0x144)]?.[aO(0x146)]?.[aO(0x159)][0x0]?.[aP(0x141)]){'znFKp'!==aP(0x1c5)?(k?.['message']?.['viewOnceMessage']?.['message']?.[aO(0x146)]&&(s=aO(0x146)),m?.[aP(0x144)]?.['viewOnceMessage']?.[aO(0x144)]?.[aP(0x1b9)]&&(t=aO(0x1b9)),o?.['message']?.[aO(0x1a4)]?.['message']&&(u=(0x0,v[aP(0x1c0)])(w?.[aP(0x144)]?.[aO(0x1a4)]?.[aP(0x144)]))):d+='\x0a\x0a'+g[aO(0x168)];}return d;}}if(c[aO(0x144)]?.[aP(0x1a4)]?.[aO(0x144)]?.[aP(0x146)]){let i=c['message']?.['viewOnceMessage']?.[aP(0x144)]['listMessage'];d='*'+i[aP(0x149)]+'*';for(const j of i?.[aP(0x159)][0x0]?.[aO(0x141)]){d+='\x0a\x0a'+j[aO(0x168)];}return d;}if(c[aP(0x144)]?.[aP(0x1a4)]?.['message']?.['buttonsMessage']){let k=c[aO(0x144)]?.[aP(0x1a4)]?.['message'][aP(0x1b9)];d='*'+k[aP(0x1c2)]+'*';for(const l of k?.[aO(0x138)]){aO(0x19d)==='cLqlg'?d=aP(0x1ce):d+='\x0a\x0a'+l[aP(0x1b8)][aP(0x14d)];}return d;}}catch(n){logger_1[aP(0x1a8)][aP(0x19c)](n);}try{const o=getTypeMessage(c);if(!o){if(aP(0x1c8)!==aP(0x1c7))return;else d=aO(0x17d);}const p={'conversation':c[aP(0x144)][aO(0x183)],'imageMessage':c[aP(0x144)][aO(0x1c4)]?.[aO(0x1b0)]||aP(0x1c1),'videoMessage':c[aP(0x144)]['videoMessage']?.[aO(0x1b0)]||aO(0x163),'extendedTextMessage':d||c[aP(0x144)]['extendedTextMessage']?.[aO(0x170)]||c[aO(0x144)]?.[aO(0x146)]?.[aO(0x149)],'buttonsResponseMessage':c['message']['buttonsResponseMessage']?.['selectedDisplayText'],'listResponseMessage':c?.[aP(0x144)]?.[aO(0x1bf)]?.['title']||aO(0x1c9),'templateButtonReplyMessage':c['message']?.['templateButtonReplyMessage']?.['selectedId'],'messageContextInfo':c[aO(0x144)][aP(0x1bd)]?.[aO(0x145)]||c[aO(0x144)]['listResponseMessage']?.[aP(0x168)],'buttonsMessage':d||c[aO(0x144)][aO(0x1bf)]?.['title'],'stickerMessage':'sticker','contactMessage':c[aO(0x144)][aO(0x1ce)]?.[aP(0x1a1)],'contactsArrayMessage':'varios\x20contatos','locationMessage':msgLocation(c[aP(0x144)]?.[aO(0x17d)]?.[aO(0x1bb)],c[aO(0x144)]?.[aP(0x17d)]?.[aP(0x152)],c[aP(0x144)]?.[aP(0x17d)]?.[aP(0x184)]),'liveLocationMessage':msgLocation(c[aP(0x144)]?.[aP(0x190)]?.[aO(0x1bb)],c[aP(0x144)]?.[aO(0x190)]?.[aO(0x152)],c['message']?.['liveLocationMessage']?.['degreesLongitude']),'documentMessage':c[aP(0x144)][aP(0x16e)]?.[aP(0x168)],'audioMessage':aO(0x154),'reactionMessage':c[aO(0x144)]?.[aO(0x1be)]?.[aP(0x170)],'ephemeralMessage':c[aO(0x144)]?.[aP(0x153)]?.['message']?.[aO(0x191)]?.[aO(0x170)],'protocolMessage':c[aO(0x144)]?.[aP(0x14e)]?.[aP(0x148)]||c[aO(0x144)]?.['ephemeralMessage']?.['message']?.[aP(0x14e)]?.['type'],'listMessage':d||c[aO(0x144)]?.[aP(0x146)]?.['description'],'viewOnceMessage':d,'documentWithCaptionMessage':c[aP(0x144)]?.[aP(0x14f)]?.[aP(0x144)]?.['documentMessage']?.[aP(0x1b0)],'editedMessage':extractEditedMessage(c)},q=Object['keys'](p)[aO(0x161)](s=>s===o);if(!q)logger_1['logger'][aP(0x13c)](aP(0x14b)+o+aP(0x176)+JSON[aO(0x16c)](c?.[aO(0x144)]));else{}return p[o];}catch(s){console[aP(0x157)]('Get\x20Body\x20Message\x20-->\x20'+s);}};exports[aC(0x16b)]=getBodyMessage;const extractEditedMessage=c=>{const aQ=aC,aR=aC;if(c?.[aQ(0x144)]?.[aQ(0x15d)]?.[aQ(0x144)]?.[aQ(0x14e)]?.[aR(0x15d)]?.[aR(0x183)]){if(aQ(0x1b7)!=='dSgzj')return c?.[aQ(0x144)]?.[aQ(0x15d)]?.[aR(0x144)]?.[aR(0x14e)]?.[aR(0x15d)]?.[aR(0x183)];else d='videoMessage';}else{if(c?.[aR(0x144)]?.[aR(0x15d)]?.[aQ(0x144)]?.[aQ(0x14e)]?.['editedMessage']?.[aR(0x191)]?.['text'])return c?.[aR(0x144)]?.[aR(0x15d)]?.[aR(0x144)]?.[aR(0x14e)]?.[aR(0x15d)]?.[aR(0x191)]?.[aQ(0x170)];}return undefined;},getTypeMessage=c=>{const aS=aC,aT=aC;try{if(aS(0x1b1)!==aT(0x15f)){let d=(0x0,baileys_1[aT(0x1c0)])(c?.[aS(0x144)]);if(d===aS(0x1a4)){c?.[aS(0x144)]?.[aS(0x1a4)]?.[aT(0x144)]?.['listMessage']&&(aT(0x18b)!==aT(0x13b)?d=aT(0x146):e=f[aT(0x1ac)][aS(0x14c)]?.[aT(0x15b)]('@')[0x0]);if(c?.[aS(0x144)]?.[aT(0x1a4)]?.['message']?.['buttonsMessage']){if(aS(0x14a)!=='AiQVS')d=aT(0x1b9);else{h='*'+i?.[aS(0x144)]?.[aT(0x1b9)]?.[aT(0x1c2)]+'*';for(const g of m[aT(0x144)]?.[aS(0x1b9)]?.[aT(0x138)]){o+='\x0a\x0a'+g[aT(0x1b8)][aS(0x14d)];}return l;}}c?.[aS(0x144)]?.[aS(0x1a4)]?.[aS(0x144)]&&(d=(0x0,baileys_1[aS(0x1c0)])(c?.[aT(0x144)]?.[aS(0x1a4)]?.['message']));}if(d===aT(0x153)){if(aS(0x156)!==aT(0x156))g=h,i=j;else{c?.[aS(0x144)]?.[aS(0x153)]?.[aT(0x144)]?.[aT(0x146)]&&(aT(0x1ad)!=='isqzK'?d=aS(0x14e):d='listMessage');c?.[aS(0x144)]?.[aS(0x153)]?.[aS(0x144)]?.[aT(0x1b9)]&&(d=aS(0x1b9));c?.['message']?.[aT(0x153)]?.[aT(0x144)]?.[aT(0x1c4)]&&(d=aT(0x1c4));c?.[aT(0x144)]?.[aS(0x153)]?.[aT(0x144)]?.[aS(0x17f)]&&(d=aT(0x17f));c?.['message']?.[aS(0x153)]?.[aS(0x144)]?.[aT(0x17f)]&&(d=aS(0x197));c?.['message']?.[aT(0x153)]?.[aT(0x144)]?.[aT(0x16e)]&&('IUpvr'!==aT(0x1aa)?(g=h[aT(0x18f)],i=j[aT(0x18f)]):d=aT(0x16e));c?.[aT(0x144)]?.[aS(0x153)]?.['message']?.[aT(0x136)]&&('YvndS'===aT(0x13e)?d=aS(0x136):d=aT(0x136));c?.['message']?.[aS(0x153)]?.[aS(0x144)]?.[aS(0x1ce)]&&(d='contactMessage');c?.['message']?.[aS(0x153)]?.[aS(0x144)]?.[aT(0x17d)]&&(d=aS(0x17d));if(c?.[aS(0x144)]?.[aS(0x153)]?.[aS(0x144)]?.['protocolMessage']){if('DsDfp'!==aT(0x195)){const l=f[aS(0x15e)]['split']('/')[0x1]['split'](';')[0x0];g=new h()['getTime']()+'.'+l;}else d=aT(0x14e);}c?.[aS(0x144)]?.[aT(0x153)]?.['message']?.[aT(0x1a4)]&&(d=(0x0,baileys_1['getContentType'])(c?.[aT(0x144)]?.[aT(0x153)]?.['message']?.[aT(0x1a4)]?.[aS(0x144)]));}}return d;}else d='imageMessage';}catch(m){logger_1['logger']['error'](aS(0x1a3)+m);}},getQuotedMessageId=c=>{const aU=aC,aV=aC,d=(0x0,baileys_1['extractMessageContent'])(c[aU(0x144)])[Object['keys'](c?.[aU(0x144)])['values']()[aU(0x1b6)]()[aV(0x13a)]];let e=c?.[aU(0x144)]?.[aV(0x1be)]?c?.[aV(0x144)]?.[aV(0x1be)]?.['key']?.['id']:'';return e?e:d?.[aU(0x173)]?.['stanzaId'];};exports['getQuotedMessageId']=getQuotedMessageId;