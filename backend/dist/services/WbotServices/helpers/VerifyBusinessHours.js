'use strict';const q=b,r=b;(function(c,d){const o=b,p=b,e=c();while(!![]){try{const f=parseInt(o(0x8e))/0x1+parseInt(p(0x96))/0x2*(parseInt(p(0xa1))/0x3)+parseInt(o(0x7b))/0x4*(parseInt(p(0x90))/0x5)+parseInt(o(0x81))/0x6+-parseInt(o(0x7c))/0x7+-parseInt(p(0x8a))/0x8*(parseInt(p(0x80))/0x9)+parseInt(o(0x7a))/0xa*(-parseInt(o(0x98))/0xb);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x2eac9));function b(c,d){const e=a();return b=function(f,g){f=f-0x79;let h=e[f];return h;},b(c,d);}function a(){const u=['date-fns','fromUnixTime','1494328NqhBnK','type','tenantId','defineProperty','139743Vqneum','isWithinInterval','60555TKuaVa','messageTimestamp','hr1','getDay','hr3','businessHours','7126tfQIgi','default','67177aySaLR','pending','closed','select\x20m.body,\x20m.\x22createdAt\x22\x20,\x20m.\x22updatedAt\x22\x20,\x20m.\x22ticketId\x22\x0a\x20\x20\x20\x20\x20\x20from\x20\x22Messages\x22\x20m,\x20\x22Tickets\x22\x20t\x20\x0a\x20\x20\x20\x20\x20\x20where\x20t.id\x20=\x20m.\x22ticketId\x22\x20\x0a\x20\x20\x20\x20\x20\x20and\x20t.id\x20=\x20','parse','bot','HH:mm','sendType','SELECT','246unubsS','length','messageBusinessHours','find','20uyzTkg','44boEzuC','1874341dABopw','../../../database','isGroup','../../TenantServices/ShowBusinessHoursAndMessageService','18krVTgH','1677636lofZSO','\x0a\x20\x20\x20\x20\x20\x20and\x20m.\x22fromMe\x22\x20=\x20true\x20\x0a\x20\x20\x20\x20\x20\x20and\x20m.\x22createdAt\x22\x20=\x20(select\x20max(m2.\x22createdAt\x22)\x20from\x20\x22Messages\x22\x20m2\x20where\x20m2.\x22ticketId\x22\x20=\x20','hr2','../../MessageServices/CreateMessageSystemService','hr4','query','QueryTypes'];a=function(){return u;};return a();}var __importDefault=this&&this['__importDefault']||function(c){return c&&c['__esModule']?c:{'default':c};};Object[q(0x8d)](exports,'__esModule',{'value':!![]});const date_fns_1=require(q(0x88)),ShowBusinessHoursAndMessageService_1=__importDefault(require(r(0x7f))),CreateMessageSystemService_1=__importDefault(require(q(0x84))),database_1=__importDefault(require(r(0x7d))),sequelize_1=require('sequelize'),verifyBusinessHours=async(c,d)=>{const s=q,t=q;let e=!![];if(d['status']!==s(0x9a)&&!c['fromMe']&&!d[s(0x7e)]){const f=await(0x0,ShowBusinessHoursAndMessageService_1[t(0x97)])({'tenantId':d[t(0x8c)]}),g=(0x0,date_fns_1[t(0x89)])(c[s(0x91)]),h=f[s(0x95)][t(0x79)](k=>k['day']===g[t(0x93)]());if(!h)return e;if(h[t(0x8b)]==='O')return e;const i=(0x0,date_fns_1[s(0x8f)])(g,{'start':(0x0,date_fns_1[s(0x9c)])(h[t(0x92)],'HH:mm',new Date()),'end':(0x0,date_fns_1[s(0x9c)])(h[s(0x83)],t(0x9e),new Date())}),j=(0x0,date_fns_1[t(0x8f)])(g,{'start':(0x0,date_fns_1[t(0x9c)])(h[t(0x94)],t(0x9e),new Date()),'end':(0x0,date_fns_1['parse'])(h[s(0x85)],s(0x9e),new Date())});if(h[s(0x8b)]==='C'||!i&&!j){let k=t(0x9b)+d['id']+s(0x82)+d['id']+'\x20and\x20\x22fromMe\x22\x20=\x20true\x20)';const l=await database_1['default'][t(0x86)](k,{'type':sequelize_1[s(0x87)][t(0xa0)]}),m=''+f[s(0xa3)];if(l[s(0xa2)]>0x0&&l[0x0]['body']==m)return![];e=![];const n={'body':f[s(0xa3)],'fromMe':!![],'read':!![],'sendType':t(0x9d),'tenantId':d[t(0x8c)]};await(0x0,CreateMessageSystemService_1[s(0x97)])({'msg':n,'tenantId':d[s(0x8c)],'ticket':d,'sendType':n[t(0x9f)],'status':t(0x99)});}}return e;};exports[q(0x97)]=verifyBusinessHours;