'use strict';const r=b,s=b;function a(){const y=['1617880jVMyPU','all','bulkCreate','27sdyLYa','email','wallets','../../models/Contact','default','forEach','contact:update','reload','__esModule','24grlYCB','map','4453544rNwcZc','3330102jnEWaT','findIndex','125471abPHGi','name','476825uIZrvv','destroy','944466nzbAFi','../../helpers/socketEmit','defineProperty','extraInfo','7FbhuYw','../../errors/AppError','17765440ARpvsi','profilePicUrl','upsert','3PoNOXE','tags','number','ERR_NO_CONTACT_FOUND','../../models/ContactWallet'];a=function(){return y;};return a();}function b(c,d){const e=a();return b=function(f,g){f=f-0x1d8;let h=e[f];return h;},b(c,d);}(function(c,d){const o=b,p=b,e=c();while(!![]){try{const f=parseInt(o(0x1ee))/0x1+parseInt(p(0x1f2))/0x2*(-parseInt(o(0x1d8))/0x3)+parseInt(p(0x1e9))/0x4*(parseInt(o(0x1f0))/0x5)+parseInt(o(0x1ec))/0x6*(parseInt(o(0x1f6))/0x7)+-parseInt(p(0x1eb))/0x8*(-parseInt(o(0x1e0))/0x9)+parseInt(o(0x1dd))/0xa+-parseInt(o(0x1f8))/0xb;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xf3798));var __importDefault=this&&this['__importDefault']||function(c){const q=b;return c&&c[q(0x1e8)]?c:{'default':c};};Object[r(0x1f4)](exports,'__esModule',{'value':!![]});const AppError_1=__importDefault(require(s(0x1f7))),socketEmit_1=__importDefault(require(r(0x1f3))),Contact_1=__importDefault(require(s(0x1e3))),ContactCustomField_1=__importDefault(require('../../models/ContactCustomField')),ContactWallet_1=__importDefault(require(s(0x1dc))),UpdateContactService=async({contactData:c,contactId:d,tenantId:e})=>{const t=s,u=r,{email:f,name:g,number:h,extraInfo:i,wallets:j}=c,k=await Contact_1[t(0x1e4)]['findOne']({'where':{'id':d,'tenantId':e},'attributes':['id','name','number','email',t(0x1f9)],'include':[t(0x1f5),u(0x1d9),{'association':u(0x1e2),'attributes':['id',t(0x1ef)]}]});if(!k)throw new AppError_1['default'](t(0x1db),0x194);i&&(await Promise[u(0x1de)](i[u(0x1ea)](async l=>{const v=t;await ContactCustomField_1['default'][v(0x1fa)]({...l,'contactId':k['id']});})),await Promise[u(0x1de)](k[u(0x1f5)][u(0x1ea)](async l=>{const w=u,x=t,m=i[w(0x1ed)](n=>n['id']===l['id']);m===-0x1&&await ContactCustomField_1['default'][x(0x1f1)]({'where':{'id':l['id']}});})));if(j){await ContactWallet_1[t(0x1e4)]['destroy']({'where':{'tenantId':e,'contactId':d}});const l=[];j[t(0x1e5)](m=>{l['push']({'walletId':!m['id']?m:m['id'],'contactId':d,'tenantId':e});}),await ContactWallet_1[t(0x1e4)][u(0x1df)](l);}return await k['update']({'name':g,'number':h,'email':f}),await k[u(0x1e7)]({'attributes':['id','name',t(0x1da),t(0x1e1),'profilePicUrl'],'include':[u(0x1f5),u(0x1d9),{'association':'wallets','attributes':['id','name']}]}),(0x0,socketEmit_1[u(0x1e4)])({'tenantId':e,'type':t(0x1e6),'payload':k}),k;};exports['default']=UpdateContactService;