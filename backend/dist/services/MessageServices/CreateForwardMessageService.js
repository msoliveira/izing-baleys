'use strict';const o=b,q=b;(function(c,d){const m=b,n=b,e=c();while(!![]){try{const f=-parseInt(m(0x79))/0x1*(-parseInt(m(0x7c))/0x2)+parseInt(m(0x7b))/0x3*(-parseInt(m(0x8a))/0x4)+-parseInt(m(0x78))/0x5*(-parseInt(n(0x96))/0x6)+-parseInt(m(0x85))/0x7+-parseInt(n(0x8c))/0x8+-parseInt(n(0x7e))/0x9*(parseInt(n(0x91))/0xa)+-parseInt(m(0x87))/0xb*(-parseInt(n(0x83))/0xc);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xd7e95));function a(){const t=['isGroup','8718590fASGYG','pending','getTime','body','quotedMsg','6kLQDMu','create','default','__importDefault','7625830SFagbj','21823vnUhID','../TicketServices/ShowTicketService','6dUIwhJ','74pZqUcS','../../models/Message','9XESyFX','../../helpers/socketEmit','findOne','defineProperty','contact','27502104wNVxKG','sequelize','4445721wHpHTV','mediaName','11syAUBY','ticket','chat:create','1953976wHmwpx','open','10049088RhzUxg','ERR_CREATING_MESSAGE_SYSTEM','__esModule','update'];a=function(){return t;};return a();}var __importDefault=this&&this[o(0x99)]||function(c){const p=o;return c&&c[p(0x8e)]?c:{'default':c};};Object[o(0x81)](exports,o(0x8e),{'value':!![]});function b(c,d){const e=a();return b=function(f,g){f=f-0x78;let h=e[f];return h;},b(c,d);}const sequelize_1=require(q(0x84)),socketEmit_1=__importDefault(require(o(0x7f))),Message_1=__importDefault(require(q(0x7d))),Ticket_1=__importDefault(require('../../models/Ticket')),ShowTicketService_1=__importDefault(require(q(0x7a))),queueValidation_1=__importDefault(require('../../utils/queueValidation')),CreateForwardMessageService=async({userId:c,tenantId:d,message:e,contact:f,ticketIdOrigin:g})=>{const r=q,s=q,h=await(0x0,ShowTicketService_1[r(0x98)])({'id':g,'tenantId':d});let i;i=await Ticket_1[s(0x98)][r(0x80)]({'where':{'status':{[sequelize_1['Op']['or']]:[s(0x8b),'pending']},'tenantId':d,'contactId':f['id']}});!i&&(i=await Ticket_1[r(0x98)][r(0x97)]({'contactId':f['id'],'status':r(0x8b),'isGroup':f[s(0x90)],'userId':c,'tenantId':d,'unreadMessages':0x0,'whatsappId':h['whatsappId'],'lastMessage':e[r(0x94)],'lastMessageAt':new Date()[r(0x93)](),'answered':!![]}));const j={'body':e[s(0x94)],'contactId':f['id'],'fromMe':!![],'read':!![],'mediaType':e?.['mediaType'],'mediaUrl':e?.['mediaName'],'mediaName':e?.[r(0x86)],'timestamp':new Date()['getTime'](),'userId':c,'scheduleDate':null,'sendType':'chat','status':r(0x92),'ticketId':i['id'],'tenantId':d},k=await Message_1[r(0x98)][s(0x97)](j),l=await Message_1[r(0x98)]['findByPk'](k['id'],{'include':[{'model':Ticket_1[r(0x98)],'as':s(0x88),'where':{'tenantId':d},'include':[s(0x82)]},{'model':Message_1[r(0x98)],'as':r(0x95),'include':[s(0x82)]}]});if(!l)throw new Error(s(0x8d));await i[r(0x8f)]({'lastMessage':l['body'],'lastMessageAt':new Date()[s(0x93)](),'answered':!![]}),await(0x0,queueValidation_1['default'])(i['whatsappId'],i['tenantId'],[l]),(0x0,socketEmit_1[r(0x98)])({'tenantId':d,'type':s(0x89),'payload':l});};exports[q(0x98)]=CreateForwardMessageService;