'use strict';const r=b,t=b;function b(c,d){const e=a();return b=function(f,g){f=f-0x193;let h=e[f];return h;},b(c,d);}(function(c,d){const p=b,q=b,e=c();while(!![]){try{const f=-parseInt(p(0x1b2))/0x1*(parseInt(p(0x1aa))/0x2)+parseInt(q(0x1a9))/0x3+-parseInt(q(0x197))/0x4+-parseInt(p(0x19d))/0x5+parseInt(p(0x1a0))/0x6+parseInt(q(0x1b6))/0x7+-parseInt(q(0x19f))/0x8;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x27509));var __importDefault=this&&this[r(0x1b8)]||function(c){const s=r;return c&&c[s(0x1b9)]?c:{'default':c};};Object[r(0x1a2)](exports,t(0x1b9),{'value':!![]});const Message_1=__importDefault(require(t(0x1ad))),Ticket_1=__importDefault(require(r(0x1af))),socketEmit_1=__importDefault(require(t(0x195))),Contact_1=__importDefault(require('../../models/Contact'));function extractMessageId(c){const u=t,v=t;try{const d=JSON[u(0x1b0)](c);return d[v(0x1b3)][v(0x19b)][u(0x1b3)][u(0x193)][v(0x19c)]['id'];}catch(e){throw new Error('Erro\x20ao\x20extrair\x20messageId\x20do\x20dataJson');}}const CreateMessageService=async({messageData:c,tenantId:d})=>{const w=t,x=r;if(c[w(0x1a8)]===x(0x19b)&&c[w(0x1b7)]){const h=c[w(0x1b7)],i=extractMessageId(h),j=await Message_1['default'][w(0x199)]({'where':{'messageId':i,'tenantId':d}});if(j)return await j[x(0x1a6)]({'edited':c[x(0x1a1)]}),(0x0,socketEmit_1[x(0x1ac)])({'tenantId':d,'type':w(0x1ba),'payload':j}),j;else{if(x(0x198)!==x(0x198))throw new d(w(0x19a));else throw new Error(w(0x1a4));}}let e=await Message_1['default']['findOne']({'where':{'messageId':c['messageId'],'tenantId':d}});!e?w(0x1ab)===x(0x1ab)?e=await Message_1[w(0x1ac)][w(0x1a7)]({...c,'tenantId':d}):g=[{'model':h['default'],'as':x(0x1ae),'where':{'tenantId':i},'include':[w(0x1a5)]},{'model':j[w(0x1ac)],'as':w(0x1a3),'include':[w(0x1a5)]}]:await e[x(0x1a6)](c);let f;if(!c[x(0x1b4)]){if(x(0x196)!==x(0x1b1))f=[{'model':Ticket_1[x(0x1ac)],'as':'ticket','where':{'tenantId':d},'include':[x(0x1a5)]},{'model':Message_1[w(0x1ac)],'as':w(0x1a3),'include':['contact']},{'model':Contact_1[x(0x1ac)],'as':w(0x1a5),'where':{'id':c[w(0x194)]}}];else throw new d(w(0x1a4));}else{if(w(0x1b5)==='rkRyE'){const o=e[x(0x1b0)](f);return o['message'][x(0x19b)][w(0x1b3)]['protocolMessage'][x(0x19c)]['id'];}else f=[{'model':Ticket_1[x(0x1ac)],'as':'ticket','where':{'tenantId':d},'include':[x(0x1a5)]},{'model':Message_1[w(0x1ac)],'as':w(0x1a3),'include':[x(0x1a5)]}];}const g=await Message_1[w(0x1ac)]['findOne']({'where':{'messageId':c['messageId'],'tenantId':d},'include':f});if(!g)throw new Error('ERR_CREATING_MESSAGE');return(0x0,socketEmit_1[w(0x1ac)])({'tenantId':d,'type':x(0x19e),'payload':g}),e;};exports['default']=CreateMessageService;function a(){const y=['editedMessage','key','1288600jYZMDR','chat:create','1999192YzBKyo','1686480EkprIG','body','defineProperty','quotedMsg','Mensagem\x20original\x20n√£o\x20encontrada','contact','update','create','mediaType','636285BBRiwD','97262vJPcLC','aBwuT','default','../../models/Message','ticket','../../models/Ticket','parse','CMnIe','1gsWlzI','message','fromMe','cPNoy','1804621VMRUrj','dataJson','__importDefault','__esModule','chat:update','protocolMessage','contactId','../../helpers/socketEmit','XTefx','134780QbIvQQ','eKhFo','findOne','Erro\x20ao\x20extrair\x20messageId\x20do\x20dataJson'];a=function(){return y;};return a();}