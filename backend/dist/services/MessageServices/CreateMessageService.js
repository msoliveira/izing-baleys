'use strict';const q=b,r=b;(function(c,d){const o=b,p=b,e=c();while(!![]){try{const f=parseInt(o(0x179))/0x1+-parseInt(o(0x189))/0x2+-parseInt(p(0x16c))/0x3*(-parseInt(p(0x180))/0x4)+-parseInt(p(0x18e))/0x5+parseInt(p(0x172))/0x6+-parseInt(p(0x175))/0x7+parseInt(o(0x171))/0x8;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xa6b67));var __importDefault=this&&this[q(0x16e)]||function(c){return c&&c['__esModule']?c:{'default':c};};function a(){const w=['contact','contactId','pFcJj','dMpaR','editedMessage','key','3rTMsLf','findOne','__importDefault','parse','mediaType','12202616lDRfxA','723810WbNdWx','../../models/Message','Bnmwy','6029373FhDYLN','__esModule','ERR_CREATING_MESSAGE','default','1183461FZkVAw','dZtGZ','../../helpers/socketEmit','ticket','chat:create','../../models/Contact','dataJson','1704216MKMpor','chat:update','update','Mensagem\x20original\x20nÃ£o\x20encontrada','create','fromMe','messageId','body','message','917348DhaASt','protocolMessage','quotedMsg','kSZxK','../../models/Ticket','6263045JSJECk','Erro\x20ao\x20extrair\x20messageId\x20do\x20dataJson'];a=function(){return w;};return a();}Object['defineProperty'](exports,q(0x176),{'value':!![]});function b(c,d){const e=a();return b=function(f,g){f=f-0x169;let h=e[f];return h;},b(c,d);}const Message_1=__importDefault(require(q(0x173))),Ticket_1=__importDefault(require(r(0x18d))),socketEmit_1=__importDefault(require(q(0x17b))),Contact_1=__importDefault(require(q(0x17e)));function extractMessageId(c){const s=q,t=r;try{const d=JSON[s(0x16f)](c);return d[t(0x188)][s(0x16a)][t(0x188)][s(0x18a)][t(0x16b)]['id'];}catch(e){if(t(0x17a)!==t(0x169))throw new Error(s(0x18f));else try{const g=i[s(0x16f)](j);return g[s(0x188)]['editedMessage'][t(0x188)][s(0x18a)][t(0x16b)]['id'];}catch(h){throw new l(s(0x18f));}}}const CreateMessageService=async({messageData:c,tenantId:d})=>{const u=r,v=q;if(c[u(0x170)]===u(0x16a)&&c[u(0x17f)]){if(v(0x18c)===u(0x18c)){const h=c[v(0x17f)],i=extractMessageId(h),j=await Message_1[u(0x178)]['findOne']({'where':{'messageId':i,'tenantId':d}});if(j)return await j[u(0x182)]({'edited':c[v(0x187)]}),(0x0,socketEmit_1[u(0x178)])({'tenantId':d,'type':u(0x181),'payload':j}),j;else throw new Error(u(0x183));}else{const l=e[v(0x16f)](f);return l[v(0x188)][v(0x16a)][u(0x188)][u(0x18a)]['key']['id'];}}let e=await Message_1[u(0x178)][u(0x16d)]({'where':{'messageId':c[v(0x186)],'tenantId':d}});!e?'pFcJj'===u(0x192)?e=await Message_1[v(0x178)][u(0x184)]({...c,'tenantId':d}):g=[{'model':h[v(0x178)],'as':u(0x17c),'where':{'tenantId':i},'include':[u(0x190)]},{'model':j[u(0x178)],'as':u(0x18b),'include':['contact']}]:await e['update'](c);let f;if(!c[u(0x185)]){if(v(0x174)==='Bnmwy')f=[{'model':Ticket_1[u(0x178)],'as':u(0x17c),'where':{'tenantId':d},'include':['contact']},{'model':Message_1[v(0x178)],'as':'quotedMsg','include':['contact']},{'model':Contact_1[u(0x178)],'as':v(0x190),'where':{'id':c[u(0x191)]}}];else throw new d('Erro\x20ao\x20extrair\x20messageId\x20do\x20dataJson');}else f=[{'model':Ticket_1['default'],'as':u(0x17c),'where':{'tenantId':d},'include':[u(0x190)]},{'model':Message_1[v(0x178)],'as':v(0x18b),'include':[u(0x190)]}];const g=await Message_1[u(0x178)]['findOne']({'where':{'messageId':c['messageId'],'tenantId':d},'include':f});if(!g)throw new Error(u(0x177));return(0x0,socketEmit_1[v(0x178)])({'tenantId':d,'type':v(0x17d),'payload':g}),e;};exports[r(0x178)]=CreateMessageService;